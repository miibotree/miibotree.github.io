<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
    

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.4"/>




  <meta name="keywords" content="Hexo,next" />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.4" />


<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Miibotree'thinking">
<meta property="og:url" content="http://yoursite.com/page/20/index.html">
<meta property="og:site_name" content="Miibotree'thinking">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Miibotree'thinking">
<meta name="twitter:description">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post'
  };
</script>

    <title> Miibotree'thinking </title>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->




<div class="container one-column 
   page-home 
">
    <div class="headband"></div>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">Miibotree'thinking</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-tags"></i> <br />
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            <i class="menu-item-icon icon-about"></i> <br />
            关于
          </a>
        </li>
      
    </ul>
  

  
</nav>


        </div>
    </header>

    <main id="main" class="main">
        <div class="main-inner">
            <div id="content" class="content">
                
  <section id="posts" class="posts-expand">
    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2012/01/24/widowsSDK创建对话框的三种方法/" itemprop="url">
                widowsSDK创建对话框的三种方法
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-01-24T16:21:00+08:00" content="2012-01-24">
            2012-01-24
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>&nbsp;</p>
<p><strong><span style="font-size: 18px; color: #000000;">自己看对话框也有些时间了，下面来总结下对话框的一些知识点。</span></strong></p>
<p><strong><span style="font-size: 18px; color: #3366ff;">对话框有模态对话框和非模态对话框两种基本形式。</span></strong></p>
<p><span style="color: #ff0000;">非模态对话框</span>允许我们把输入焦点切换到同一个应用程序的另一个窗口，该对话框也无需关闭，这个比较普遍。</p>
<p><span style="color: #ff0000;">模态对话框</span>主要是两类：<span style="color: #ff0000;">应用程序模式对话框和系统对话框</span>。应用程序对话框<span style="color: #ff0000;">不允许我们在本应用程序中切换输入焦点，但是可以切换到其他应用程序中去</span>，比如点击记事本的文件打开按钮，会弹出选择打开文件的对话框，这个对话框不能切换到记事本中，但是可以切换到其他应用程序中去。这个就是属于应用程序模式对话框。系统对话框则比较恶毒，<span style="color: #ff0000;">不允许你切换到任何一个应用程序中</span>，我们一看名字就知道，系统对话框，看似比较紧急，要求我们必须首要解决····</p>
<hr>
<p><strong><span style="font-size: 16px;">我的第一种方法是用模态对话框来建立一个最简单的对话框</span></strong>。首先是.c文件的代码</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#include &amp;lt;windows.h&amp;gt;</span></span><br><span class="line"><span class="preprocessor">#include &amp;quot;resource.h&amp;quot;</span></span><br><span class="line"></span><br><span class="line">LRESULT <span class="built_in">CALLBACK</span> WndProc (HWND, <span class="built_in">UINT</span>, WPARAM, LPARAM) ;</span><br><span class="line"><span class="built_in">BOOL</span> <span class="built_in">CALLBACK</span> AboutDlgProc (HWND, <span class="built_in">UINT</span>, WPARAM, LPARAM) ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> WINAPI WinMain (HI<span class="built_in">NSTANCE</span> hInstance, HI<span class="built_in">NSTANCE</span> hPrevInstance,</span><br><span class="line">PSTR szCmdLine, <span class="keyword">int</span> iCmdShow)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">static</span> TCHAR szAppName[] = TEXT (&amp;quot;ModeDia&amp;quot;) ;</span><br><span class="line">HWND hwnd ;</span><br><span class="line">MSG msg ;</span><br><span class="line">WNDCLASS wndclass ;</span><br><span class="line"></span><br><span class="line">wndclass<span class="variable">.style</span> = CS_HREDRAW | CS_VREDRAW ;</span><br><span class="line">wndclass<span class="variable">.lpfnWndProc</span> = WndProc ;</span><br><span class="line">wndclass<span class="variable">.cbClsExtra</span> = <span class="number">0</span> ;</span><br><span class="line">wndclass<span class="variable">.cbWndExtra</span> = <span class="number">0</span> ;</span><br><span class="line">wndclass<span class="variable">.hInstance</span> = hInstance ;</span><br><span class="line">wndclass<span class="variable">.hIcon</span> = LoadIcon (<span class="literal">NULL</span>, IDI_APPLI<span class="built_in">CATION</span>) ;</span><br><span class="line">wndclass<span class="variable">.hCursor</span> = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW) ;</span><br><span class="line">wndclass<span class="variable">.hbrBackground</span> = (HBRUSH) GetStockObject (WHITE_BRUSH) ;</span><br><span class="line">wndclass<span class="variable">.lpszMenuName</span> = szAppName ;</span><br><span class="line">wndclass<span class="variable">.lpszClassName</span> = szAppName ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!RegisterClass (&amp;amp;amp;wndclass))</span><br><span class="line">&#123;</span><br><span class="line">MessageBox (<span class="literal">NULL</span>, TEXT (&amp;quot;This program requires Windows NT!&amp;quot;),</span><br><span class="line">szAppName, MB_ICONERROR) ;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hwnd = CreateWindow (szAppName,</span><br><span class="line">TEXT (&amp;quot;A Dialog Program&amp;quot;),</span><br><span class="line">WS_OVERLAPPEDWINDOW,</span><br><span class="line">CW_USEDEFAULT,</span><br><span class="line">CW_USEDEFAULT,</span><br><span class="line">CW_USEDEFAULT,</span><br><span class="line">CW_USEDEFAULT,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line"><span class="literal">NULL</span>,</span><br><span class="line">hInstance,</span><br><span class="line"><span class="literal">NULL</span>) ;</span><br><span class="line"></span><br><span class="line">ShowWindow (hwnd, iCmdShow) ;</span><br><span class="line">UpdateWindow (hwnd) ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (GetMessage (&amp;amp;amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">TranslateMessage (&amp;amp;amp;msg) ;</span><br><span class="line">DispatchMessage (&amp;amp;amp;msg) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> msg<span class="variable">.wParam</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LRESULT <span class="built_in">CALLBACK</span> WndProc (HWND hwnd, <span class="built_in">UINT</span> message, WPARAM wParam, LPARAM lParam)</span><br><span class="line">&#123;</span><br><span class="line">HDC hdc ;</span><br><span class="line">PAINTSTRUCT ps ;</span><br><span class="line">RECT rect ;</span><br><span class="line"><span class="keyword">static</span> HI<span class="built_in">NSTANCE</span> hInstance;</span><br><span class="line"><span class="keyword">switch</span> (message)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> WM_CREATE:</span><br><span class="line">hInstance = ((LPCREATESTRUCT) lParam) -&amp;amp;gt; hInstance;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> WM_COMMAND:</span><br><span class="line"><span class="keyword">switch</span> (LOWORD (wParam))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> IDM_APP_ABOUT :</span><br><span class="line">DialogBox (hInstance, TEXT(&amp;quot;AboutBox&amp;quot;), hwnd, AboutDlgProc);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">case</span> WM_PAINT:</span><br><span class="line">hdc = BeginPaint (hwnd, &amp;amp;amp;ps) ;</span><br><span class="line"></span><br><span class="line">GetClientRect (hwnd, &amp;amp;amp;rect) ;</span><br><span class="line"></span><br><span class="line">DrawText (hdc, TEXT (&amp;quot;Hello, Windows <span class="number">98</span>!&amp;quot;), -<span class="number">1</span>, &amp;amp;amp;rect,</span><br><span class="line">DT_SINGLELINE | DT_CENTER | DT_VCENTER) ;</span><br><span class="line"></span><br><span class="line">EndPaint (hwnd, &amp;amp;amp;ps) ;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">PostQuitMessage (<span class="number">0</span>) ;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">BOOL</span> <span class="built_in">CALLBACK</span> AboutDlgProc(HWND hDlg, <span class="built_in">UINT</span> message, WPARAM wParam, LPARAM lParam)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">switch</span> (message)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> WM_INITDIALOG:</span><br><span class="line"><span class="keyword">return</span> <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> WM_COMMAND:</span><br><span class="line"><span class="keyword">switch</span> (LOWORD(wParam))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> IDOK:</span><br><span class="line"><span class="keyword">case</span> ID<span class="built_in">CANCEL</span>:</span><br><span class="line">EndDialog(hDlg, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">TRUE</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">FALSE</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p></p><p align="left">这里我们还是要用到菜单和资源。所以首先添加菜单资源。我们<span style="color: #ff0000;">把菜单的ID改成&#8221;MODEDIA&#8221;，</span>这里的双引号也要加上。</p>
<p>然后在菜单里添加名称为 <span style="color: #ff0000;"> help </span>的 一栏，在这栏的下拉列表里面添加 <span style="color: #ff0000;"> About&#8230;  </span>这个选项,我们将这个选项的<span style="color: #ff0000;">ID改成IDM_APP_ABOUT</span></p>
<p>然后我们添加对话框资源，确认新生成的对话框有两个按钮，分别为确定和取消，<span style="color: #ff0000;">确定按钮的ID为IDOK    取消按钮的ID为IDCANCEL</span>系统默认的名字就是这样的。我们为了以防万一检查一下。</p>
<p>最后编译运行一下，一个最简单的模态对话框就出来了。</p>
<p></p><p align="left"><strong><span style="font-size: 16px;">接下来我们来实现一下非模态对话框。</span></strong></p>
<p>其实只是创建对话框的函数不一样，整个创建对话框的工作是交给windows去完成的，不用我们操心的。</p>
<p>非模态对话框相对来说是比较常用的。下面是几个注意点，我们其实只要在模态对话框里面改进一下就可以了<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">还记得模态对话框的创建函数吗？</span><br><span class="line"></span><br><span class="line">DialogBox (hInstance, TEXT(&amp;#8220<span class="comment">;AboutBox&amp;#8221;), hwnd, AboutDlgProc;</span></span><br><span class="line"></span><br><span class="line">&lt;p align="left"&gt;下面是非模态对话框的创建函数：</span><br><span class="line"></span><br><span class="line">hDlgModeless = CreateDialog (hInstance, szTemplate, hwndParent, DialogProc)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">CreateDialog函数返回的是对话框的窗口句柄，我们把这个窗口句柄存在全&lt;span style="color: #ff0000<span class="comment">;"&gt;局变量hDlgModeless&lt;/span&gt;当中。</span></span><br><span class="line"></span><br><span class="line">而在模态对话框当中，&lt;span style="color: #ff0000<span class="comment">;"&gt;DIalogBox是直到对话框销毁后才返回值的&lt;/span&gt;。</span></span><br><span class="line"></span><br><span class="line">&lt;p align="left"&gt;接下来我们来看一下非模态对话框的样式语句：</span><br><span class="line"></span><br><span class="line">&lt;span style="color: #3366ff<span class="comment">;"&gt;STYLE WS_POPUP | WS_CAPTION | WS_SYSMENU | WS VISIBLE&lt;/span&gt;</span></span><br><span class="line"></span><br><span class="line">你可以用记事本打开你刚才编译好的模态对话框的.rc资源文件来进行对比。为了创建一个非模态的对话框，我们把样式改成上面的语句。</span><br><span class="line"></span><br><span class="line">在这里要注意最后一个样式&lt;span style="color: #ff0000<span class="comment">;"&gt;WS_VISIBLE    &lt;/span&gt;（可视的）</span></span><br><span class="line"></span><br><span class="line">如果你忘记把这个样式加入进去的话，对话框将不会显示，除非你再调用下面的语句：</span><br><span class="line"></span><br><span class="line">ShowWindow (hDlgModeless,SW_SHOW)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">来达到同样的效果。</span><br><span class="line"></span><br><span class="line">&lt;p align="left"&gt;第三个差异：&lt;span style="color: #ff0000<span class="comment">;"&gt;非模态对话框进入你的消息队列&lt;/span&gt;。所以我们应该更改消息循环：</span></span><br><span class="line"></span><br><span class="line">        while (GetMessage (&amp;amp<span class="comment">;msg, NULL, 0, 0))</span></span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">               if (hDlgModeless == 0 || !IsDialogMessage (hDlgModeless, &amp;amp<span class="comment">;msg))</span></span><br><span class="line"></span><br><span class="line">               &#123;</span><br><span class="line"></span><br><span class="line">                       TranslateMessage (&amp;amp<span class="comment">;msg) ;</span></span><br><span class="line"></span><br><span class="line">                       DispatchMessage (&amp;amp<span class="comment">;msg) ;</span></span><br><span class="line"></span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">什么时候进入消息循环呢？我们在对话框还没生成或已经销毁  hDlgModeless == 0 (这个时候的消息不是由非模态对话框产生的)</span><br><span class="line"></span><br><span class="line">或者 消息是针对非模态对话框的时候 ! IsDialogMessage (hDlgModeless, &amp;amp<span class="comment">;msg)  （这和时候的消息是由非模态对话框产生的）</span></span><br><span class="line"></span><br><span class="line">&lt;p align="left"&gt;最后的一点差异，模态对话框使用EndDialog结束，  非模态对话框使用DestroyWindow来结束。同时把hDlgModeless的全局变量设置为NULL</span><br><span class="line"></span><br><span class="line">DestroyWindow(hDlg)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">hDlgModeless = NULL<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">好了，下面就是非模态对话框的代码了：</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">#include &amp;lt<span class="comment">;windows.h&amp;gt;</span></span><br><span class="line">#include &amp;quot<span class="comment">;resource.h&amp;quot;</span></span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK WndProc (HWND, UINT, WPARAM, LPARAM) <span class="comment">;</span></span><br><span class="line">BOOL CALLBACK AboutDlgProc (HWND, UINT, WPARAM, LPARAM) <span class="comment">;</span></span><br><span class="line"></span><br><span class="line">HWND hDlgModeless<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">int WINAPI WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance,</span><br><span class="line">PSTR szCmdLine, int iCmdShow)</span><br><span class="line">&#123;</span><br><span class="line">static TCHAR szAppName[] = TEXT (&amp;quot<span class="comment">;MODEDIA&amp;quot;) ;</span></span><br><span class="line">HWND hwnd <span class="comment">;</span></span><br><span class="line">MSG msg <span class="comment">;</span></span><br><span class="line">WNDCLASS wndclass <span class="comment">;</span></span><br><span class="line"></span><br><span class="line">wndclass.style = CS_HREDRAW | CS_VREDRAW <span class="comment">;</span></span><br><span class="line">wndclass.lpfnWndProc = WndProc <span class="comment">;</span></span><br><span class="line">wndclass.cbClsExtra = 0 <span class="comment">;</span></span><br><span class="line">wndclass.cbWndExtra = 0 <span class="comment">;</span></span><br><span class="line">wndclass.hInstance = hInstance <span class="comment">;</span></span><br><span class="line">wndclass.hIcon = LoadIcon (NULL, IDI_APPLICATION) <span class="comment">;</span></span><br><span class="line">wndclass.hCursor = LoadCursor (NULL, IDC_ARROW) <span class="comment">;</span></span><br><span class="line">wndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH) <span class="comment">;</span></span><br><span class="line">wndclass.lpszMenuName = szAppName <span class="comment">;</span></span><br><span class="line">wndclass.lpszClassName = szAppName <span class="comment">;</span></span><br><span class="line"></span><br><span class="line">if (!RegisterClass (&amp;amp<span class="comment">;amp;wndclass))</span></span><br><span class="line">&#123;</span><br><span class="line">MessageBox (NULL, TEXT (&amp;quot<span class="comment">;This program requires Windows NT!&amp;quot;),</span></span><br><span class="line">szAppName, MB_ICONERROR) <span class="comment">;</span></span><br><span class="line">return 0 <span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hwnd = CreateWindow (szAppName,</span><br><span class="line">TEXT (&amp;quot<span class="comment">;A Modeless Dialog Program&amp;quot;),</span></span><br><span class="line">WS_OVERLAPPEDWINDOW,</span><br><span class="line">CW_USEDEFAULT,</span><br><span class="line">CW_USEDEFAULT,</span><br><span class="line">CW_USEDEFAULT,</span><br><span class="line">CW_USEDEFAULT,</span><br><span class="line">NULL,</span><br><span class="line">NULL,</span><br><span class="line">hInstance,</span><br><span class="line">NULL) <span class="comment">;</span></span><br><span class="line"></span><br><span class="line">ShowWindow (hwnd, iCmdShow) <span class="comment">;</span></span><br><span class="line">UpdateWindow (hwnd) <span class="comment">;</span></span><br><span class="line"></span><br><span class="line">while (GetMessage (&amp;amp<span class="comment">;amp;msg, NULL, 0, 0))</span></span><br><span class="line">&#123;</span><br><span class="line">if (hDlgModeless == 0 || !IsDialogMessage (hDlgModeless, &amp;amp<span class="comment">;amp;msg))</span></span><br><span class="line">&#123;</span><br><span class="line">TranslateMessage (&amp;amp<span class="comment">;amp;msg) ;</span></span><br><span class="line">DispatchMessage (&amp;amp<span class="comment">;amp;msg) ;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return msg.wParam <span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK WndProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span><br><span class="line">&#123;</span><br><span class="line">HDC hdc <span class="comment">;</span></span><br><span class="line">PAINTSTRUCT ps <span class="comment">;</span></span><br><span class="line">RECT rect <span class="comment">;</span></span><br><span class="line">static HINSTANCE hInstance<span class="comment">;</span></span><br><span class="line">switch (message)</span><br><span class="line">&#123;</span><br><span class="line">case WM_CREATE:</span><br><span class="line">hInstance = ((LPCREATESTRUCT) lParam) -&amp;amp<span class="comment">;gt; hInstance;</span></span><br><span class="line">return 0 <span class="comment">;</span></span><br><span class="line"></span><br><span class="line">case WM_COMMAND:</span><br><span class="line">switch (LOWORD (wParam))</span><br><span class="line">&#123;</span><br><span class="line">case IDM_APP_ABOUT :</span><br><span class="line">hDlgModeless = CreateDialog (hInstance, TEXT(&amp;quot<span class="comment">;AboutBox&amp;quot;), hwnd, AboutDlgProc);</span></span><br><span class="line">break<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">return 0<span class="comment">;</span></span><br><span class="line">case WM_PAINT:</span><br><span class="line">hdc = BeginPaint (hwnd, &amp;amp<span class="comment">;amp;ps) ;</span></span><br><span class="line"></span><br><span class="line">GetClientRect (hwnd, &amp;amp<span class="comment">;amp;rect) ;</span></span><br><span class="line"></span><br><span class="line">DrawText (hdc, TEXT (&amp;quot<span class="comment">;Hello, Windows 98!&amp;quot;), -1, &amp;amp;amp;rect,</span></span><br><span class="line">DT_SINGLELINE | DT_CENTER | DT_VCENTER) <span class="comment">;</span></span><br><span class="line"></span><br><span class="line">EndPaint (hwnd, &amp;amp<span class="comment">;amp;ps) ;</span></span><br><span class="line">return 0 <span class="comment">;</span></span><br><span class="line"></span><br><span class="line">case WM_DESTROY:</span><br><span class="line">PostQuitMessage (0) <span class="comment">;</span></span><br><span class="line">return 0 <span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">return DefWindowProc (hwnd, message, wParam, lParam) <span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL CALLBACK AboutDlgProc(HWND hDlg, UINT message, WPARAM wParam, LPARAM lParam)</span><br><span class="line">&#123;</span><br><span class="line">switch (message)</span><br><span class="line">&#123;</span><br><span class="line">case WM_INITDIALOG:</span><br><span class="line">return TRUE<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">case WM_COMMAND:</span><br><span class="line">switch (LOWORD(wParam))</span><br><span class="line">&#123;</span><br><span class="line">case IDOK:</span><br><span class="line">case IDCANCEL:</span><br><span class="line">DestroyWindow(hDlg)<span class="comment">;</span></span><br><span class="line">hDlgModeless = NULL<span class="comment">;</span></span><br><span class="line">break<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">break<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">return 0<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">资源的创建过程与上面的相同，这里就不再叙述了。</span><br><span class="line"></span><br><span class="line">现在再试一下，是不是可以移动父窗口了，呵呵~</span><br></pre></td></tr></table></figure></p>
<p></p><p align="left"><span style="font-size: 16px;"><strong>第三种方法是把对话框作为窗口，注册一个窗口类来实现</strong></span>。我下面的例子创建的是一个非模态对话框。</p>
<p>下面先上代码.cpp文件</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">#include &amp;lt<span class="comment">;windows.h&amp;gt;</span></span><br><span class="line">#include &amp;quot<span class="comment">;resource.h&amp;quot;</span></span><br><span class="line">LRESULT CALLBACK WndProc (HWND, UINT, WPARAM, LPARAM)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">int WINAPI WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance,</span><br><span class="line">PSTR szCmdLine, int iCmdShow)</span><br><span class="line">&#123;</span><br><span class="line">static TCHAR szAppName[]=TEXT (&amp;quot<span class="comment">;Dialog3&amp;quot;);</span></span><br><span class="line">HWND hwnd<span class="comment">;</span></span><br><span class="line">MSG msg<span class="comment">;</span></span><br><span class="line">WNDCLASS wndclass<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">wndclass.style = CS_HREDRAW | CS_VREDRAW<span class="comment">;</span></span><br><span class="line">wndclass.lpfnWndProc = WndProc <span class="comment">;</span></span><br><span class="line">wndclass.cbClsExtra = 0 <span class="comment">;</span></span><br><span class="line">wndclass.cbWndExtra = DLGWINDOWEXTRA <span class="comment">; // 注意这里!</span></span><br><span class="line">wndclass.hInstance = hInstance <span class="comment">;</span></span><br><span class="line">wndclass.hIcon = LoadIcon (hInstance, szAppName) <span class="comment">;</span></span><br><span class="line">wndclass.hCursor = LoadCursor (NULL, IDC_ARROW) <span class="comment">;</span></span><br><span class="line">wndclass.hbrBackground = (HBRUSH) (COLOR_BTNFACE + 1) <span class="comment">;</span></span><br><span class="line">wndclass.lpszMenuName = NULL <span class="comment">;</span></span><br><span class="line">wndclass.lpszClassName = szAppName <span class="comment">;</span></span><br><span class="line"></span><br><span class="line">if (!RegisterClass(&amp;amp<span class="comment">;amp;wndclass))</span></span><br><span class="line">&#123;</span><br><span class="line">MessageBox (NULL, TEXT(&amp;quot<span class="comment">;This program requires Windows NT!&amp;quot;),</span></span><br><span class="line">szAppName, MB_ICONERROR)<span class="comment">;</span></span><br><span class="line">return 0 <span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hwnd = CreateDialog (hInstance, szAppName, 0, NULL)<span class="comment">;//创建非模态对话框</span></span><br><span class="line"></span><br><span class="line">ShowWindow (hwnd, iCmdShow)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">while (GetMessage (&amp;amp<span class="comment">;amp;msg, NULL, 0, 0))</span></span><br><span class="line">&#123;</span><br><span class="line">TranslateMessage(&amp;amp<span class="comment">;amp;msg);</span></span><br><span class="line">DispatchMessage(&amp;amp<span class="comment">;amp;msg);</span></span><br><span class="line">&#125;</span><br><span class="line">return msg.wParam <span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK WndProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span><br><span class="line">&#123;</span><br><span class="line">switch (message)</span><br><span class="line">&#123;</span><br><span class="line">case WM_COMMAND:</span><br><span class="line">SetFocus(hwnd)<span class="comment">;</span></span><br><span class="line">switch (LOWORD (wParam))</span><br><span class="line">&#123;</span><br><span class="line">case OK:</span><br><span class="line">MessageBox(hwnd, TEXT(&amp;quot<span class="comment">;This is a demoless Dialog program&amp;quot;), TEXT(&amp;quot;OK&amp;quot;), MB_OK);</span></span><br><span class="line">return 0<span class="comment">;</span></span><br><span class="line">case CANCEL:</span><br><span class="line">return 0<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">return 0 <span class="comment">;</span></span><br><span class="line"></span><br><span class="line">case WM_DESTROY:</span><br><span class="line">PostQuitMessage (0) <span class="comment">;</span></span><br><span class="line">return 0 <span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">return DefWindowProc (hwnd, message, wParam, lParam) <span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>resource.h文件</p>
<h1 id="define_OK_1">define OK 1</h1><h1 id="define_CANCEL_2">define CANCEL 2</h1><p></p><p align="left">在源文件里面添加名为Dialog.dlg的文件（创建一个.txt的文件然后重命名）</p>
<p>Dialog3 DIALOG -1, -1, 102, 122</p>
<p>//STYLE WS_OVERLAPPED | WS_CAPTION | WS_SYSMENU | WS_MINIMIZEBOX</p>
<p>STYLE 0x00000000L | 0x00C00000L |  0x00080000L | 0x00020000L</p>
<p>CLASS &#8220;Dialog3&#8243;</p>
<p>CAPTION &#8220;Dialog3&#8243;</p>
<p>{</p>
<pre><code>PUSHBUTTON &amp;<span class="string">#8220</span>;OK&amp;<span class="string">#8221</span>;,           <span class="number">68</span>,  <span class="number">8</span>,  <span class="number">24</span>, <span class="number">30</span>, <span class="number">10</span>

PUSHBUTTON &amp;<span class="string">#8220</span>;CANCEL&amp;<span class="string">#8221</span>;,       <span class="number">65</span>,  <span class="number">8</span>,  <span class="number">40</span>, <span class="number">30</span>, <span class="number">10</span>
</code></pre><p>}</p>
<p>最后在编译生成的资源文件里面添加</p>
<h1 id="include_&#8220;Dialog3-dlg&#8221;">include &#8220;Dialog3.dlg&#8221;</h1><p></p><p align="left">第三种方法看起来比较奇怪。这到底是对话框还是窗口呢？<span style="color: #ff0000;">其实对话框就是一个窗口！！</span></p>
<p><span style="color: #000000;">下面来看一下注意点：</span></p>
<p>wndclass.cbWndExtra    = DLGWINDOWEXTRA ;    // 注意这里!</p>
<p><span style="color: #ff0000;"><span style="color: #000000;">这句告诉windows我要使用自己的窗口过程</span></span></p>
<p><span style="color: #ff0000;"><span style="color: #000000;">另外一定要注意资源文件里面<span style="color: #000000;">的</span></span></span></p>
<p>CLASS &#8220;Dialog3&#8243;</p>
<p>这句告诉windows我要使用自己的窗口过程来处理对话框消息</p>
<p>资源文件引用了Dialog.dlg，这个文件用来创建自定义的对话框</p>
<p>这里我还有2个不明白的地方：</p>
<p>//STYLE WS_OVERLAPPED | WS_CAPTION | WS_SYSMENU | WS_MINIMIZEBOX</p>
<p>STYLE 0x00000000L | 0x00C00000L |  0x00080000L | 0x00020000L我在引用STYLE的时候，直接引用编译时提示找不到定义，于是我找到样式对应的值就可以了。我不知道为什么会这样，请高手指教。</p>
<p>另外这个对话框创建出来后按钮不起作用。我也不知道是什么原因，照理来说LOWORD（wParam）存的应该是按钮的ID啊。这里也暂时留下疑问，请高手解答。</p>
<p>第二个问题已经解决了。</p>
<p>可以在编译后的资源文件里面看到生成的对话框和按钮，可以在那里设置ID,用上面的方法生成的ID是随机的。</p>
<pre><code>PUSHBUTTON &amp;<span class="string">#8220</span>;OK&amp;<span class="string">#8221</span>;,           <span class="number">68</span>,  <span class="number">8</span>,  <span class="number">24</span>, <span class="number">30</span>, <span class="number">10</span>这里的OK只不过是按钮上的文本字符串而已，并不是按钮的ID。我把这里搞混了，所以出错了。
</code></pre><p>我可以设置按钮的ID为“OK”，然后就可以了（注：一般设置按钮ID的时候我们使用ID_BTNOK，这样标准一点）</p>
<p></p><p align="left">以上是我自己总结的对话框的知识。有错误的地方，还请指教。谢谢^_^</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2012/01/23/Gentoo-Linux安装注意事项/" itemprop="url">
                Gentoo Linux安装注意事项
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-01-23T15:47:00+08:00" content="2012-01-23">
            2012-01-23
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>今天想安装个gentoo,其实以前是安装过的，但是每一次都是在 grub地方卡住了，所以这次心想趁着寒假的时间再次实践一下，把每一步都记录下来。</p>
<p>1.下载ISO镜像文件。可以从官方网站下载<a href="http://www.gentoo.org/main/en/where.xml&amp;nbsp" target="_blank" rel="external">http://www.gentoo.org/main/en/where.xml&amp;nbsp</a>; 有时候从官方网站下载起来会比较慢，163有个开源的镜像网站，也可以从那里去下&nbsp;&nbsp; 载<a href="http://mirrors.163.com/" target="_blank" rel="external">http://mirrors.163.com/</a></p>
<p>我下载的是minimal版本的，安装这个版本的步骤最复杂，也最麻烦，如果这个都能搞定，那其它版本的肯定也没问题了不是?</p>
<p>2.在安装的时候，手册肯定是必不可少的。我们就根据官网的安装手册一步步的搞下来吧^_^ </p>
<p>&nbsp;&nbsp;&nbsp; <a href="http://www.gentoo.org/doc/zh_cn/gentoo-x86-quickinstall.xml" target="_blank" rel="external">http://www.gentoo.org/doc/zh_cn/gentoo-x86-quickinstall.xml</a></p>
<p>3. 我是在虚拟机里面安装的，虚拟机的话大家可以选择virtualbox,当然wmworkstation也是一样好的。这里我选择的是wmworkstation，虚拟机里面的设置我就不详细介绍来，这个应该是比较简单的。如果你是直接装在硬盘上面的，那你可得小心了，如果没有以前安装的经验的话，还是先在虚拟机里面操练几遍再实践吧，:-)</p>
<p>4.下面打开虚拟机，我们就真正开始了！</p>
<p>&nbsp; <span style="color:#3366ff">启动</span>的时候boot有好几个选项，按F1可以查看的，gentoo-nofb，这个选项禁用帧缓冲（noframebuffer）。那么什么是帧缓冲呢？这里我给个链接大家有兴趣的可以去看一下<a href="http://blog.csdn.net/sdvch/article/details/5941067" target="_blank" rel="external">http://blog.csdn.net/sdvch/article/details/5941067</a></p>
<p>我们boot的时候一般就选这个选项了</p>
<p>&nbsp; <span style="color:#3366ff">配置网络</span>，其实这里我不是太懂的，所以也就不详细讲了，大家按照手册上面的来好了。&nbsp; 但是这里一定要强调配置网络的重要性啊！！后面下载stage3的包和portage可是全部都要用到网络的啊，其实是挺方面的，gentoo有自动搜索的，搜索到了就好办了，最后别忘了再查看一下确认网络哦～～注意哦，这一步真的非常关键哦!!!!</p>
<p>&nbsp; <span style="color:#3366ff">创建分区</span>。这里大概是个难点吧。我第一次安装的时候在这里卡了好长时间。</p>
<p>&nbsp; fdisk /dev/sda 意思是用fdisk这个磁盘分区指令（工具）来对dev/sda进行分区</p>
<p>&nbsp; 那么如何进行分区呢？手册里面是没有详细介绍的。这里就要考验你的英语水平了，按m可以取得帮助菜单。首先你把帮助菜单看一下吧，菜单里面有说的哦。</p>
<p><img src="http://hi.csdn.net/attachment/201201/23/0_1327301500hLf4.gif" alt=""></p>
<p>p是瞟一&#30524;的意思，看一看目前的分区状况是什么样子。</p>
<p>n是划分一块新地。当你输入n按回车后，系统提示你硬盘类型是primary(主分区)还是extened(扩展分区)，我们按照手册来，将3个分区全部划分为主分区。当然你也可以按照自己的喜好自己设定硬盘分区咯。</p>
<p>然后让你选择序号，默认的从1开始，一直到4.（为什么只到4呢？因为主分区加扩展分区加起来最多只能有4个哦？那为什么最多只能有4个呢？这是因为在硬盘的开头，也就是0磁头（head）、0柱（cyliner）、0面（side）、0磁道（track）、0扇区（sector）总共512字节存放着硬盘最重要的信息MBR（Master Boot Record，主引导记录）和分区的相关信息，由于记录空间只有那么大，所以也只能记录这4个分区的信息。主分区表占用64个字节，每个主分区的信息只占用16个字节，因此最多可以有四个主分区。）</p>
<p>有点跑题了，接下来选择序号好了以后第一个是初始位置大小，我们直接按回车默认，第二个是你要选择分区的大小，我们可以使用<span style="color:#ff00">&#43;2G</span>这样的命令来下达，当然你也可以使用<span style="color:#ff00">&#43;2048M</span>来达到同样的效果。同样的方法分好3个区。那么分多少合适呢？手册里面已经给了我们一个方案，一般的话可以参照下面这个分区方案</p>
<table><br><tbody><br><tr><br><td><strong>分区</strong></td><br><td><strong>文件系统</strong></td><br><td><strong>大小</strong></td><br><td><strong>说明</strong></td><br></tr><br><tr><br><td>/dev/sda1</td><br><td>ext2</td><br><td>32M</td><br><td>启动分区</td><br></tr><br><tr><br><td>/dev/sda2</td><br><td>(swap)</td><br><td>512M</td><br><td>交换分区</td><br></tr><br><tr><br><td>/dev/sda3</td><br><td>ext3</td><br><td>剩余磁盘</td><br><td>根分区</td><br></tr><br></tbody><br></table>

<p>如果你想详细了解，手册里面也是有的，另外你也可以看下面这么链接<a href="http://www.maoegg.com/gentoo-partition-scheme/" target="_blank" rel="external">http://www.maoegg.com/gentoo-partition-scheme/</a></p>
<p>分完以后，我们要改变文件系统的&#26684;式。输入<span style="color:#ff00">t</span> (change a partition&#8217;s system id )</p>
<p>我们选择2，也就是交换分区，输入id为82，你也可以输入<span style="color:#ff00">l</span> 来查看对应类型的id</p>
<p>手册里面将sda1作为boot，上图中我们看到打了*号标志，这里我们输入<span style="color:#ff00">c </span>，选择1，给sda1表示为boot</p>
<p>好了，现在我们可以输入p再次瞟一&#30524;了，如果你确定了以后，请输入<span style="color:#ff00">w</span>表示我就这么定了。记得在输入w之前都是图纸，没有保存都是无效的哦～～</p>
<p>接下来按照手册一步一步来给机器下达指令就好了，挂载文件系统应该没什么大问题。</p>
<p>接下来就是<span style="color:#3366ff">安装stage3包</span>了。</p>
<p>文档里面提供的链接貌&#20284;不太好用，这里给大家推荐两个下载地址：</p>
<p><a href="http://gentoo.osuosl.org/releases/x86/current-stage3" target="_blank" rel="external">http://gentoo.osuosl.org/releases/x86/current-stage3</a></p>
<p><a href="http://mirrors.163.com/gentoo/releases/x86/current-stage3" target="_blank" rel="external">http://mirrors.163.com/gentoo/releases/x86/current-stage3</a></p>
<p>大家可以选择links 上面的网址来选择最新的stage3进行下载，方法在手册里面有的。我使用wget的方法好像有一些问题，大家可以都试一试的，总有办法解决的嘛。</p>
<p><span style="color:#3366ff">安装portage包</span>也是一样，同样给出两个地址：</p>
<p><a href="http://mirrors.163.com/gentoo/snapshots/" target="_blank" rel="external">http://mirrors.163.com/gentoo/snapshots/</a></p>
<p><a href="http://gentoo.osuosl.org/snapshots/" target="_blank" rel="external">http://gentoo.osuosl.org/snapshots/</a></p>
<p>我个人还是推荐163的开源镜像，可能速度会快一点，呵呵</p>
<p>然后再次按照手册的步骤来，切换系统这里的命令有点长，大家在输入的时候不时的按一按<span style="color:#ff00">tab键</span>可以自动补全的，可以节省一点时间。（如果你不知道为什么按tab键可以自动补全，那么搜索一下linux shell吧）</p>
<p>最关键的一步就是<span style="color:#3366ff">配置内核</span>了，很多很多的安装错误都是因为内核配置不正确引起的。当然首先你必须了解错误的原因。</p>
<p></p><br><figure class="highlight"><figcaption><span>linux # <span class="code-input">make menuconfig</span></span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;span class=&#34;code-comment&#34;&#62;&#65288;&#37197;&#32622;&#20869;&#26680;&#65289;&#60;/span&#62;</span><br></pre></td></tr></table></figure><p></p>
<p>输入这条命令后会进入一个蓝色背景的界面（感觉有点像以前的PASCAL界面，呵呵）</p>
<p><img src="http://hi.csdn.net/attachment/201201/23/0_1327305347c79z.gif" alt=""></p>
<p>这里你可以选择你要编译的内核选项。不要心急，到这里以后还是先喝杯茶晒会太阳吧。然后用快照（snapshot）照一张，因为很有可能最后重启会出错哦。先看看下面这个链接了解下预备知识（^_^）</p>
<p></p><p></p>
<p><a href="http://apps.hi.baidu.com/share/detail/5955962" target="_blank" rel="external">http://apps.hi.baidu.com/share/detail/5955962</a></p>
<p>这里先介绍下我的一个内核配置错误：</p>
<p><img src="http://hi.csdn.net/attachment/201201/23/0_1327305928tSad.gif" alt=""></p>
<p>开机以后就卡在那里进不去了，最后查资料发现是SCSI的硬盘驱动问题，如果你也遇到了和我类&#20284;的错误，请参照下面这个链接：</p>
<p><a href="http://chen.junchang.blog.163.com/blog/static/6344519201054114356742/" target="_blank" rel="external">http://chen.junchang.blog.163.com/blog/static/6344519201054114356742/</a></p>
<p>然后打开你的快照，重新选择内核选项吧（<span style="color:#ff00">重点是Device Drivers</span> 那里哦）</p>
<p>当你把内核编译好了以后，中间的过程先跳过了，大家自己看看手册就好了，像<span style="color:#3366ff">安装系统文件</span>的话，如果你真的赶时间，可以选择以后再安装。</p>
<p>好了，终于到了<span style="color:#3366ff">配置grub</span>这一步了。这一步也是很会出错的地方。</p>
<p>首先大家在看手册的时候必须<span style="color:#ff00">保证操作时候的目录没有错误</span>，否则会像我一样连续安装了3遍都在配置grub的时候出错，最后才发现是没有切换到正确目录下面造成的。</p>
<p>这里讲一下 grub.conf范例</p>
<p></p><p></p>
<style type="text/css">
<!--
@page
    {margin:2cm}
p
    {margin-bottom:0.21cm}
-->
</style>

<style type="text/css">
<!--
@page
    {margin:2cm}
p
    {margin-bottom:0.21cm}
-->
</style>

<p><span style="font-family:Liberation Serif,serif">default0</span></p>
<p><span style="font-family:Liberation Serif,serif">timeout10</span></p>
<p><span style="font-family:Liberation Serif,serif">titleGentoo</span></p>
<p><span style="font-family:Liberation Serif,serif">root(hd0,0)</span></p>
<p><span style="font-family:Liberation Serif,serif">kernel/boot/kernel root=/dev/sda3</span></p>
<p><span style="font-family:Liberation Serif,serif"></span></p>
<p></p>
<p><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif"><strong>default</strong></span><span style="font-family:宋体,serif">-</span></span><span style="font-family:宋体; font-size:13px">默认引导的菜单条目。在本例中，默认引导第一个条目</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">Fedora(2.6.32.9-67.fc12.i686.PAE)</span></span><span style="font-family:宋体; font-size:13px">。如果将</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">default</span></span><span style="font-family:宋体; font-size:13px">的&#20540;改成</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">1,</span></span><span style="font-family:宋体; font-size:13px">则会默认引导</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">Windows7</span></span><span style="font-family:宋体; font-size:13px">。</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">**</span></span></p>
<p>**</p>
<p><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif"><strong>timeout</strong></span><span style="font-family:宋体,serif">-</span></span><span style="font-family:宋体; font-size:13px">自动选择默认引导前菜单显示的时间。本例中，如果用户没有在</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">30</span></span><span style="font-family:宋体; font-size:13px">秒之内选择操作系统，则会默认引导第一个条目</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">(</span></span><span style="font-family:宋体; font-size:13px">即</span><span style="font-size:13px">default0)</span></p>
<p><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif"><strong>splashimage</strong></span><span style="font-family:宋体,serif">-</span></span><span style="font-family:宋体; font-size:13px">指定</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">GRUB</span></span><span style="font-family:宋体; font-size:13px">引导菜单的界面风&#26684;。</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">(hd0,0)/grub/splash.xpm.gz</span></span><span style="font-family:宋体; font-size:13px">，是指在第一块硬盘的第一个分区</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">(hd0,0)</span></span><span style="font-family:宋体; font-size:13px">中，使用</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">grub</span></span><span style="font-family:宋体; font-size:13px">目录下的</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">splash.xpm.gz</span></span><span style="font-family:宋体; font-size:13px">文件作为界面风&#26684;。一般来讲，无需更改这个配置</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif"> <img src="http://miibotree.com/wp-includes/images/smilies/icon_biggrin.gif" alt=":D"> </span></span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">**</span></span></p>
<p>**</p>
<p><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif"><strong>hiddenmenu</strong></span><span style="font-family:宋体,serif">-</span></span><span style="font-family:宋体; font-size:13px">隐藏</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">GRUB</span></span><span style="font-family:宋体; font-size:13px">引导菜单。如果不想在启动时显示</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">GRUB</span></span><span style="font-family:宋体; font-size:13px">引导菜单，则删除此条目。</span></p>
<p><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif"><strong>title</strong></span><span style="font-family:宋体,serif">-</span></span><span style="font-family:宋体; font-size:13px">引导条目的名称。通常使用操作系统的名称做为标识，你可以自行更改这个名称，例如使用</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">&amp;quot;Fedora12&amp;quot;,</span></span></p>
<p> &amp;quot;Fedora&amp;quot;,<span style="font-family:宋体; font-size:13px">或者是</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">&amp;quot;MyLinux&amp;quot;</span></span><span style="font-family:宋体; font-size:13px">都可以。这个标题将显示在</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">GRUB</span></span><span style="font-family:宋体; font-size:13px">引导菜单中。</span></p>
<p><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif"><strong>root</strong></span><span style="font-family:宋体,serif">-</span></span><span style="font-family:宋体; font-size:13px">操作系统内核和引导文件所在的磁盘分区。</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">(hd0,0)</span></span><span style="font-family:宋体; font-size:13px">表示第一块硬盘的第一个分区，</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">(hd0,2)</span></span><span style="font-family:宋体; font-size:13px">表示第一块硬盘的第</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">3</span></span><span style="font-family:宋体; font-size:13px">个分区，依次类推。</span></p>
<p><span style="font-family:宋体; font-size:13px"></span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif"><strong>kernel</strong></span><span style="font-family:宋体,serif">-</span></span><span style="font-family:宋体; font-size:13px">系统内核及</span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif">boot</span></span><span style="font-family:Liberation Serif,serif; font-size:13px">命令用到的参数<span style="font-weight:bold"></span></span><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-weight:bold"></span><span style="font-family:宋体,serif">**</span></span></p>
<p>**</p>
<p><span style="font-family:Liberation Serif,serif; font-size:13px"><span style="font-family:宋体,serif"><strong>initrd</strong></span><span style="font-family:宋体,serif">-</span></span><span style="font-family:宋体; font-size:13px">系统引导程序</span></p>
<p>配置完grub以后，执行最后一组命令，reboot，好吧，接下来就是激动人心见证成败的时刻了～～～！！</p>
<p><img src="http://hi.csdn.net/attachment/201201/23/0_1327305964aPIp.gif" alt=""></p>
<p>如果失败了，请不要灰心，我自己安装gentoo已经7遍了，不过其中的很多地方还不是很理解，而且每次安装都会出现各种各样的错误。</p>
<p>最后再次申明，这篇文章只是我自己安装gentoo以后的心得，不是安装教程，也不是详解。只是把自己的错误和觉得重要的地方给大家说一下。</p>
<p>如果大家想看详细教程，可以看下面这个链接</p>
<p><a href="http://club.topsage.com/thread-2359462-1-1.html" target="_blank" rel="external">http://club.topsage.com/thread-2359462-1-1.html</a></p>
<p>上面讲的很详细。</p>
<p>另外手册里面的帮助信息也是很有用的。</p>
<p><span style="color:#3366ff">最后希望大家支持一下，谢谢^_^</span></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2012/01/20/windowsSDK利用子窗口控件设置窗口透明/" itemprop="url">
                windowsSDK利用子窗口控件设置窗口透明
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-01-20T21:36:00+08:00" content="2012-01-20">
            2012-01-20
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>在看对话框之前，还是觉得有必要先看一下子窗口控件，很多对话框的知识点都涉及到子窗口控件。</p>
<p>正好看到学长的一篇实现窗口透明化的文章，对它比较感兴趣，于是就想拿这个例子来练练手<img src="http://static.blog.csdn.net/xheditor/xheditor_emot/default/tongue.gif" alt="吐舌头"></p>
<p>首先先介绍下<span style="color:#3333ff">窗口透明化</span>的实现：</p>
<p>首先是下面这个函数</p>
<p><span style="font-family:arial,宋体,sans-serif; font-size:14px; line-height:24px">LONG SetWindowLong（HWND hWnd，int nlndex，LONG dwNewLong）；</span></p>
<p><span style="font-family:arial,宋体,sans-serif; font-size:14px; line-height:25px">SetWindowLong该函数改变指定窗口的属性．函数也将指定的一个32位&#20540;设置在窗口的额外存储空间的指定偏移位置。</span></p>
<p><span style="color:rgb(51,51,51); font-family:微软雅黑,Arial,Helvetica,sans-serif; font-size:13px; background-color:rgb(247,247,247)"></span></p>
<p><pre style="margin-top:0px; margin-bottom:20px; padding-top:0px; padding-right:5px; padding-bottom:16px; padding-left:5px; border-top-width:1px; border-right-width:1px; border-bottom-width:1px; border-left-width:15px; border-style:initial; border-color:initial; font-size:12px; vertical-align:baseline; overflow-x:auto; overflow-y:auto; width:589px; line-height:16px; color:rgb(85,85,85); font-family:微软雅黑,FixedSys; background-color:rgb(250,250,250); border-top-style:solid; border-right-style:solid; border-bottom-style:solid; border-top-color:rgb(204,204,204); border-right-color:rgb(204,204,204); border-bottom-color:rgb(204,204,204); border-left-style:solid; border-left-color:rgb(204,204,204)"><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:12px; vertical-align:baseline"> SetWindowLong(hwnd,GWL_EXSTYLE,WS_EX_LAYERED);</span><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"font-family:arial,宋体,sans-serif; font-size:14px; line-height:24px"</span>&gt;</span>上面这条代码扩展了一种窗口风&amp;#26684;，其中<span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"color:#ff0000"</span>&gt;</span>GWL_EXSTYLE设定一个新的扩展风&amp;#26684;<span class="tag">&lt;/<span class="title">span</span>&gt;</span>。<span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"font-family:arial,宋体,sans-serif; font-size:14px; line-height:24px"</span>&gt;</span>接下来我们就可以使用下面这个函数来实现窗口的透明化：<span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"font-family:arial,宋体,sans-serif; font-size:14px; line-height:24px"</span>&gt;</span>BOOL SetLayeredWindowAttributes(</span><br><span class="line"></span><br><span class="line">HWND hwnd, // handle to the layered window 透明窗体的句柄</span><br><span class="line"></span><br><span class="line">COLORREF crKey, // specifies the color key 颜色&amp;#20540;</span><br><span class="line"></span><br><span class="line">BYTE bAlpha, // value for the blend function 透明度，取&amp;#20540;范围是[0,255]</span><br><span class="line"></span><br><span class="line">DWORD dwFlags // action 透明方式，可以取两个&amp;#20540;：</span><br><span class="line"></span><br><span class="line">&amp;nbsp;);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"font-family:arial,宋体,sans-serif; font-size:14px; line-height:24px"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"font-family:arial,宋体,sans-serif; font-size:14px; line-height:24px"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"color:#ff0000"</span>&gt;</span>&amp;nbsp; 当取&amp;#20540;为LWA_ALPHA时，crKey参数无效，bAlpha参数有效；&amp;nbsp;</span><br><span class="line"></span><br><span class="line">&amp;nbsp;&amp;nbsp;当取&amp;#20540;为LWA_COLORKEY时，bAlpha参数有效，而窗体中的所有颜色为crKey的地方将变为透明。<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"color:rgb(51,51,51); font-family:微软雅黑,Arial,Helvetica,sans-serif; font-size:13px; line-height:18px; background-color:rgb(247,247,247)"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:13px; vertical-align:baseline"</span>&gt;</span>其中dwFlags有LWA_ALPHA（&amp;#20540;为2）和LWA_COLORKEY（&amp;#20540;为1）两种设置，如果LWA_ALPHA被设置的话，通过bAlpha参数指定窗体的透明度；如果LWA_COLORKEY标志被设置的话，则指定关键色为crKey，该颜色所覆盖的区域将从窗体去除，去除后的区域将不再进行点击检测，其他颜色则正常显示。如果阿尔法混合&amp;#20540;设置为0，其窗口区域同样不进行点击检测。<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"font-family:arial,宋体,sans-serif; font-size:14px; line-height:24px"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"color:rgb(51,51,51); font-family:微软雅黑,Arial,Helvetica,sans-serif; font-size:13px; line-height:18px; background-color:rgb(247,247,247)"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:13px; vertical-align:baseline"</span>&gt;</span>以上这些就是有关窗口透明度实现的方法了，好，现在我结合子窗口控件来具体实现它。代码如下：<span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"font-family:arial,宋体,sans-serif; font-size:14px; line-height:24px"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"color:rgb(51,51,51); font-family:微软雅黑,Arial,Helvetica,sans-serif; font-size:13px; line-height:18px; background-color:rgb(247,247,247)"</span>&gt;</span><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:13px; vertical-align:baseline"</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br></pre></td></tr></table></figure></pre></p>
<h1 id="include_&lt;windows-h&gt;">include &lt;windows.h&gt;</h1><h1 id="define_ID_EDIT_1_//定义编辑框ID">define ID_EDIT      1     //定义编辑框ID</h1><h1 id="define_ID_BUTTON_2_//定义确定按钮ID">define ID_BUTTON    2     //定义确定按钮ID</h1><p>LRESULT CALLBACK WndProc (HWND, UINT, WPARAM, LPARAM) ;</p>
<p>int WINAPI WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance,<br>                    PSTR szCmdLine, int iCmdShow)<br>{<br>     static TCHAR szAppName[] = TEXT (&amp;quot;HelloWin&amp;quot;) ;<br>     HWND         hwnd ;<br>     MSG          msg ;<br>     WNDCLASS     wndclass ;</p>
<pre><code>wndclass.style         = CS_HREDRAW | CS_VREDRAW <span class="comment">;</span>
wndclass.lpfnWndProc   = WndProc <span class="comment">;</span>
wndclass.cbClsExtra    = 0 <span class="comment">;</span>
wndclass.cbWndExtra    = 0 <span class="comment">;</span>
wndclass.hInstance     = hInstance <span class="comment">;</span>
wndclass.hIcon         = LoadIcon (NULL, IDI_APPLICATION) <span class="comment">;</span>
wndclass.hCursor       = LoadCursor (NULL, IDC_ARROW) <span class="comment">;</span>
wndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH) <span class="comment">;</span>
wndclass.lpszMenuName  = NULL <span class="comment">;</span>
wndclass.lpszClassName = szAppName <span class="comment">;</span>

if (!RegisterClass (&amp;amp<span class="comment">;amp;wndclass))</span>
{
     MessageBox (NULL, TEXT (&amp;amp<span class="comment">;quot;This program requires Windows NT!&amp;amp;quot;),</span>
                 szAppName, MB_ICONERROR) <span class="comment">;</span>
     return 0 <span class="comment">;</span>
}

hwnd = CreateWindow (szAppName,
                     TEXT (&amp;amp<span class="comment">;quot;The Hello Program&amp;amp;quot;),</span>
                     WS_OVERLAPPEDWINDOW,
                     CW_USEDEFAULT,
                     CW_USEDEFAULT,
                     CW_USEDEFAULT,
                     CW_USEDEFAULT,
                     NULL,
                     NULL,
                     hInstance,
                     NULL) <span class="comment">;</span>

ShowWindow (hwnd, iCmdShow) <span class="comment">;</span>
UpdateWindow (hwnd) <span class="comment">;</span>

while (GetMessage (&amp;amp<span class="comment">;amp;msg, NULL, 0, 0))</span>
{
     TranslateMessage (&amp;amp<span class="comment">;amp;msg) ;</span>
     DispatchMessage (&amp;amp<span class="comment">;amp;msg) ;</span>
}
return msg.wParam <span class="comment">;</span>
</code></pre><p>}</p>
<p>LRESULT CALLBACK WndProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)<br>{</p>
<pre><code> static HWND hwndEdit ;
 static HWND hwndButton ;
 HDC         hdc ;
 PAINTSTRUCT ps ;
 RECT        rect ;
 TCHAR         <span class="built_in">str</span>[<span class="number">20</span>];
 int         i;

 switch <span class="params">(message)</span>
 {
 case WM_CREATE:
     <span class="comment">//产生子窗口控件：编辑框</span>
     hwndEdit = CreateWindow <span class="params">(TEXT <span class="params">(&amp;amp;quot;edit&amp;amp;quot;)</span>, NULL,
         WS_CHILD | WS_VISIBLE |
         WS_BORDER | ES_LEFT |
         ES_AUTOHSCROLL | ES_AUTOVSCROLL,
         <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, hwnd, <span class="params">(HMENU)</span> ID_EDIT,
         <span class="params">(<span class="params">(LPCREATESTRUCT)</span> lParam)</span> -&amp;amp;gt; hInstance, NULL)</span> ;
     <span class="comment">//产生子窗口控件：按钮</span>
     hwndButton = CreateWindow<span class="params">(TEXT<span class="params">(&amp;amp;quot;button&amp;amp;quot;)</span>,
                                TEXT<span class="params">(&amp;amp;quot;确定&amp;amp;quot;)</span>,
                                WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON,
                                <span class="number">100</span>,<span class="number">50</span>,
                                <span class="number">50</span>,<span class="number">20</span>,
                                hwnd,<span class="params">(HMENU)</span> ID_BUTTON,
                                <span class="params">(<span class="params">(LPCREATESTRUCT)</span> lParam)</span> -&amp;amp;gt; hInstance, NULL)</span>;
      <span class="comment">//增加窗口样式</span>
      SetWindowLong<span class="params">(hwnd,GWL_EXSTYLE,WS_EX_LAYERED)</span>;
      <span class="comment">//设置窗口透明度</span>
      SetLayeredWindowAttributes<span class="params">(hwnd, RGB<span class="params">(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>)</span>, <span class="number">255</span>, LWA_ALPHA)</span>;
      return <span class="number">0</span> ;

 case WM_SETFOCUS :
     SetFocus <span class="params">(hwndEdit)</span> ;            <span class="comment">//设置输入焦点</span>
     return <span class="number">0</span> ;

 case WM_SIZE :                        <span class="comment">//创建文本框窗口大小</span>
     MoveWindow <span class="params">(hwndEdit, <span class="number">0</span>, <span class="number">0</span>, LOWORD <span class="params">(lParam)</span>/<span class="number">4</span>, HIWORD <span class="params">(lParam)</span>/<span class="number">16</span>, TRUE)</span> ;
     return <span class="number">0</span> ;

 case WM_COMMAND :
        switch <span class="params">(LOWORD <span class="params">(wParam)</span>)</span>
             case ID_BUTTON:        <span class="comment">//将从编辑框获得的数值应用到窗口透明度里面去</span>
                    {
                        GetDlgItemText<span class="params">(hwnd, ID_EDIT, str, sizeof<span class="params">(str)</span>/sizeof<span class="params">(TCHAR)</span>)</span>;
                        i = _wtoi<span class="params">(str)</span>;
                        SetLayeredWindowAttributes<span class="params">(hwnd, RGB<span class="params">(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>)</span>, i, LWA_ALPHA)</span>;
                    }
            return <span class="number">0</span>;
return <span class="number">0</span>;

 case WM_DESTROY:
      PostQuitMessage <span class="params">(<span class="number">0</span>)</span> ;
      return <span class="number">0</span> ;
 }
 return DefWindowProc <span class="params">(hwnd, message, wParam, lParam)</span> ;
</code></pre><p>}<br>```</p>
<p>在编辑框里输入0-255的任意数字，点击确定，窗口就能实现透明化的设置了。</p>
<p><span style="font-family:arial,宋体,sans-serif; font-size:14px; line-height:24px"><span style="color:rgb(51,51,51); font-family:微软雅黑,Arial,Helvetica,sans-serif; font-size:13px; line-height:18px; background-color:rgb(247,247,247)"><span style="margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; border-top-width:0px; border-right-width:0px; border-bottom-width:0px; border-left-width:0px; border-style:initial; border-color:initial; font-size:13px; vertical-align:baseline">接下来的任务我打算在看完对话框之后再用对话框实现窗口透明的效果，增加滚动条的实现，鼠标的实现，更好地理解和学习对话框<img src="http://static.blog.csdn.net/xheditor/xheditor_emot/default/smile.gif" alt="微笑"></span></span></span></p>
<p><span style="font-family:微软雅黑,Arial,Helvetica,sans-serif; font-size:13px; color:#333333"><span style="line-height:18px">我是一个新手，希望大家能帮我指出错误我好加以改正，谢谢~~</span></span></p>
<p><span style="font-family:微软雅黑,Arial,Helvetica,sans-serif; font-size:13px; color:#333333"><span style="line-height:18px"></span></span></p>
<p></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2012/01/17/fedora-16-使用LiveCD修复grub2引导/" itemprop="url">
                fedora 16 使用LiveCD修复grub2引导
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-01-17T22:10:00+08:00" content="2012-01-17">
            2012-01-17
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>我承认我这个人太贪心了<img src="http://static.blog.csdn.net/xheditor/xheditor_emot/default/wronged.gif" alt="委屈">，自从我的电脑装了fedora16变成双系统以后，竟然又对opensuse感兴趣了，结果兴冲冲的想装个三系统玩玩，但是其实我对linux方面根本不太懂啊，结果在安装的时候把opensuse的grub引导直接安装到了MBR上面，把原来fedora16的grub2引导给覆盖了，结果电脑识别不了fedora16,而且opensuse又识别不了我的无线网卡，整个就杯具了，还好学长及时出马，终于把这个问题解决了，呵呵^_^</p>
<p></p><p></p>
<p>现在的孩子都喜欢装系统，win7&#43;fedora，如果先装win7再装fedora，是蛮简单的，如果先装fedora，然后win 7，本文方法也是适用。</p>
<p>&nbsp;</p>
<p>如果LiveCD不知为何物，请百度</p>
<p>如果知LiveCD不知如何制作，请百度</p>
<p>如果做好LiveCD不知如何用其引导，请百度</p>
<p>&nbsp;</p>
<p><span style="color:#ff00ff">【为了照顾一些刚想玩fedora的奋斗青年，省去你的百度时间吧】</span></p>
<p><span style="color:#ff00ff">step1:<a href="http://fedoraproject.org/&amp;nbsp" target="_blank" rel="external">http://fedoraproject.org/&amp;nbsp</a>; 下载600多M的livecd镜像文件，首页是32位，你可以点更多下载64位</span></p>
<p><span style="color:#ff00ff">step2:<a href="https://fedorahosted.org/liveusb-creator/" target="_blank" rel="external">https://fedorahosted.org/liveusb-creator/</a> 下载liveusb的制作软件，官方的。</span></p>
<p><span style="color:#ff00ff">step3:准备一个U盘，（里面有数据也没关系，制作的时候不像pe，会把你&#26684;式化，他保留原有数据），</span></p>
<p><span style="color:#ff00ff">用那个软件选择刚才你下载好的ISO，然后选择你的U盘盘符，persistent storage 选择个100M（这个相当于</span></p>
<p><span style="color:#ff00ff">Livecd里的/home挂载点，除了这个之外的其他挂载点是不用写入的U盘的），点击creat就可以完成制作了。</span></p>
<p><span style="color:#ff00ff">step4:调整你的bios启动顺序或者现在笔记本都支持quick boot，选择U盘启动就可以了。</span></p>
<p><span style="color:#ff00ff">启动后会出现start fedora 16 ，按回车就可以进入了</span></p>
<p><span style="color:#ff00ff">【有些U盘用官方的windows版本liveusb creator制作之后会启动不了，换个U盘尝试。或者到</span></p>
<p><span style="color:#ff00ff"><a href="http://unetbootin.sourceforge.net/下载这个软件尝试】" target="_blank" rel="external">http://unetbootin.sourceforge.net/下载这个软件尝试】</a></span></p>
<p><span style="color:#3366ff">【进入之后默认是英文，如果你英文不好请单击屏幕右上角的live用户名，选择system settings，然后</span></p>
<p><span style="color:#3366ff">选择region and&nbsp; language（单击即可），在出来的对话框选中 chinese。再去右上角单击用户名，log out，</span></p>
<p><span style="color:#3366ff">注销之后会问你是否更改home下面的文件夹名字，我建议不要该成中文，因为这样你在shell里面比较麻烦】</span></p>
<p>用LiveCD启动之后，首先应该明确的是你的fedora装在哪个分区，现在的硬盘都应该是sata的吧，那么就对应</p>
<p>/dev/sdax，x是个数字，1~4表示主分区，5开始是逻辑分区。如果你在可伶的用着IDE硬盘，那么就对应/dev/hdax</p>
<p>打开你的磁盘实用工具，或者叫Disk unity,找到fedora安装所在分区，我的在sda10，所以下面就拿这个说明了。。</p>
<div><br><div id="highlighter_656609" class="syntaxhighlighter  bash"><br><table border="0" cellpadding="0" cellspacing="0"><br><tbody><br><tr><br><td class="gutter"><br><div class="line number1 index0 alt2">1</div><br><div class="line number2 index1 alt1">2</div><br></td><br><td class="code"><br><div class="container"><br><div class="line number1 index0 alt2"><code>su</code></div><br><div class="line number2 index1 alt1"><code>mount</code> <code>-t ext4 -o rw ``/dev/sda10</code>&nbsp;&nbsp; <code>/media</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div>

<p>把fedora的安装分区挂载到当前的LiveCD文件系统下，当然如果你比较偷懒的话，比如我：）,直接在文件管理器里面双击</p>
<p>一下那个分区，然后就会在/media/_FEDORA__*_ 下挂载了</p>
<p>原来安装在硬盘上的fedora只是把文件目录挂上来了，一点硬件资源也木有，啥事也干不了，只能用来copy/paste一下数据，</p>
<p>现在把当前系统的资源给他</p>
<div><br><div id="highlighter_77519" class="syntaxhighlighter  bash"><br><table border="0" cellpadding="0" cellspacing="0"><br><tbody><br><tr><br><td class="gutter"><br><div class="line number1 index0 alt2">1</div><br><div class="line number2 index1 alt1">2</div><br><div class="line number3 index2 alt2">3</div><br><div class="line number4 index3 alt1">4</div><br><div class="line number5 index4 alt2">5</div><br></td><br><td class="code"><br><div class="container"><br><div class="line number1 index0 alt2"><code>su</code></div><br><div class="line number2 index1 alt1"><code>mount</code> <code>-t proc none ``/media/proc</code></div><br><div class="line number3 index2 alt2"><code>mount</code> <code>-o bind ``/dev</code> <code>/media/dev</code></div><br><div class="line number4 index3 alt1"><code>mount</code> <code>-o bind ``/sys</code> <code>/media/sys</code></div><br><div class="line number5 index4 alt2"><code>mount</code> <code>-t devpts devpts ``/media/dev/pts</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div>

<p>特别看清楚上面的指令，千万别把 /dev 写成了/dev/,如果这样就会出现</p>
<p>/dev is not a block device了</p>
<p>挂完后用chroot命令切换到原来的fedora中去</p>
<p>&nbsp;</p>
<div><br><div id="highlighter_295476" class="syntaxhighlighter  bash"><br><table border="0" cellpadding="0" cellspacing="0"><br><tbody><br><tr><br><td class="gutter"><br><div class="line number1 index0 alt2">1</div><br><div class="line number2 index1 alt1">2</div><br><div class="line number3 index2 alt2">3</div><br></td><br><td class="code"><br><div class="container"><br><div class="line number1 index0 alt2"><code>su</code></div><br><div class="line number2 index1 alt1"><code>chroot ``/media</code></div><br><div class="line number3 index2 alt2"><code>grub2-``install</code><br><br><code>/dev/sda</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div>

<p>当然上述指令是讲grub2安装到硬盘MBR上恢复引导，如果你想装在当前分区中让其他软件来引导就应该是</p>
<p>grub2-install /dev/sda10</p>
<p>OK，做下扫尾工作</p>
<p>&nbsp;</p>
<div><br><div id="highlighter_300013" class="syntaxhighlighter  bash"><br><table border="0" cellpadding="0" cellspacing="0"><br><tbody><br><tr><br><td class="gutter"><br><div class="line number1 index0 alt2">1</div><br><div class="line number2 index1 alt1">2</div><br><div class="line number3 index2 alt2">3</div><br><div class="line number4 index3 alt1">4</div><br><div class="line number5 index4 alt2">5</div><br><div class="line number6 index5 alt1">6</div><br><div class="line number7 index6 alt2">7</div><br></td><br><td class="code"><br><div class="container"><br><div class="line number1 index0 alt2"><code>exit</code></div><br><div class="line number2 index1 alt1"><code>umount</code> <code>/media/proc</code></div><br><div class="line number3 index2 alt2"><code>umount</code> <code>/media/dev/pts</code></div><br><div class="line number4 index3 alt1"><code>umount</code> <code>/media/sys</code></div><br><div class="line number5 index4 alt2"><code>umount</code> <code>/media/dev</code></div><br><div class="line number6 index5 alt1"><code>umount</code> <code>/media</code></div><br><div class="line number7 index6 alt2"><code>reboot</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div>

<p>当然，上述修复的grub是原来的grub，opensuse没了，其实grub2很强大，能自动识别n多系统，只需重新生成配置</p>
<p>文件即可。</p>
<div><br><div id="highlighter_893145" class="syntaxhighlighter  bash"><br><table border="0" cellpadding="0" cellspacing="0"><br><tbody><br><tr><br><td class="gutter"><br><div class="line number1 index0 alt2">1</div><br><div class="line number2 index1 alt1">2</div><br><div class="line number3 index2 alt2">3</div><br></td><br><td class="code"><br><div class="container"><br><div class="line number1 index0 alt2"><code>su</code></div><br><div class="line number2 index1 alt1"><code>grub2-mkconfig&amp;nbsp; -o&amp;nbsp;

``/boot/grub2/grub``.cfg</code></div><br><div class="line number3 index2 alt2"><code>reboot</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div>

<p>congratulations</p>
<p><span style="color:#0000cd">今天在帮别人修复的时候，又遇到一些问题，写下来分享</span></p>
<p>首先：这台电脑的分区并不是我上面写的简单的一个 / 分区，用的LVM和一个boot分区(sda8)，那么在挂载的时候就要分别挂载了。在LVM里有一个 root的逻辑卷组和一个swap卷组，位于/dev/mapper/vg_fedora_root，和/dev/mapper/vg_fedora_swap（这个的取名是自己定义的，如果采用系统自己默认的分区安装，不是手动的话，名字不同)</p>
<p>&nbsp;</p>
<div><br><div id="highlighter_663830" class="syntaxhighlighter  bash"><br><table border="0" cellpadding="0" cellspacing="0"><br><tbody><br><tr><br><td class="gutter"><br><div class="line number1 index0 alt2">1</div><br><div class="line number2 index1 alt1">2</div><br><div class="line number3 index2 alt2">3</div><br></td><br><td class="code"><br><div class="container"><br><div class="line number1 index0 alt2"><code>su</code></div><br><div class="line number2 index1 alt1"><code>mount</code> <code>-o rw&amp;nbsp; ``/dev/mapper/vg_fedora_root</code>&nbsp;&nbsp; <code>/media</code></div><br><div class="line number3 index2 alt2"><code>mount</code> <code>-o rw ``/dev/sda8</code>&nbsp; <code>/media/boot</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div>

<p>然后挂载上述写的资源。</p>
<p>其次：在执行grub2-install 的时候，遇到错误</p>
<div><br><div id="highlighter_471574" class="syntaxhighlighter  bash"><br><table border="0" cellpadding="0" cellspacing="0"><br><tbody><br><tr><br><td class="gutter"><br><div class="line number1 index0 alt2">1</div><br><div class="line number2 index1 alt1">2</div><br><div class="line number3 index2 alt2">3</div><br><div class="line number4 index3 alt1">4</div><br></td><br><td class="code"><br><div class="container"><br><div class="line number1 index0 alt2"><code>[root@Fedora sunhao]``# grub2-install /dev/sda</code></div><br><div class="line number2 index1 alt1"><code>/sbin/grub2-setup``: warn: Your embedding area is unusually small.&amp;nbsp; core.img won&#39;t fit

``in</code> <code>it..</code></div><br><div class="line number3 index2 alt2"><code>/sbin/grub2-setup``: warn: Embedding is not possible.&amp;nbsp; GRUB can only be installed

``in</code> <code>this setup by using blocklists.&amp;nbsp; However, blocklists are UNRELIABLE and their use is discouraged..</code></div><br><div class="line number4 index3 alt1"><code>/sbin/grub2-setup``: error: will not proceed with blocklists.</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div>

<p>网上查的是mbr和sda1之间的那块embedding area太小了，应该是默认的63，如果是32的话会出现这个问题，但是我执行fdisk&nbsp; -lu,显示这电脑已经是63了，不明原因。</p>
<p>google了一把，没找到解决方案还是安装不上去，后来我在wiki上面，看到了这个用法，强制安装。</p>
<div><br><div id="highlighter_686990" class="syntaxhighlighter  bash"><br><table border="0" cellpadding="0" cellspacing="0"><br><tbody><br><tr><br><td class="gutter"><br><div class="line number1 index0 alt2">1</div><br></td><br><td class="code"><br><div class="container"><br><div class="line number1 index0 alt2"><code>grub2-``install</code>&nbsp;<br><br><code>--force&amp;nbsp; ``/dev/sda</code></div><br></div><br></td><br></tr><br></tbody><br></table><br></div><br></div>

<p>竟然可以装上去，并且成功启动～</p>
<p>我只是想推广一下学长的这篇技术博客，想分享给喜欢玩linux的朋友，希望大家支持哦</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2012/01/16/windowsSDK加速键实例分析/" itemprop="url">
                windowsSDK加速键实例分析
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-01-16T21:01:00+08:00" content="2012-01-16">
            2012-01-16
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>今天在看windows程序设计菜单里面的加速键，看了好几遍才勉强看懂，下面来解释一下书本里面的代码：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">#include &amp;lt;windows.h&amp;gt;</span><br><span class="line">#include &amp;quot;resource.h&amp;quot;</span><br><span class="line"></span><br><span class="line">#define ID_EDIT     <span class="number">1</span></span><br><span class="line"></span><br><span class="line">LRESULT <span class="function">CALLBACK <span class="title">WndProc</span> <span class="params">(HWND, UINT, WPARAM, LPARAM)</span></span>;</span><br><span class="line"></span><br><span class="line">TCHAR szAppName[] = TEXT (&amp;amp;quot;PopPad2&amp;amp;quot;) ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> <span class="function">WINAPI <span class="title">WinMain</span> <span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance,</span><br><span class="line">                    PSTR szCmdLine, <span class="keyword">int</span> iCmdShow)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">     HACCEL   hAccel ;                  <span class="comment">//定义加速键表的句柄</span></span><br><span class="line">     HWND     hwnd ;</span><br><span class="line">     MSG      msg ;</span><br><span class="line">     WNDCLASS wndclass ;</span><br><span class="line"></span><br><span class="line">     wndclass.style         = CS_HREDRAW | CS_VREDRAW ;</span><br><span class="line">     wndclass.lpfnWndProc   = WndProc ;</span><br><span class="line">     wndclass.cbClsExtra    = <span class="number">0</span> ;</span><br><span class="line">     wndclass.cbWndExtra    = <span class="number">0</span> ;</span><br><span class="line">     wndclass.hInstance     = hInstance ;</span><br><span class="line">     wndclass.hIcon         = LoadIcon (hInstance, szAppName) ;</span><br><span class="line">     wndclass.hCursor       = LoadCursor (NULL, IDC_ARROW) ;</span><br><span class="line">     wndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH) ;</span><br><span class="line">     wndclass.lpszMenuName  = szAppName ;</span><br><span class="line">     wndclass.lpszClassName = szAppName ;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (!RegisterClass (&amp;amp;amp;wndclass))</span><br><span class="line">     &#123;</span><br><span class="line">          MessageBox (NULL, TEXT (&amp;amp;quot;This program requires Windows NT!&amp;amp;quot;),</span><br><span class="line">                      szAppName, MB_ICONERROR) ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     hwnd = CreateWindow (szAppName, szAppName,</span><br><span class="line">                          WS_OVERLAPPEDWINDOW,</span><br><span class="line">                          GetSystemMetrics (SM_CXSCREEN) / <span class="number">4</span>,     <span class="comment">//创建窗口的大小设定</span></span><br><span class="line">                          GetSystemMetrics (SM_CYSCREEN) / <span class="number">4</span>,</span><br><span class="line">                          GetSystemMetrics (SM_CXSCREEN) / <span class="number">2</span>,</span><br><span class="line">                          GetSystemMetrics (SM_CYSCREEN) / <span class="number">2</span>,</span><br><span class="line">                          NULL, NULL, hInstance, NULL) ;</span><br><span class="line"></span><br><span class="line">     ShowWindow (hwnd, iCmdShow) ;</span><br><span class="line">     UpdateWindow (hwnd) ;</span><br><span class="line"></span><br><span class="line">     hAccel = LoadAccelerators (hInstance, szAppName) ;			 <span class="comment">//加载到内存中并获得句柄</span></span><br><span class="line"></span><br><span class="line">     <span class="keyword">while</span> (GetMessage (&amp;amp;amp;msg, NULL, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">     &#123;</span><br><span class="line">          <span class="keyword">if</span> (!TranslateAccelerator (hwnd, hAccel, &amp;amp;amp;msg))		<span class="comment">//如果msg中的消息是键盘消息，那么函数在加速建表中寻找句柄为hAccel的匹配值，调用句柄为hwnd的窗口过程</span></span><br><span class="line">          &#123;</span><br><span class="line">               TranslateMessage (&amp;amp;amp;msg) ;</span><br><span class="line">               DispatchMessage (&amp;amp;amp;msg) ;</span><br><span class="line">          &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> msg.wParam ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AskConfirmation (HWND hwnd)</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">return</span> MessageBox (hwnd, TEXT (&amp;amp;quot;Really want to close PopPad2?&amp;amp;quot;),</span><br><span class="line">                        szAppName, MB_YESNO | MB_ICONQUESTION) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LRESULT <span class="function">CALLBACK <span class="title">WndProc</span> <span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">     <span class="keyword">static</span> HWND hwndEdit ;				<span class="comment">//子窗口控件编辑框的句柄</span></span><br><span class="line">     <span class="keyword">int</span>         iSelect, iEnable ;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">switch</span> (message)</span><br><span class="line">     &#123;</span><br><span class="line">     <span class="keyword">case</span> WM_CREATE:</span><br><span class="line">          hwndEdit = CreateWindow (TEXT (&amp;amp;quot;edit&amp;amp;quot;), NULL,</span><br><span class="line">                              WS_CHILD | WS_VISIBLE | WS_HSCROLL | WS_VSCROLL |</span><br><span class="line">                              WS_BORDER | ES_LEFT | ES_MULTILINE |</span><br><span class="line">                              ES_AUTOHSCROLL | ES_AUTOVSCROLL,</span><br><span class="line">                              <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, hwnd, (HMENU) ID_EDIT,</span><br><span class="line">                              ((LPCREATESTRUCT) lParam)-&amp;amp;gt;hInstance, NULL) ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">case</span> WM_SETFOCUS:</span><br><span class="line">          SetFocus (hwndEdit) ;						<span class="comment">//设置焦点给子窗口控件</span></span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">case</span> WM_SIZE:</span><br><span class="line">          MoveWindow (hwndEdit, 0, 0, LOWORD (lParam), HIWORD (lParam), TRUE) ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">case</span> WM_INITMENUPOPUP:							//关键部分</span><br><span class="line">          <span class="keyword">if</span> (lParam == 1)</span><br><span class="line">          &#123;</span><br><span class="line">               EnableMenuItem ((HMENU) wParam, IDM_EDIT_UNDO,</span><br><span class="line">                    SendMessage (hwndEdit, EM_CANUNDO, <span class="number">0</span>, <span class="number">0</span>) ?</span><br><span class="line">                                   MF_ENABLED : MF_GRAYED) ;</span><br><span class="line"></span><br><span class="line">               EnableMenuItem ((HMENU) wParam, IDM_EDIT_PASTE,</span><br><span class="line">                    IsClipboardFormatAvailable (CF_TEXT) ?</span><br><span class="line">                                   MF_ENABLED : MF_GRAYED) ;</span><br><span class="line"></span><br><span class="line">               iSelect = SendMessage (hwndEdit, EM_GETSEL, <span class="number">0</span>, <span class="number">0</span>) ;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span> (HIWORD (iSelect) == LOWORD (iSelect))</span><br><span class="line">                    iEnable = MF_GRAYED ;</span><br><span class="line">               <span class="keyword">else</span></span><br><span class="line">                    iEnable = MF_ENABLED ;</span><br><span class="line"></span><br><span class="line">               EnableMenuItem ((HMENU) wParam, IDM_EDIT_CUT,   iEnable) ;</span><br><span class="line">               EnableMenuItem ((HMENU) wParam, IDM_EDIT_COPY,  iEnable) ;</span><br><span class="line">               EnableMenuItem ((HMENU) wParam, IDM_EDIT_CLEAR, iEnable) ;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span> ;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">          <span class="keyword">if</span> (lParam)</span><br><span class="line">          &#123;</span><br><span class="line">               <span class="keyword">if</span> (LOWORD (lParam) == ID_EDIT &amp;amp;amp;&amp;amp;amp;</span><br><span class="line">                         (HIWORD (wParam) == EN_ERRSPACE ||</span><br><span class="line">                          HIWORD (wParam) == EN_MAXTEXT))</span><br><span class="line">                    MessageBox (hwnd, TEXT (&amp;amp;quot;Edit control out of space.&amp;amp;quot;),</span><br><span class="line">                                szAppName, MB_OK | MB_ICONSTOP) ;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">switch</span> (LOWORD (wParam))</span><br><span class="line">          &#123;</span><br><span class="line">          <span class="keyword">case</span> IDM_FILE_NEW:</span><br><span class="line">          <span class="keyword">case</span> IDM_FILE_OPEN:</span><br><span class="line">          <span class="keyword">case</span> IDM_FILE_SAVE:</span><br><span class="line">          <span class="keyword">case</span> IDM_FILE_SAVE_AS:</span><br><span class="line">          <span class="keyword">case</span> IDM_FILE_PRINT:</span><br><span class="line">               MessageBeep (0) ;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> IDM_APP_EXIT:</span><br><span class="line">               SendMessage (hwnd, WM_CLOSE, 0, 0) ;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> IDM_EDIT_UNDO:</span><br><span class="line">               SendMessage (hwndEdit, WM_UNDO, 0, 0) ;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> IDM_EDIT_CUT:</span><br><span class="line">               SendMessage (hwndEdit, WM_CUT, 0, 0) ;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> IDM_EDIT_COPY:</span><br><span class="line">               SendMessage (hwndEdit, WM_COPY, 0, 0) ;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> IDM_EDIT_PASTE:</span><br><span class="line">               SendMessage (hwndEdit, WM_PASTE, 0, 0) ;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> IDM_EDIT_CLEAR:</span><br><span class="line">               SendMessage (hwndEdit, WM_CLEAR, 0, 0) ;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> IDM_EDIT_SELECT_ALL:</span><br><span class="line">               SendMessage (hwndEdit, EM_SETSEL, 0, -1) ;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> IDM_HELP_HELP:</span><br><span class="line">               MessageBox (hwnd, TEXT (&amp;amp;quot;Help not yet implemented!&amp;amp;quot;),</span><br><span class="line">                           szAppName, MB_OK | MB_ICONEXCLAMATION) ;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> IDM_APP_ABOUT:</span><br><span class="line">               MessageBox (hwnd, TEXT (&amp;amp;quot;POPPAD2 (c) Charles Petzold, <span class="number">1998</span>&amp;amp;quot;),</span><br><span class="line">                           szAppName, MB_OK | MB_ICONINFORMATION) ;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span> ;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">case</span> WM_CLOSE:</span><br><span class="line">          <span class="keyword">if</span> (IDYES == AskConfirmation (hwnd))</span><br><span class="line">               DestroyWindow (hwnd) ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">case</span> WM_QUERYENDSESSION:</span><br><span class="line">          <span class="keyword">if</span> (IDYES == AskConfirmation (hwnd))</span><br><span class="line">               <span class="keyword">return</span> 1 ;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">          PostQuitMessage (0) ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="function"><span class="keyword">return</span> <span class="title">DefWindowProc</span> <span class="params">(hwnd, message, wParam, lParam)</span> </span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个程序实现了一个简单的记事本功能，在EDIT菜单下能实现撤销(UNDO)，剪切(CUT)，复制(COPY)，粘贴(PASTE)，删除(DELETE)，全选(SELECT ALL)这些功能</p>
<p>关键部分是下面的代码:</p>
<p></p><br><figure class="highlight openscad"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">case WM_INITMENUPOPUP:</span><br><span class="line">          <span class="keyword">if</span> <span class="params">(lParam == <span class="number">1</span>)</span></span><br><span class="line">          &#123;</span><br><span class="line">               EnableMenuItem <span class="params">(<span class="params">(HMENU)</span> wParam, IDM_EDIT_UNDO,</span><br><span class="line">                    SendMessage <span class="params">(hwndEdit, EM_CANUNDO, <span class="number">0</span>, <span class="number">0</span>)</span> ?</span><br><span class="line">                                   MF_ENABLED : MF_GRAYED)</span> ;</span><br><span class="line"></span><br><span class="line">               EnableMenuItem <span class="params">(<span class="params">(HMENU)</span> wParam, IDM_EDIT_PASTE,</span><br><span class="line">                    IsClipboardFormatAvailable <span class="params">(CF_TEXT)</span> ?</span><br><span class="line">                                   MF_ENABLED : MF_GRAYED)</span> ;</span><br><span class="line"></span><br><span class="line">               iSelect = SendMessage <span class="params">(hwndEdit, EM_GETSEL, <span class="number">0</span>, <span class="number">0</span>)</span> ;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span> <span class="params">(HIWORD <span class="params">(iSelect)</span> == LOWORD <span class="params">(iSelect)</span>)</span></span><br><span class="line">                    iEnable = MF_GRAYED ;</span><br><span class="line">               <span class="keyword">else</span></span><br><span class="line">                    iEnable = MF_ENABLED ;</span><br><span class="line"></span><br><span class="line">               EnableMenuItem <span class="params">(<span class="params">(HMENU)</span> wParam, IDM_EDIT_CUT,   iEnable)</span> ;</span><br><span class="line">               EnableMenuItem <span class="params">(<span class="params">(HMENU)</span> wParam, IDM_EDIT_COPY,  iEnable)</span> ;</span><br><span class="line">               EnableMenuItem <span class="params">(<span class="params">(HMENU)</span> wParam, IDM_EDIT_CLEAR, iEnable)</span> ;</span><br><span class="line">               return <span class="number">0</span> ;</span><br><span class="line">          &#125;</span><br><span class="line">          break ;</span><br></pre></td></tr></table></figure><p></p>
<p>现在我们就来具体分析一下吧^_^</p>
<p>一开始我不太明白WM_INITMENUPOPUP消息的意思，所以我查了下字典，init是初始化的意思，popup上次说过了是弹出的意思。</p>
<p>然后参考了一些资料：</p>
<p><span style="color:#3333FF">WM_INITMENUPOPUP消息在下拉菜单或子菜单</span><span style="color:#3333FF"><span style="color:#FF6666">将要被激活的时候</span>发出.如果没有替换整个菜单,</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;允许这个应用程序在菜单显示之前进行修改,</p>
<p><span style="color:#3333FF"></span></p>
<p>hmenuPopup = (HMENU) wParam;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //子菜单句柄</p>
<p>uPos = (UINT) LOWORD(lParam);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 子菜单项位置</p>
<p>fSystemMenu = (BOOL) HIWORD(lParam); // 窗体菜单(系统菜单)标记</p>
<p></p><p></p>
<p><span style="color:#3333FF">参数</span></p>
<p>hmenuPopup&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wParam&#20540;.下拉菜单或子菜单的句柄</p>
<p>uPos&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lParam低次序字的&#20540;.指定一个打开的下拉菜单或子菜单在菜单项中基于0相关联的位置</p>
<p><span style="color:#3333FF">fSystemMenu&nbsp;</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lParam高次序字的&#20540;.指定是否下拉菜单是窗体菜单(同样大家知道的系统菜单或控制菜单),如果菜单是窗体菜单,</p>
<p><span style="color:#3333FF">&nbsp;&nbsp;&nbsp;&nbsp;这个参数是TRUE,否则它是FALSE;</span></p>
<p><span style="color:#3333FF">返回&#20540;:</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;如果一个应用程序处理这个消息,它将要返回0</p>
<p>有了资料以后，我们就能理解了，为什么要处理这个消息呢？其实这个消息的处理正是EDIT下面的选项能执行的关键所在，下面具体来看看吧</p>
<p>if (lParam == 1)<br><br>指定当菜单项为第1项的时候触发，因为最前面的是第0项，所以EDIT就是第一项了。<br><br><figure class="highlight"><figcaption><span>((HMENU) wParam, IDM_EDIT_UNDO,</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SendMessage (hwndEdit, EM_CANUNDO, 0, 0) ?&#10;               MF_ENABLED : MF_GRAYED) ;</span><br></pre></td></tr></table></figure><br><br></p><p>接下来我们碰到了EnableMenuItem这个函数，同样不知道我查了下资料如下<br><br><span style="color:#3333FF">允许或禁止指定的菜单条目 　　BOOL EnableMenuItem(HMENU hMenu,UINT uIDEnableItem, UINT uEnable);　　</span><br><br><span style="color:#3333FF">返回&#20540; ： BOOL 判断是否成功　　</span><br><br><span style="color:#3333FF">hMenu ，菜单句柄 　　</span><br><br><span style="color:#3333FF">uIDEnableItem ，欲允许或禁止的一个菜单条目的标识符。</span><br><br><span style="color:#3333FF">uEnable ，参考ModifyMenu函数中的菜单常数标志定义表，其中列出了允许使用的所有常数。对于这个函数，只能指定下述常数：MF_BYCOMMAND，MF_BYPOSITION，MF_ENABLED，MF_DISABLED以及MF_GRAYED</span><br><br><span style="color:#3333FF">MF_BYCOMMAND 指定参数给出已存在的菜单项的命令ID号。此为缺省&#20540;。　　·<br><br></span><br><br><span style="color:#3333FF">MF_BYPOSITION 指定参数给出已存在菜单项的位置。第一项所在的位置是0。　　·<br><br></span><br><br><span style="color:#3333FF">MF_DISABLED 使菜单项无效，以便它不能被选择，但不变灰。 　　·<br><br></span><br><br><span style="color:#3333FF">MF_ENABLED 使菜单项有效，以便它能够被选择，并可从变灰的状态中恢复出来。 　　·<br><br></span><br><br><span style="color:#3333FF">MF_GRAYED 使菜单项无效，以便它不能被选择并同时变灰。　</span>　<br><br>有了资料以后我们再来理解一下上面的代码：<br><br>第1个参数自然就是菜单的句柄了，第二个参数就是确定ID了，第三个参数用了一个简化的if条件语句判断，发送EM_CANUNDO给编辑控件，如果可以执行撤销（UNDO）操作，那么SendMessage返回非0&#20540;，同时这个选项启用，否则变灰色。<br><br></p><p>[/c] EnableMenuItem ((HMENU) wParam, IDM_EDIT_PASTE,<br><br>                    IsClipboardFormatAvailable (CF_TEXT) ?<br><br>                                   MF_ENABLED : MF_GRAYED) ;[/c]这几行代码与上面的几行类&#20284;，只不过条件语句里面换了个函数&nbsp; IsClipboardFormatAvailable，这个函数我们中文翻译一下，clipboard是剪切板的意思，所以函数的意思就是“剪切板里面有可用得东西吗？”并且用CF_TEXT来检测<br><br><figure class="highlight"><figcaption><span>= SendMessage (hwndEdit, EM_GETSEL, 0, 0) ;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (HIWORD (iSelect) == LOWORD (iSelect))&#10;                    iEnable = MF_GRAYED ;&#10;               else&#10;                    iEnable = MF_ENABLED ;</span><br></pre></td></tr></table></figure><br><br></p><p>书里面说，发送EM_SEL消息后在iSelect里面的低字位保存了<span style="color:#FF0000">第一个被选中字符的位置</span>，高字位是<span style="color:#FF0000">紧随选中文本后面的第一个字符的位置</span><br><br>如果相等，那么文本没有被选中。<br><br>这里我不是很理解，如果文本没有被选中的话，那么iSelect里面的低字位和高字位是文本的第一个字符吗？那么如果文本是空的话又是怎么实现的呢？这个问题请高手帮忙解答啊~~<br><br>接着如果选中了，那么iEnable 里面存放MF_ENABLED,&nbsp;&nbsp; 如果没有选中，那么存放的是MF_GRAYED。<br><br></p><br><figure class="highlight"><figcaption><span>((HMENU) wParam, IDM_EDIT_CUT,   iEnable) ;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EnableMenuItem ((HMENU) wParam, IDM_EDIT_COPY,  iEnable) ;&#10;EnableMenuItem ((HMENU) wParam, IDM_EDIT_CLEAR, iEnable) ;&#10;&#10;&#26368;&#21518;iEnable&#29992;&#20110;&#19977;&#20010;&#33756;&#21333;&#39033;&#30446;EnableMenuItem&#30340;&#31532;&#19977;&#20010;&#21442;&#25968;&#12290;</span><br></pre></td></tr></table></figure><br><br><p></p>

<p>好吧，理解了关键部分的代码之后，这个程序应该就能看懂了吧，呵呵~~~~</p>
<p>参考文献</p>
<p>windows程序设计</p>
<p>百度百科<a href="http://baike.baidu.com/view/1294033.htm" target="_blank" rel="external">http://baike.baidu.com/view/1294033.htm</a></p>
<p><a href="http://blog.csdn.net/yingzheng1983/article/details/3135818" target="_blank" rel="external">http://blog.csdn.net/yingzheng1983/article/details/3135818</a>嬴政</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2012/01/15/windowsSDK-菜单资源浅谈/" itemprop="url">
                windowsSDK 菜单资源浅谈
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-01-15T14:57:00+08:00" content="2012-01-15">
            2012-01-15
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>这几天在看菜单，今天自己动手写了一下，出现了一些错误。</p>
<p>首先我先自己简单的写了一个只包含菜单资源的文件：</p>
<figure class="highlight"><figcaption><span>&lt;windows.h&gt;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &#38;lt;resource.h&#38;gt;&#10;&#10;LRESULT CALLBACK WndProc (HWND, UINT, WPARAM, LPARAM) ;&#10;&#10;//TCHAR szAppName[] = TEXT (&#38;amp;quot;ownmenu&#38;amp;quot;) ;      (&#25913;&#36827;&#21518;&#21152;&#30340;&#20195;&#30721;)&#10;TCHAR MenuName[] = TEXT(&#38;amp;quot;IDR_MENU1&#38;amp;quot;);&#10;&#10;int WINAPI WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance,&#10;                    PSTR szCmdLine, int iCmdShow)&#10;&#123;&#10;     HWND     hwnd ;&#10;     MSG      msg ;&#10;     WNDCLASS wndclass ;&#10;&#10;     wndclass.style         = CS_HREDRAW | CS_VREDRAW ;&#10;     wndclass.lpfnWndProc   = WndProc ;&#10;     wndclass.cbClsExtra    = 0 ;&#10;     wndclass.cbWndExtra    = 0 ;&#10;     wndclass.hInstance     = hInstance ;&#10;     wndclass.hIcon         = LoadIcon (NULL, IDI_APPLICATION) ;&#10;     wndclass.hCursor       = LoadCursor (NULL, IDC_ARROW) ;&#10;     wndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH) ;&#10;&#38;amp;nbsp;  //wndclass.lpszMenuName  = MenuName ;        &#65288;&#25913;&#36827;&#21518;&#21152;&#20837;&#30340;&#20195;&#30721;&#65289;&#10;     wndclass.lpszMenuName  = szAppName;       //&#31243;&#24207;&#21517;&#31216;&#21644;&#33756;&#21333;&#21517;&#31216;&#26159;&#19968;&#26679;&#30340;&#10;     wndclass.lpszClassName = szAppName ;&#10;&#10;     if (!RegisterClass (&#38;amp;amp;wndclass))&#10;     &#123;&#10;          MessageBox (NULL, TEXT (&#38;amp;quot;This program requires Windows NT!&#38;amp;quot;),&#10;                      szAppName, MB_ICONERROR) ;&#10;          return 0 ;&#10;     &#125;&#10;&#10;     hwnd = CreateWindow (szAppName, TEXT (&#38;amp;quot;Menu Demonstration&#38;amp;quot;),&#10;                          WS_OVERLAPPEDWINDOW,&#10;                          CW_USEDEFAULT, CW_USEDEFAULT,&#10;                          CW_USEDEFAULT, CW_USEDEFAULT,&#10;                          NULL, NULL, hInstance, NULL) ;&#10;&#10;     ShowWindow (hwnd, iCmdShow) ;&#10;     UpdateWindow (hwnd) ;&#10;&#10;     while (GetMessage (&#38;amp;amp;msg, NULL, 0, 0))&#10;     &#123;&#10;          TranslateMessage (&#38;amp;amp;msg) ;&#10;          DispatchMessage (&#38;amp;amp;msg) ;&#10;     &#125;&#10;     return msg.wParam ;&#10;&#125;&#10;&#10;LRESULT CALLBACK WndProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)&#10;&#123;&#10;&#10;     HMENU      hMenu ;                         //&#23450;&#20041;&#20102;&#33756;&#21333;&#21477;&#26564;&#10;&#10;     switch (message)&#10;     &#123;&#10;     case WM_COMMAND:                           //&#36873;&#25321;&#19968;&#39033;&#34987;&#21551;&#29992;&#30340;&#33756;&#21333;&#10;          hMenu = GetMenu (hwnd) ;&#10;&#10;          switch (LOWORD (wParam))              //&#37324;&#38754;&#21253;&#21547;&#30340;&#26159;&#33756;&#21333;ID&#10;          &#123;&#10;&#9;&#9;  case ID_FILE_NEW:&#10;&#9;&#9;&#9;  MessageBox(hwnd, TEXT(&#38;amp;quot;CREATE A NEW FILE&#38;amp;quot;), TEXT(&#38;amp;quot;hello&#38;amp;quot;), MB_OK);&#10;&#9;&#9;&#9;  break;&#10;&#9;&#9;  case ID_FILE_EXIT:&#10;&#9;&#9;&#9;  SendMessage(hwnd, WM_CLOSE, 0, 0);&#10;&#9;&#9;&#9;  break;&#10;&#10;          &#125;&#10;          break ;&#10;          return 0;&#10;&#10;     case WM_DESTROY:&#10;          PostQuitMessage (0) ;&#10;          return 0 ;&#10;     &#125;&#10;     return DefWindowProc (hwnd, message, wParam, lParam) ;&#10;&#125;&#38;lt;</span><br></pre></td></tr></table></figure>
<p>写完以后我新建一个资源文件，然后在里面添加菜单资源。</p>
<p>接下来我编辑菜单如下图所示：<img src="http://hi.csdn.net/attachment/201201/15/0_13266116480Ntj.gif" alt=""></p>
<p>注意一下系统默认的菜单ID是&nbsp; IDR_MENU1</p>
<p>我创建的4个popup的初始ID是ID_FILE_NEW40001</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID_FILE_OPEN40002</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID_FILE_SAVE40003</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID_FILE_EXIT</p>
<p>然后我尝试更改ID，把数字给去掉</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID_FILE_NEW</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID_FILE_OPEN</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID_FILE_SAVE</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID_FILE_EXIT</p>
<p>一编译，发现错误提示说&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID_FILE_NEW</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID_FILE_OPEN</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID_FILE_SAVE</p>
<p>全部找不到。</p>
<p>然后我去resource.h的文件里面去找，发现宏定义里面竟然没有把我改好以后的ID变掉，还是</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID_FILE_NEW40001</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID_FILE_OPEN40002</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID_FILE_SAVE40003</p>
<p>那么我心里想，就手工把后面的数字去掉吧&nbsp;&nbsp; -_-</p>
<p>然后再次编译，错误提示说 &nbsp;&nbsp;ID_FILE_NEW&nbsp; &nbsp; redefinition</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; ID_FILE_OPEN&nbsp; &nbsp; redefinition</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ID_FILE_SAVE&nbsp; &nbsp; redefinition</p>
<p>这就奇怪了，为什么会说&nbsp;&nbsp;&nbsp; 重定义错误呢？</p>
<p>我在网上查了写有关redefinition 错误的资料&nbsp;&nbsp;</p>
<p><span style="color:#000099">redefinition的错误</span></p>
<p>原因一般是由于你调用的函数没有在前面声明，而系统会默认为int型</p>
<p>而在后面你可能又写了函数体，但定义类型又不是int，所以报redefinition的错误</p>
<p>解决办法是恢复h文件，或在文件前面添加报redefinition错误的函数的声明</p>
<p>最后再看了下代码，终于发现问题所在了。</p>
<p><span style="color:#FF0000">wndclass.lpszMenuName&nbsp; = szAppName;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p>在定义窗口类的时候，我把菜单的名字和窗口的名字写做一样了，其实系统默认的窗口名字是IDR_MENU1</p>
<p>所以在编译资源的时候，.h文件根本就不会改变!</p>
<p>找到原因了，现在我有两种改进的方法：</p>
<p><span style="color:#FF0000">1.将</span><span style="color:#FF0000">wndclass.lpszMenuName&nbsp; 命名为系统默认的 IDR_MENU1</span></p>
<p></p>
<p><span style="color:#FF0000">2. 将菜单名称变成ownmenu</span></p>
<p><span style="color:#FF0000">但是依旧要注意，当你每次改变了菜单ID的时候，最好同时检查resource.h里面有没有发生改变，否则就会出现我上面说的错误哦!!~~~</span></p>
<p><span style="color:#FF0000"></span></p>
<p></p>
<p>&nbsp; 下面再看看菜单引用的3种方法吧，其实自己一开始的时候是把下面的第一种方法和第二种方法搞混了，才会导致上面的错误。</p>
<p><span style="font-family:Microsoft YaHei; font-size:13px">第一种方法：</span></p>
<p>在注册窗口类的时候就指定要菜单，在WNDCLASSEX结构体的成员lpszMenuName中，假设我把引入菜单的叫做”MenuDemo”,</p>
<p>那么就可以这样引用：</p>
<p>TCHAR szAppName[] = TEXT (“MenuDemo”)</p>
<p>//code</p>
<p>wndclass.lpszMenuName&nbsp; = szAppName ;</p>
<p><span style="font-family:Microsoft YaHei; font-size:13px"><span style="font-family:Microsoft YaHei; font-size:13px">上面这个例子是把程序名称和菜单名称做了相同的引用，用这种方法的话比较方便，比如在你的程序里面还有图标，声音或者其他的一些自定义资源的话，这种方法看起来就显得简单多了。</span></span></p>
<p></p>
<p><span style="font-family:Microsoft YaHei; font-size:13px">在这里就指定了你要的菜单，在窗口建立之前就已经包含在窗口类中了，建立窗口的时候直接就出来菜单。这种方法比较简单，所以&nbsp;在一般情况下都用这种方法引用菜单资源。但是这种方法有一种缺陷：由于是在窗口类中指定的，所有由该窗口类派生出的窗口都有</span></p>
<p>相同的菜单</p>
<p><span style="font-family:Microsoft YaHei; font-size:13px">第二种方法：</span></p>
<p>HMENU hMenu</p>
<p>TCHAR MenuName[] = TEXT(“MenuDemo”);</p>
<p>//code</p>
<p>hMenu = LoadMenu(hInstance,MenuName);</p>
<p>hWinMain = CreateWindowEx(WS_EX_CLIENTEDGE,szClassName,szCaptionMain,</p>
<p>WS_OVERLAPPEDWINDOW,100,100,600,400,NULL,hMenu,hInstance,NULL);</p>
<p>通过在CreateWindowsEx第九个参数指定要引入的菜单。CreateWindow调用中的指定菜单可以覆盖窗口类中指定的任何菜单。</p>
<p><span style="font-family:Microsoft YaHei; font-size:13px">第三种方法：</span></p>
<p>如果我们把CreateWindowEx第九个参数设置为NULL,并且也不在窗口类中指定NULL菜单，就可以在窗口被创建后在给窗口指定指定一个菜单：</p>
<p><span style="font-family:Microsoft YaHei; font-size:13px">SetMenu(hwnd,hMenu);</span></p>
<p>举个例子 ,在消息处理函数内 static HMENU hMenuFile1，hMenuFile1;</p>
<p>在WM_CREATE:</p>
<p>hInstance = (HINSTANCE)GetWindowsLong(hwnd,GWL_HINSTANCE);</p>
<p>hMenuFile1 = LoadMenu(hInstance,TEXT(“MenuMain1″);&nbsp;&nbsp;&nbsp;&nbsp;//举个例子</p>
<p>hMenuFile2 = LoadMenu(hInstance,TEXT(“MenuMain2″);面选择资源脚本多次，每个菜单都不同的名字。每当窗口过程处理WM_CREATE消息</p>
<p>的时候windows就会动态的白菜单资源加载到内存中去。SetMenu(hwnd,hMenu)让程序显示hMenu指向的菜单，然后你可以任意</p>
<p>SetMenu(hwnd,hMenuFile1)或者SetMenu(hwnd,hMenuFile2)之间切换，在windows程序设计上面通过按键来实现，这样你甚至可以多创建几个菜单。</p>
<p>下面我们简单地来看看.rc跟菜单资源有关的代码</p>
<p>当我们打开 .rc的资源文件的时候，如果你的工程里面添加了菜单资源的话，那么你可以看到类&#20284;下面这样的代码：</p>
<figure class="highlight"><figcaption><span>MENU &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><a href="//OWNMENU是菜单的名称">link</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#10;    POPUP &#38;quot;&#38;amp;File&#38;quot;&#10;    BEGIN&#10;        MENUITEM &#38;quot;&#38;amp;New&#38;quot;,                        ID_FILE_NEW&#10;        MENUITEM &#38;quot;&#38;amp;Open&#38;quot;,                       ID_FILE_OPEN&#10;        MENUITEM &#38;quot;&#38;amp;Save&#38;quot;,                       ID_FILE_SAVE&#10;        MENUITEM &#38;quot;&#38;amp;Exit&#38;quot;,                       ID_FILE_EXIT&#10;    END&#10;END</span><br></pre></td></tr></table></figure>
<p></p><p>这里的BEGIN 和END跟Pascal程序比较像，如果大家愿意的话其实可以手工用 {&nbsp; 来代替BEGIN&nbsp;&nbsp; ,用&nbsp;&nbsp;&nbsp; }&nbsp; 来代替 END。</p>
<p>MENUITEM &quot;&amp;New&quot;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ID_FILE_NEW &nbsp; 这里的MENUITEM还有另一个选项:POPUP</p>
<p>对于MENUITEM&nbsp;&nbsp;&nbsp; 菜单项会生成一个带有特定ID的WM_COMMAND消息，比如上面这行代码 有ID_FILE_NEW这个ID，当然我们可以在resource.h里面找到它的数字ID</p>
<p>对于POPUP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pop-up，翻译过来以后的意思是突然出现，冒出来的意思，所以在windows编程里我们可以将它理解为&quot;跳出来&quot;的菜单。&nbsp; 该菜单项会激活一个弹出窗口，这时它没有相关联的ID</p>
<p>对于上面的代码，我们应该可以想象在菜单栏有File这个选项，当我们点击File的时候，会弹出New,Open,Save,Exit四个选项，每一个选项当你选中后都会触发WM_COMMAND消息，我们可以把功能写在里面。</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2012/01/13/vim进阶学习笔记/" itemprop="url">
                vim进阶学习笔记
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-01-13T16:36:00+08:00" content="2012-01-13">
            2012-01-13
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>&nbsp;&nbsp;&nbsp;&nbsp; 最近在看《学习vi和vim编辑器第7版中文版》，一些基本的命令这里就不介绍了，反正大家都找得到，这里给大家介绍一点有趣的东西</p>
<p>&nbsp;&nbsp;<span style="font-size:18px">&nbsp;<span style="color:#3333ff"> 关于ex 编辑器</span></span></p>
<p>&nbsp;&nbsp;&nbsp; ex编辑器是一个行编辑器，在vim中输入&nbsp; Q&nbsp; 会进入到ex编辑器，如果是不小心进入的，输入vi&nbsp;&nbsp;&nbsp; 或者&nbsp; visual 就可以回到vim 中了</p>
<p>&nbsp;&nbsp;&nbsp; 大家都知道 vim 是有三种模式的，其实命令行模式的vim 就是打开了一个可视化的ex编辑器。所以说学点ex行编辑器的知识在vim中还是很有用的。</p>
<p>&nbsp; </p>
<p>&nbsp; ：set命令</p>
<p>&nbsp;&nbsp; 打开选项</p>
<p>&nbsp;&nbsp;&nbsp; :set option</p>
<p>&nbsp;&nbsp;&nbsp; 关闭选项</p>
<p>&nbsp;&nbsp; :set nooption</p>
<p>&nbsp; 指定搜索模式忽略大小写</p>
<p>&nbsp;&nbsp; ：set&nbsp; ic</p>
<p>检查vi正在使用的选项</p>
<p>&nbsp;&nbsp; ：set all </p>
<p>：set nu (:set number)&nbsp;&nbsp; 显示行号，这个在编写程序的时候是非常有用的</p>
<p>.exrc文件</p>
<p>.exrc文件用来控制vi的环境，可以编辑设置。</p>
<p>但是这里要注意优先级，储存在环境变量里面的EXINIT是最先执行的，然后是主目录下面的.exrc&nbsp;&nbsp; 最后才是当前目录下的.exrc文件</p>
<p>当然你也可以读取其他目录下的.exrc文件，可以使用：so .progoptions</p>
<p>：！ command&nbsp; 创建一个shell</p>
<p>比如&nbsp;&nbsp; </p>
<p>：！ date 可以在不离开vi的情况下显示时间</p>
<p>当然如果你想输入多个命令，可以创建一个shell</p>
<p>:sh</p>
<p>请注意这里其实并没有离开vi环境，可以使用ctrl&#43;d来重新回到vi的怀抱中～～～</p>
<p>：r&nbsp;&nbsp;&nbsp; (: read)可以与命令相结合，将命令的结果读入到文件中，比如</p>
<p>：r !date&nbsp;&nbsp;&nbsp;&nbsp; 会将系统时间读入到你的文件中</p>
<p>单词缩写：</p>
<p>：ab&nbsp; abbr phrase</p>
<p>例如</p>
<p>：ab&nbsp;&nbsp;&nbsp; imrc&nbsp; International Materials Research Center&nbsp; 制定缩写，但是在vim下面好像不能递归定义，比如</p>
<p>：ab&nbsp; the&nbsp;&nbsp; the&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这样的递归调用是不允许的</p>
<p>&nbsp; :map 自定义命令序列（对vi的命令模式命令宏）</p>
<p>：map x sequence 将x映射到编辑命令sequence 中</p>
<p>比如</p>
<p>：map v dwelp&nbsp;&nbsp;&nbsp;&nbsp; 按下v键就可以颠倒两个单词的顺序</p>
<p>当然ex编辑器还有很多好玩的有用的地方，我就先介绍到这里了</p>
<p>下面我们来玩玩&nbsp;&nbsp;<span style="font-size:18px"> <span style="color:#000099">折叠命令</span></span></p>
<p>zf 创建折叠 （范围从开始到光标移动到达后的位置结束）</p>
<p>比如你可以使用z4j来折叠5行</p>
<p>za&nbsp; 切换一个折叠的状态</p>
<p>zd&nbsp; 删除一个折叠</p>
<p>zj光标移到下一个折叠开始的地方</p>
<p>zk光标移到上一个折叠结尾处</p>
<p>zE去除所有折叠</p>
<p>zo递归打开折叠</p>
<p>手动组合命令折叠是很强大的哦～</p>
<p>比如 首先将你的光标移到 { 处，&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; zf% 后就会自动折叠到对应的}，这样是不是很方便呢，^_^</p>
<p><span style="font-size:18px; color:#3333ff">多窗口功能</span></p>
<p>利用vim的多窗口功能，我们可以很方便的比较两个不同版本的文件，可以快速的在多个文件当中进行剪切和复制操作</p>
<p>vim -o file1 file 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 使用-o选项可以同时打开多个文本文件</p>
<p>当然你也可以指定要打开几个窗口</p>
<p>vim -o5file1&nbsp; file2 </p>
<p>那么第1个窗口，就是最顶端的窗口打开file1,第2个窗口打开file2，后面三个是空文件，注意由于打开的是不同的文件，所以他们各自对应<span style="color:#ff0000">不同的缓冲区。</span></p>
<p>如果你想设置窗口的尺寸，那么你可以用winheight 和winwidth来设置</p>
<p>:set winheight=100&nbsp;&nbsp;&nbsp; 可以将窗口高度设置成100</p>
<p>那么怎么分割同一个文件共享相同的缓冲区呢？</p>
<p>&nbsp;&nbsp; :split&nbsp;&nbsp;&nbsp; 水平分割</p>
<p>&nbsp; :vsplit&nbsp;&nbsp;&nbsp; 垂直分割（我想一般人还是喜欢垂直分割吧^_^）</p>
<p>当然你也可以在后面指定文件同时编辑不同的文件</p>
<p>下面来具体说说split命令：</p>
<p>：[n] new&nbsp; [&#43;&#43;opt]&nbsp; [&#43;cmd] [file]</p>
<p>n&nbsp;&nbsp; Vim指定在新窗口中显示的行数，新窗口位于画面顶端</p>
<p>opt&nbsp; 传递vim选项信息给<span style="color:#ff0000">新的窗口会话（前面加&#43;&#43;）</span></p>
<p>cmd 传入在新窗口中执行的命令（前面加&#43;）</p>
<p>file指定欲在新窗口中编辑的文件</p>
<p>例如</p>
<p>：15split &#43;&#43;fileformat=unix&nbsp; otherfile</p>
<p>指定了新打开的文件为otherfile行高为15，使用unix的fileformat</p>
<p>你也可以使用按键命令^Ws&nbsp;&nbsp;&nbsp; ^WS&nbsp;&nbsp; ^W^S分割窗口</p>
<p><img src="http://hi.csdn.net/attachment/201201/15/0_1326637364XX8u.gif" alt=""></p>
<p>好了，现在我们已经会创建多个窗口了，那么怎么移动呢？其实鼠标是一种很方便的方法。默认的vim可能没有发开mouse选项，那么我们可以设置一下</p>
<p>：set mouse=a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这时候你会发现不仅可以光标可以在不同窗口之间切换了～～不仅如此，还可以调整窗口的大小边距了～～～</p>
<p>当然，也可以使用键盘切换</p>
<p>CTRL&#43;W&nbsp; j&nbsp;&nbsp; 表示移动到下一个窗口</p>
<p>CTRL&#43;W&nbsp; k &nbsp; 表示移动到上一个窗口</p>
<p>CTRL&#43;W&nbsp; h &nbsp; 表示移动到左边一个窗口</p>
<p>CTRL&#43;W&nbsp; l &nbsp; 表示移动到右边一个窗口</p>
<p>这里和移动光标是一样的，还可以使用上下左右键</p>
<p>CTRL&#43;W&nbsp; t &nbsp; 表示移动到最左上角的窗口</p>
<p>CTRL&#43;W&nbsp; b &nbsp; 表示移动到最右上角的窗口</p>
<p>移动窗口本身</p>
<p>CTRL&#43;W&nbsp; r &nbsp; 向右或向下轮换窗口</p>
<p>CTRL&#43;W&nbsp; R &nbsp; 向左或向上轮换窗口（大写跟小写的意思是相反的，这在很多vim命令里面都是这样设定的哦）</p>
<p>CTRL&#43;W&nbsp; x&nbsp; （X） 交换同行或同列的窗口的位置，当然你可以使用3^Wx这样的命令来与第3个窗口交换</p>
<p>移动窗口改变布局</p>
<p>CTRL&#43;W&nbsp; K &nbsp; 移动当前屏幕到顶端，使用屏幕<span style="color:#cc0000">全部宽度</span>&nbsp; </p>
<p>CTRL&#43;W&nbsp; J&nbsp; 移动当前屏幕到底端，使用屏幕<span style="color:#cc0000">全部宽度</span>&nbsp; </p>
<p>CTRL&#43;W&nbsp; H&nbsp; 移动当前屏幕到左端，使用屏幕<span style="color:#cc0000">全部高度</span>&nbsp; </p>
<p>CTRL&#43;W&nbsp; L &nbsp; 移动当前屏幕到右端，使用屏幕<span style="color:#cc0000">全部高度</span>&nbsp;&nbsp;</p>
<p>窗口调整尺寸命令</p>
<p>CTRL&#43;W&nbsp; =&nbsp; 调整所有窗口到相同尺寸</p>
<p>CTRL&#43;W&nbsp; &#43;&nbsp; 当前窗口高度增加一行</p>
<p>CTRL&#43;W&nbsp; -&nbsp; 当前窗口高度减少一行</p>
<p>CTRL&#43;W&nbsp; &lt;&nbsp; 减少当前窗口宽度</p>
<p>CTRL&#43;W&nbsp; &gt; 增加当前窗口宽度</p>
<p>你也可以用命令编辑:</p>
<p>:resize n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; （设置高度）</p>
<p>:vertical resize n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; （设置宽度）</p>
<p>创建新分页</p>
<p>就好比大家在用火狐浏览器一样，vim也可以创建多个分页，然后在分页上编辑哦！！！</p>
<p>:tabnew filename&nbsp;&nbsp;&nbsp; 打开新分页</p>
<p>:tabclose&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 关闭当前分页</p>
<p>:tabonly&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 关闭其他所有分页</p>
<p>更方便的是，你可以打开鼠标选项:set mouse=a</p>
<p>然后点击上方的分页列表就可以选择分页，双击可以自动创建分页。是不是很方便啊，我估计Notepad&#43;&#43;就是从vim里学来的吧～～～</p>
<p><img src="http://hi.csdn.net/attachment/201201/16/0_13266804782bm3.gif" alt=""></p>
<p><span style="font-size:18px; color:#000099">语法高亮配色方案</span></p>
<p>学过windowsSDk的应该都知道资源文件.rc吧，同样的，在vim里面你也可以编辑配置文件.vimrc编写自己的脚本来设置属于你自己的vim</p>
<p>这里我们先来设置一样<span style="color:#996633">环境配色方案</span>吧</p>
<p>Vim自定义了17种默认配色方案，比如</p>
<p>在.vimrc文件里面输入（如果没有的话可以新创建一个，创建&nbsp;&nbsp; ~/.vimrc 就能改变 ～目录下所有的 vim配置了</p>
<p>colorscheme desert</p>
<p>这个据说是很多人喜欢的低调的沙漠配色方案</p>
<p>但是我不是很喜欢啊，于是自己去网上找啊找，找到了一个很好看的配色方案：molokai</p>
<p>具体步骤如下：</p>
<p>这里先提供网站给大家下载</p>
<p><a href="http://www.vim.org/scripts/script_search_results.php?keywords=&amp;script_type=color&#43;scheme&amp;order_by=rating&amp;direction=descending&amp;search=search" target="_blank" rel="external">http://www.vim.org/scripts/script_search_results.php?keywords=&amp;script_type=color&#43;scheme&amp;order_by=rating&amp;direction=descending&amp;search=search</a></p>
<p><a href="http://code.google.com/p/vimcolorschemetest/" target="_blank" rel="external">http://code.google.com/p/vimcolorschemetest/</a></p>
<p>然后比如像我一样下了molokai</p>
<p></p><p></p>
<p>首先把下载下来的 .vim 文件放在 <span style="color:#ff0000">“/usr/share/vim/vim73/colors/”</span>目录或者放在<span style="color:#ff0000">“~/.vim/colors/”</span>目录下，后者如果不存在可以自己建一个。</p>
<p>然后 在 “~/.vimrc” 文件中添加下面一行，重新打开一个vim就可以了。</p>
<blockquote>
<p><span style="color:#ff0000">_colorscheme 配色方案名称_</span></p>
<p>_比如我就是 colorscheme molokai</p>
<p>_</p>
</blockquote>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 另外，可以用一个插件 “<a href="http://www.vim.org/scripts/script.php?script_id=1298" title="ColorSchemeExplorer" target="_blank" rel="external">Color Scheme Explorer</a>” 来帮你选择喜欢的配色。把解压后的文件放到 “~/.vim/plugin/” 下，在vim中输入下面的命令：</p>
<blockquote>
<p>_:ColorSchemeExplorer_</p>
</blockquote>
<p>会列出上面两个colors目录中的所有配色文件，按”回车”来选择一个方案来test就可以了。</p>
<p>在选择配色方案的过程中，如果发现更改后的配色和目标配色不一致，或者说色调非常难看，那么在 “~/.vimrc” 中添加下面一行就可以了。这个用来指定配色方案是256色。</p>
<p><span style="color:#ff0000">_set t_Co=256_</span></p>
<p>给大家看下效果图：</p>
<p><img src="http://hi.csdn.net/attachment/201201/18/0_1326896577Y7Yc.gif" alt=""></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2012/01/11/windows-SDK模拟游戏钢琴的实现（二）/" itemprop="url">
                windows SDK模拟游戏钢琴的实现（二）
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-01-11T14:09:00+08:00" content="2012-01-11">
            2012-01-11
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 昨天晚上失眠了，于是一直在想实现GDI的一个效果：首先绘制10个相连的矩形，当鼠标移到某个矩形的时候，自动填充那个矩形的背景颜色为灰色，移开的时候恢复原来的白色。当只有一个矩形的时候，当然不是一件难事。但是当有10个矩形的时候，问题就产生了。首先先看一下代码：</p>
<p></p><br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">#include &amp;lt<span class="comment">;windows.h&amp;gt;</span></span><br><span class="line">#include &amp;lt<span class="comment">;math.h&amp;gt;</span></span><br><span class="line"></span><br><span class="line">#define NUM  10</span><br><span class="line"></span><br><span class="line">struct own_rectangle&#123;</span><br><span class="line">	int xLeft   <span class="comment">;</span></span><br><span class="line">	int xRight  <span class="comment">;</span></span><br><span class="line">	int yTop    <span class="comment">;</span></span><br><span class="line">	int yBottom <span class="comment">;</span></span><br><span class="line">&#125;rect[NUM]<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK WndProc (HWND, UINT, WPARAM, LPARAM)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">int WINAPI WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance,</span><br><span class="line">					PSTR szCmdLine, int iCmdShow)</span><br><span class="line">&#123;</span><br><span class="line">	static TCHAR szAppName[] = TEXT(&amp;quot<span class="comment">;piano demo by mouse&amp;quot;);</span></span><br><span class="line">	HWND hwnd<span class="comment">;</span></span><br><span class="line">	MSG  msg<span class="comment">;</span></span><br><span class="line">	WNDCLASS wndclass<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">	wndclass.style = CS_HREDRAW | CS_VREDRAW <span class="comment">;</span></span><br><span class="line">	wndclass.lpfnWndProc = WndProc<span class="comment">;</span></span><br><span class="line">	wndclass.cbClsExtra = 0<span class="comment">;</span></span><br><span class="line">	wndclass.cbWndExtra = 0<span class="comment">;</span></span><br><span class="line">	wndclass.hInstance  = hInstance<span class="comment">;</span></span><br><span class="line">	wndclass.hIcon      = LoadIcon(NULL, IDI_APPLICATION)<span class="comment">;</span></span><br><span class="line">    wndclass.hCursor    = LoadCursor (NULL, IDC_ARROW)<span class="comment">;</span></span><br><span class="line">	wndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH)<span class="comment">;</span></span><br><span class="line">	wndclass.lpszClassName = szAppName<span class="comment">;</span></span><br><span class="line">	wndclass.lpszMenuName  = NULL<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">	if (!RegisterClass(&amp;amp<span class="comment">;amp;wndclass))</span></span><br><span class="line">	&#123;</span><br><span class="line">		MessageBox(NULL, TEXT(&amp;quot<span class="comment">;Program requires Windows NT!&amp;quot;),</span></span><br><span class="line">					szAppName, MB_ICONERROR) <span class="comment">;</span></span><br><span class="line">		return 0<span class="comment">;</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	hwnd = CreateWindow (szAppName, TEXT(&amp;quot<span class="comment">;Piano Demo Using Mouse&amp;quot;),</span></span><br><span class="line">			WS_OVERLAPPEDWINDOW,</span><br><span class="line">			CW_USEDEFAULT, CW_USEDEFAULT,</span><br><span class="line">			CW_USEDEFAULT, CW_USEDEFAULT,</span><br><span class="line">			NULL, NULL, hInstance, NULL) <span class="comment">;</span></span><br><span class="line"></span><br><span class="line">	ShowWindow (hwnd, iCmdShow) <span class="comment">;</span></span><br><span class="line">	UpdateWindow (hwnd)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">	while (GetMessage (&amp;amp<span class="comment">;amp;msg, NULL, 0, 0))</span></span><br><span class="line">	&#123;</span><br><span class="line">		TranslateMessage (&amp;amp<span class="comment">;amp;msg) ;</span></span><br><span class="line">		DispatchMessage (&amp;amp<span class="comment">;amp;msg) ;</span></span><br><span class="line">	&#125;</span><br><span class="line">	return msg.wParam<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK WndProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span><br><span class="line">&#123;</span><br><span class="line">	static int cxClient, cyClient<span class="comment">;</span></span><br><span class="line">	static int Flag[NUM] =&#123;<span class="number">0,0,0,0</span>,<span class="number">0,0,0,0</span>,0,0&#125;<span class="comment">;</span></span><br><span class="line">	HDC hdc<span class="comment">;</span></span><br><span class="line">	int i = 0<span class="comment">;</span></span><br><span class="line">	PAINTSTRUCT ps<span class="comment">;                           //ps数组里面存放了RECT,用来重绘客户区的位置</span></span><br><span class="line">	POINT hitPoint<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">	int xCornerEllipse<span class="comment">;</span></span><br><span class="line">	int yCornerEllipse<span class="comment">;</span></span><br><span class="line">	int xStart = 200, yStart = 100, xEnd = 100, yEnd = 300<span class="comment">;</span></span><br><span class="line">	HBRUSH hBrush<span class="comment">;</span></span><br><span class="line">	HPEN hPen<span class="comment">;</span></span><br><span class="line">	switch (message)</span><br><span class="line">	&#123;</span><br><span class="line">		case WM_SIZE:</span><br><span class="line">			cxClient = LOWORD(lParam)<span class="comment">;</span></span><br><span class="line">			cyClient = HIWORD(lParam)<span class="comment">;</span></span><br><span class="line">		return 0<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">		case WM_MOUSEMOVE:</span><br><span class="line">			 hitPoint.x = LOWORD(lParam)<span class="comment">;</span></span><br><span class="line">			 hitPoint.y = HIWORD(lParam)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">			 for (i = 0<span class="comment">; i &amp;amp;lt; NUM; i++)        //&amp;lt;span style=&amp;quot;color:#ffffff;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color:#000000;&amp;quot;&amp;gt;为什么 只有当i=0的时候才有效果呢？&amp;lt;/span&amp;gt;</span></span><br><span class="line">&amp;lt<span class="comment">;/span&amp;gt;			&#123;</span></span><br><span class="line">				if (hitPoint.x &amp;amp<span class="comment">;gt;= rect[i].xLeft &amp;amp;amp;&amp;amp;amp; hitPoint.x &amp;amp;lt;= rect[i].xRight &amp;amp;amp;&amp;amp;amp; hitPoint.y &amp;amp;gt;= rect[i].yTop &amp;amp;amp;&amp;amp;amp; hitPoint.y &amp;amp;lt;= rect[i].yBottom )</span></span><br><span class="line">					Flag[i] = 1<span class="comment">;</span></span><br><span class="line">				else</span><br><span class="line">					Flag[i] = 0<span class="comment">;</span></span><br><span class="line">				InvalidateRect(hwnd, NULL, TRUE)<span class="comment">;</span></span><br><span class="line">				//break<span class="comment">;</span></span><br><span class="line">			 &#125;</span><br><span class="line">		return 0<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">		case WM_PAINT:</span><br><span class="line">				hdc = BeginPaint (hwnd, &amp;amp<span class="comment">;amp;ps);</span></span><br><span class="line"></span><br><span class="line">				ps.rcPaint.left   =   rect[i].xLeft<span class="comment">;</span></span><br><span class="line">				ps.rcPaint.right  =   rect[i].xRight<span class="comment">;</span></span><br><span class="line">				ps.rcPaint.top    =   rect[i].yTop<span class="comment">;</span></span><br><span class="line">				ps.rcPaint.bottom =   rect[i].yBottom<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">			hBrush = (HBRUSH)GetStockObject (GRAY_BRUSH)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">			if (Flag[i] == 1)                             //如果鼠标位置在矩形框内，将刷子选进设备环境里面</span><br><span class="line">				SelectObject(hdc, hBrush)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">			hPen = CreatePen (PS_SOLID, 1, RGB(<span class="number">255,0,0</span>))<span class="comment">;</span></span><br><span class="line">			SelectObject (hdc, hPen)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">			rect[0].xLeft    =  400   <span class="comment">;</span></span><br><span class="line">			rect[0].xRight   =  420   <span class="comment">;</span></span><br><span class="line">			rect[0].yTop     =  210    <span class="comment">;</span></span><br><span class="line">			rect[0].yBottom  =  300   <span class="comment">;</span></span><br><span class="line"></span><br><span class="line">			Rectangle(hdc, rect[0].xLeft, rect[0].yTop, rect[0].xRight, rect[0].yBottom)<span class="comment">;</span></span><br><span class="line">			for (i = 1<span class="comment">; i &amp;amp;lt;NUM; i++)</span></span><br><span class="line">			&#123;</span><br><span class="line">				rect[i].xLeft    = rect[i-1].xLeft  + 20   <span class="comment">;</span></span><br><span class="line">				rect[i].xRight   = rect[i-1].xRight + 20   <span class="comment">;</span></span><br><span class="line">				rect[i].yTop     = rect[0].yTop            <span class="comment">;</span></span><br><span class="line">				rect[i].yBottom  = rect[0].yBottom         <span class="comment">;</span></span><br><span class="line">				Rectangle(hdc, rect[i].xLeft, rect[i].yTop, rect[i].xRight, rect[i].yBottom)<span class="comment">;</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			DeleteObject(hPen)<span class="comment">;</span></span><br><span class="line">			EndPaint(hwnd, &amp;amp<span class="comment">;amp;ps);</span></span><br><span class="line">		return 0<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">		case WM_DESTROY:</span><br><span class="line">			PostQuitMessage (0)<span class="comment">;</span></span><br><span class="line">		return 0<span class="comment">;</span></span><br><span class="line">	&#125;</span><br><span class="line">	return DefWindowProc (hwnd, message, wParam, lParam) <span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p>
<p></p><p></p>
<p>下面来看一个这个处理鼠标移动的操作：</p>
<p></p><br><figure class="highlight"><figcaption><span>WM_MOUSEMOVE:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#9; hitPoint.x = LOWORD(lParam);&#10;&#9; hitPoint.y = HIWORD(lParam);&#10;&#10;&#9; for (i = 0; i &#38;lt; NUM; i++)&#10;&#9;&#123;&#10;&#9;&#9;if (hitPoint.x &#38;gt;= rect[i].xLeft &#38;amp;&#38;amp; hitPoint.x &#38;lt;= rect[i].xRight &#38;amp;&#38;amp; hitPoint.y &#38;gt;= rect[i].yTop &#38;amp;&#38;amp; hitPoint.y &#38;lt;= rect[i].yBottom )&#10;&#9;&#9;&#9;Flag[i] = 1;&#10;&#9;&#9;else&#10;&#9;&#9;&#9;Flag[i] = 0;&#10;&#9;&#9;InvalidateRect(hwnd, NULL, TRUE);&#10;&#9;&#9;break;&#10;&#9; &#125;&#10;return 0;</span><br></pre></td></tr></table></figure><p></p>
<p>一运行问题就来了：只有当鼠标移到第一个矩形的时候才会产生效果，而移到后面9个的时候根本没有产生任何效果！！</p>
<p>我把上面for 循环的 初始条件的<span style="color:#ff0000">&nbsp; i=0</span>&nbsp; 改成&nbsp; <span style="color:#ff0000"></span></p>
<p>i=1,这下子更加糟糕了：连第一个矩形都不能产生效果了。看来问题就是在这里了。</p>
<p>那么为什么会不起作用呢？</p>
<p>向华哥请教后，终于发现端倪了：</p>
<figure class="highlight"><figcaption><span>(Flag[i] == 1)</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SelectObject(hdc, hBrush);</span><br></pre></td></tr></table></figure>
<p>我是什么时候把刷子的句柄选入设备环境里面的呢？ 就是上面的当&nbsp; Flag[i] == 1 的时候&nbsp;，一旦选入了以后，那么后面所有的矩形绘制的时候用的都是灰色的刷子。</p>
<p>所以首先在WM_PAINT消息里面 添加选择刷子的消息：</p>
<p>for (i = 1; i &lt;NUM; i&#43;&#43;)</p>
<p>{&nbsp;</p>
<p><span style="color:#ff0000">&nbsp; if (Flag[i] == 1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</span></p>
<p><span style="color:#ff0000">&nbsp;SelectObject(hdc, hBrush);&nbsp;</span></p>
<p>&nbsp;rect[i].xLeft&nbsp;&nbsp;&nbsp; = rect[i-1].xLeft&nbsp; &#43; 20&nbsp;&nbsp; ;</p>
<p>&nbsp;rect[i].xRight&nbsp;&nbsp; = rect[i-1].xRight &#43; 20&nbsp;&nbsp; ;</p>
<p>&nbsp;rect[i].yTop&nbsp;&nbsp;&nbsp;&nbsp; = rect[0].yTop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</p>
<p>&nbsp;rect[i].yBottom&nbsp; = rect[0].yBottom&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</p>
<p>&nbsp;Rectangle(hdc, rect[i].xLeft, rect[i].yTop, rect[i].xRight, rect[i].yBottom);</p>
<p>}</p>
<p>&nbsp;但是麻烦又来了：如果第i个是灰色的，那么从第i&#43;1个开始后面的所有矩形都变成灰色的了由于发送了10条重绘消息，说明鼠标移动到某个点的时候整个屏幕刷新了10次！！相当于10个矩形总共画了10次！！现在问题应该很明显了：重新绘制出来的窗口把原来的窗口效果给覆盖掉了，如果说原来第i次第i个矩形是灰色的，那么第i&#43;1次的时候又被覆盖成白色的了！！！</p>
<p>而且我的i设置的时候不是全局变量，所以每一个进入VM_PAINT消息的时候i都是0</p>
<p>好了，错误发现以后，我们就可以改正了。首先是逻辑上的修正：</p>
<p>每次重新绘制整个窗口的时候都先把10个矩形画出来，然后在根据鼠标移动传过来的信息判断哪一个矩形应该被重画。</p>
<p>逻辑清楚了以后，写起来就简单了。</p>
<p>我把（一）中的声音效果再加进来，再添加鼠标左键点击发出声音，最终的代码如下：</p>
<p></p><br><figure class="highlight"><figcaption><span>&lt;windows.h&gt;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &#38;lt;math.h&#38;gt;&#10;#include &#38;lt;mmsystem.h&#38;gt;&#10;&#10;#pragma comment(lib, &#38;quot;WINMM.LIB&#38;quot;)&#10;&#10;#define NUM  10&#10;&#10;struct own_rectangle&#123;&#10;&#9;int xLeft   ;&#10;&#9;int xRight  ;&#10;&#9;int yTop    ;&#10;&#9;int yBottom ;&#10;&#125;rect[NUM];&#10;&#10;LRESULT CALLBACK WndProc (HWND, UINT, WPARAM, LPARAM);&#10;&#10;int WINAPI WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance,&#10;&#9;&#9;&#9;&#9;&#9;PSTR szCmdLine, int iCmdShow)&#10;&#123;&#10;&#9;static TCHAR szAppName[] = TEXT(&#38;quot;piano demo by mouse&#38;quot;);&#10;&#9;HWND hwnd;&#10;&#9;MSG  msg;&#10;&#9;WNDCLASS wndclass;&#10;&#10;&#9;wndclass.style = CS_HREDRAW | CS_VREDRAW ;&#10;&#9;wndclass.lpfnWndProc = WndProc;&#10;&#9;wndclass.cbClsExtra = 0;&#10;&#9;wndclass.cbWndExtra = 0;&#10;&#9;wndclass.hInstance  = hInstance;&#10;&#9;wndclass.hIcon      = LoadIcon(NULL, IDI_APPLICATION);&#10;    wndclass.hCursor    = LoadCursor (NULL, IDC_ARROW);&#10;&#9;wndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH);&#10;&#9;wndclass.lpszClassName = szAppName;&#10;&#9;wndclass.lpszMenuName  = NULL;&#10;&#10;&#9;if (!RegisterClass(&#38;amp;amp;wndclass))&#10;&#9;&#123;&#10;&#9;&#9;MessageBox(NULL, TEXT(&#38;quot;Program requires Windows NT!&#38;quot;),&#10;&#9;&#9;&#9;&#9;&#9;szAppName, MB_ICONERROR) ;&#10;&#9;&#9;return 0;&#10;&#9;&#125;&#10;&#10;&#9;hwnd = CreateWindow (szAppName, TEXT(&#38;quot;Piano Demo Using Mouse&#38;quot;),&#10;&#9;&#9;&#9;WS_OVERLAPPEDWINDOW,&#10;&#9;&#9;&#9;CW_USEDEFAULT, CW_USEDEFAULT,&#10;&#9;&#9;&#9;CW_USEDEFAULT, CW_USEDEFAULT,&#10;&#9;&#9;&#9;NULL, NULL, hInstance, NULL) ;&#10;&#10;&#9;ShowWindow (hwnd, iCmdShow) ;&#10;&#9;UpdateWindow (hwnd);&#10;&#10;&#9;while (GetMessage (&#38;amp;amp;msg, NULL, 0, 0))&#10;&#9;&#123;&#10;&#9;&#9;TranslateMessage (&#38;amp;amp;msg) ;&#10;&#9;&#9;DispatchMessage (&#38;amp;amp;msg) ;&#10;&#9;&#125;&#10;&#9;return msg.wParam;&#10;&#125;&#10;&#10;LRESULT CALLBACK WndProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)&#10;&#123;&#10;&#9;TCHAR str1[100], str2[100], str_i[10];&#10;&#9;static int cxClient, cyClient;&#10;&#9;static int Flag[NUM] =&#123;0,0,0,0,0,0,0,0,0,0&#125;;&#10;&#9;HDC hdc;&#10;&#9;static int i = 0;&#10;&#9;int j = 0;&#10;&#9;PAINTSTRUCT ps;                           //ps&#25968;&#32452;&#37324;&#38754;&#23384;&#25918;&#20102;RECT,&#29992;&#26469;&#37325;&#32472;&#23458;&#25143;&#21306;&#30340;&#20301;&#32622;&#10;&#9;POINT hitPoint;&#10;&#10;&#9;int xCornerEllipse;&#10;&#9;int yCornerEllipse;&#10;&#9;int xStart = 200, yStart = 100, xEnd = 100, yEnd = 300;&#10;&#9;HBRUSH hBrush;&#10;&#9;HPEN hPen;&#10;&#9;switch (message)&#10;&#9;&#123;&#10;&#9;&#9;case WM_SIZE:&#10;&#9;&#9;&#9;cxClient = LOWORD(lParam);&#10;&#9;&#9;&#9;cyClient = HIWORD(lParam);&#10;&#9;&#9;return 0;&#10;&#10;&#9;&#9;case WM_MOUSEMOVE:&#10;&#9;&#9;&#9; hitPoint.x = LOWORD(lParam);&#10;&#9;&#9;&#9; hitPoint.y = HIWORD(lParam);&#10;&#10;&#9;&#9;&#9; for (i = 0; i &#38;amp;lt; NUM; i++)&#10;&#9;&#9;&#9;&#123;&#10;&#9;&#9;&#9;&#9;if (hitPoint.x &#38;amp;gt;= rect[i].xLeft &#38;amp;amp;&#38;amp;amp; hitPoint.x &#38;amp;lt;= rect[i].xRight &#38;amp;amp;&#38;amp;amp; hitPoint.y &#38;amp;gt;= rect[i].yTop &#38;amp;amp;&#38;amp;amp; hitPoint.y &#38;amp;lt;= rect[i].yBottom )&#10;&#9;&#9;&#9;&#9;&#123;&#10;&#9;&#9;&#9;&#9;&#9;Flag[i] = 1;&#10;&#9;&#9;&#9;&#9;&#9;InvalidateRect(hwnd, NULL, TRUE);&#10;&#9;&#9;&#9;&#9;&#9;break;&#10;&#9;&#9;&#9;&#9;&#125;&#10;&#10;&#9;&#9;&#9; &#125;&#10;&#9;&#9;&#9; if (NUM == i)&#10;&#9;&#9;&#9;&#9;InvalidateRect(hwnd, NULL, TRUE);&#10;&#9;&#9;return 0;&#10;&#10;&#9;&#9;case WM_LBUTTONDOWN:&#10;&#9;&#9;&#9;&#123;&#10;&#9;&#9;&#9;    hitPoint.x = LOWORD(lParam);&#10;&#9;&#9;&#9;&#9;hitPoint.y = HIWORD(lParam);&#10;&#9;&#9;&#9;&#9;for (i = 0; i &#38;amp;lt; NUM; i++)&#10;&#9;&#9;&#9;&#9;&#123;&#10;&#9;&#9;&#9;&#9;&#9;if (hitPoint.x &#38;amp;gt;= rect[i].xLeft &#38;amp;amp;&#38;amp;amp; hitPoint.x &#38;amp;lt;= rect[i].xRight &#38;amp;amp;&#38;amp;amp; hitPoint.y &#38;amp;gt;= rect[i].yTop &#38;amp;amp;&#38;amp;amp; hitPoint.y &#38;amp;lt;= rect[i].yBottom )&#10;&#9;&#9;&#9;&#9;&#9;&#123;&#10;&#9;&#9;&#9;&#9;&#9;&#9;_itow(i+1, str_i, 10);&#10;&#9;&#9;&#9;&#9;&#9;&#9;wsprintfW(str1, TEXT(&#38;quot;close %s.mp3&#38;quot;),str_i);&#10;&#9;&#9;&#9;&#9;&#9;&#9;wsprintfW(str2, TEXT(&#38;quot;play %s.mp3&#38;quot;),str_i);&#10;&#9;&#9;&#9;&#9;&#9;&#9;mciSendString(str1, NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;&#9;mciSendString(str2, NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;&#9;break;&#10;&#9;&#9;&#9;&#9;&#9;&#125;&#10;&#9;&#9;&#9;&#9;&#125;&#10;&#9;&#9;&#9;&#125;&#10;&#9;&#9;break;&#10;&#10;&#9;&#9;case WM_PAINT:&#10;&#9;&#9;&#9;hdc = BeginPaint (hwnd, &#38;amp;amp;ps);&#10;&#9;&#9;&#9;hPen = CreatePen (PS_SOLID, 1, RGB(255,0,0));&#10;&#9;&#9;&#9;SelectObject (hdc, hPen);&#10;&#10;&#9;&#9;&#9;//hBrush = (HBRUSH)GetStockObject (GRAY_BRUSH);&#10;&#9;&#9;&#9;rect[0].xLeft    =  400   ;&#10;&#9;&#9;&#9;rect[0].xRight   =  420   ;&#10;&#9;&#9;&#9;rect[0].yTop     =  210    ;&#10;&#9;&#9;&#9;rect[0].yBottom  =  300   ;&#10;&#9;&#9;&#9;Rectangle(hdc, rect[0].xLeft, rect[0].yTop, rect[0].xRight, rect[0].yBottom);&#10;&#10;&#9;&#9;&#9;for (j = 1; j &#38;amp;lt; NUM; j++)&#10;&#9;&#9;&#9;&#123;&#10;&#9;&#9;&#9;&#9;rect[j].xLeft    = rect[j-1].xLeft  + 20   ;&#10;&#9;&#9;&#9;&#9;rect[j].xRight   = rect[j-1].xRight + 20   ;&#10;&#9;&#9;&#9;&#9;rect[j].yTop     = rect[0].yTop            ;&#10;&#9;&#9;&#9;&#9;rect[j].yBottom  = rect[0].yBottom         ;&#10;&#9;&#9;&#9;&#9;Rectangle(hdc, rect[j].xLeft, rect[j].yTop, rect[j].xRight, rect[j].yBottom);&#10;&#9;&#9;&#9;&#125;&#10;&#10;&#9;&#9;&#9;if (Flag[i] == 1)&#123;&#10;&#9;&#9;&#9;&#9;SelectObject(hdc, (HBRUSH)GetStockObject (GRAY_BRUSH));&#10;&#9;&#9;&#9;&#9;Rectangle(hdc, rect[i].xLeft, rect[i].yTop, rect[i].xRight, rect[i].yBottom);&#10;&#9;&#9;&#9;&#125;&#10;&#9;&#9;&#9;else if (NUM == i)&#123;&#10;&#9;&#9;&#9;&#9;SelectObject(hdc, (HBRUSH)GetStockObject (WHITE_BRUSH));&#10;&#9;&#9;&#9;&#9;Rectangle(hdc, rect[i].xLeft, rect[i].yTop, rect[i].xRight, rect[i].yBottom);&#10;&#9;&#9;&#9;&#125;&#10;&#10;&#9;&#9;&#9;DeleteObject(hPen);&#10;&#9;&#9;&#9;EndPaint(hwnd, &#38;amp;amp;ps);&#10;&#9;&#9;return 0;&#10;&#9;&#9;case WM_KEYDOWN:&#10;&#9;&#9;&#9;switch(wParam)&#10;&#9;&#9;&#9;&#123;&#10;&#9;&#9;&#9;&#9;case 0x31:&#10;&#9;&#9;&#9;&#9;&#9;i = 0;&#10;&#9;&#9;&#9;&#9;&#9;Flag[i] = 1;&#10;&#9;&#9;&#9;&#9;&#9;InvalidateRect(hwnd, NULL, TRUE);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;quot;close 1.mp3&#38;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;quot;play 1.mp3&#38;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;break;&#10;&#9;&#9;&#9;&#9;case 0x32:&#10;&#9;&#9;&#9;&#9;&#9;i = 1;&#10;&#9;&#9;&#9;&#9;&#9;Flag[i] = 1;&#10;&#9;&#9;&#9;&#9;&#9;InvalidateRect(hwnd, NULL, TRUE);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;quot;close 2.mp3&#38;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;quot;play 2.mp3&#38;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;break;&#10;&#9;&#9;&#9;&#9;case 0x33:&#10;&#9;&#9;&#9;&#9;&#9;i = 2;&#10;&#9;&#9;&#9;&#9;&#9;Flag[i] = 1;&#10;&#9;&#9;&#9;&#9;&#9;InvalidateRect(hwnd, NULL, TRUE);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;close 3.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;play 3.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;break;&#10;&#9;&#9;&#9;&#9;case 0x34:&#10;&#9;&#9;&#9;&#9;&#9;i = 3;&#10;&#9;&#9;&#9;&#9;&#9;Flag[i] = 1;&#10;&#9;&#9;&#9;&#9;&#9;InvalidateRect(hwnd, NULL, TRUE);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;close 4.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;play 4.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;break;&#10;&#9;&#9;&#9;&#9;case 0x35:&#10;&#9;&#9;&#9;&#9;&#9;i = 4;&#10;&#9;&#9;&#9;&#9;&#9;Flag[i] = 1;&#10;&#9;&#9;&#9;&#9;&#9;InvalidateRect(hwnd, NULL, TRUE);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;close 5.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;play 5.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;break;&#10;&#9;&#9;&#9;&#9;case 0x36:&#10;&#9;&#9;&#9;&#9;&#9;i = 5;&#10;&#9;&#9;&#9;&#9;&#9;Flag[i] = 1;&#10;&#9;&#9;&#9;&#9;&#9;InvalidateRect(hwnd, NULL, TRUE);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;close 6.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;play 6.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;break;&#10;&#9;&#9;&#9;&#9;case 0x37:&#10;&#9;&#9;&#9;&#9;&#9;i = 6;&#10;&#9;&#9;&#9;&#9;&#9;Flag[i] = 1;&#10;&#9;&#9;&#9;&#9;&#9;InvalidateRect(hwnd, NULL, TRUE);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;close 7.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;play 7.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;break;&#10;&#9;&#9;&#9;&#9;case 0x38:&#10;&#9;&#9;&#9;&#9;&#9;i = 7;&#10;&#9;&#9;&#9;&#9;&#9;Flag[i] = 1;&#10;&#9;&#9;&#9;&#9;&#9;InvalidateRect(hwnd, NULL, TRUE);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;close 8.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;play 8.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;break;&#10;&#9;&#9;&#9;&#9;case 0x39:&#10;&#9;&#9;&#9;&#9;&#9;i = 8;&#10;&#9;&#9;&#9;&#9;&#9;Flag[i] = 1;&#10;&#9;&#9;&#9;&#9;&#9;InvalidateRect(hwnd, NULL, TRUE);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;close 9.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;play 9.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;break;&#10;&#9;&#9;&#9;&#9;case 0x30:&#10;&#9;&#9;&#9;&#9;&#9;i = 9;&#10;&#9;&#9;&#9;&#9;&#9;Flag[i] = 1;&#10;&#9;&#9;&#9;&#9;&#9;InvalidateRect(hwnd, NULL, TRUE);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;close 10.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;mciSendString(TEXT(&#38;amp;quot;play 10.mp3&#38;amp;quot;), NULL, 0, NULL);&#10;&#9;&#9;&#9;&#9;&#9;break;&#10;&#10;&#9;&#9;&#9;&#125;&#10;&#9;&#9;return 0;&#10;&#10;&#9;&#9;case WM_DESTROY:&#10;&#9;&#9;&#9;PostQuitMessage (0);&#10;&#9;&#9;return 0;&#10;&#9;&#125;&#10;&#9;return DefWindowProc (hwnd, message, wParam, lParam) ;&#10;&#125;</span><br></pre></td></tr></table></figure><p></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2012/01/05/关于位运算符实现的问题/" itemprop="url">
                关于位运算符实现的问题
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-01-05T16:32:00+08:00" content="2012-01-05">
            2012-01-05
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>今天在看SDK教学文章的时候，发现了一个关于位运算符的问题</p>
<p>首先附上关键代码段：</p>
<figure class="highlight"><figcaption><span>WM_LBUTTONDOWN:</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#10;    hitPoint.x = LOWORD(lParam);&#10;    hitPoint.y = HIWORD(lParam);&#10;    MouseClick = TRUE;&#10;    InvalidateRect(hWnd,NULL,TRUE);&#10;&#125;&#10;break;</span><br></pre></td></tr></table></figure>
<p>解释下这个代码段：</p>
<p>处理当鼠标左键被按下的时候，保存存储在lParam中的鼠标所在的x,y的位置。但是它是如何被保存的呢？</p>
<p>这里引用了一个结构体hitPoint，我找到它的定义：</p>
<p>POINT hitPoint;</p>
<p>找到关于lParam的定义：</p>
<p>LPARAM lParam;</p>
<p>&nbsp;&nbsp; &nbsp;</p>
<p>然后再找到POINT这个结构体变量的定义：</p>
<figure class="highlight"><figcaption><span>struct tagPOINT</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#10;       LONG x;&#10;       LONG y;&#10;&#125; POINT, *PPOINT;</span><br></pre></td></tr></table></figure>
<p>最后找到两处宏定义：</p>
<figure class="highlight"><figcaption><span>LOWORD(l)           ((WORD)(l))</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define HIWORD(l)           ((WORD)(((DWORD)(l) &#38;gt;&#38;gt; 16) &#38;amp; 0xFFFF))</span><br></pre></td></tr></table></figure>
<p>&nbsp;</p>
<p>找到LPARAM的类型重定义</p>
<figure class="highlight"><figcaption><span>LONG_PTR            LPARAM;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;typedef _W64 long LONG_PTR, *PLONG_PTR;&#10;&#10;long LONG_PTR</span><br></pre></td></tr></table></figure>
<p>&nbsp;</p>
<p>&nbsp;最后再看看WORD和DWORD的类型重定义：</p>
<p>&nbsp;typedef unsigned short&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WORD;&nbsp;&nbsp;&nbsp; 无符号16位整数</p>
<p>&nbsp;</p>
<p>&nbsp;typedef unsigned long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DWORD;&nbsp;&nbsp; 无符号32位整数</p>
<p>&nbsp;额，好不容易终于转到了，那么long就是32位有符号整数了。找到了这些东西，现在再来看看宏是怎么处理位运算的。</p>
<p>&nbsp;hitPoint.x = LOWORD(lParam);</p>
<p>&nbsp;这个时候经过宏 </p>
<p>&nbsp;#define LOWORD(l)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ((WORD)(l))处理会变成</p>
<p>&nbsp;</p>
<p>&nbsp;hitPoint.x = ((WORD)(lParam));</p>
<p>&nbsp;还记得刚才lParam的定义吧，是long类型的，而</p>
<p>&nbsp;WORD是unsigned short类型的，这里做了强制类型转换,</p>
<p>&nbsp;使得hinPoint.x得到了低16位的lParam&#20540;</p>
<p>&nbsp;</p>
<p>&nbsp;再看看</p>
<p>&nbsp;hitPoint.y = HIWORD(lParam);</p>
<p>&nbsp;经过宏替换后</p>
<p>&nbsp;</p>
<p>&nbsp;hitPoint.y = ((WORD)(((DWORD)(lParam) &gt;&gt; 16) &amp; 0xFFFF));</p>
<p>&nbsp;</p>
<p>&nbsp;这样，我们举个例子好了</p>
<p>&nbsp;首先假设一下lParam的&#20540;如下：</p>
<p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 左（高位）&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 右（低位）</p>
<p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 1110000101010111&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0001010101110001</p>
<p>强制类型转变DWORD后 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 1110000101010111&nbsp;&nbsp;&nbsp; &nbsp; 0001010101110001</p>
<p>右移16位后&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 1111111111111111 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 1110000101010111</p>
<p>按位与运算&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;&nbsp; 000000000000000&nbsp; &nbsp; &nbsp;&nbsp; 1111111111111111</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</p>
<p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1111111111111111&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1110000101010111</p>
<p>最后强制类型转换得到低位的16位 1110000101010111</p>
<p>其实这个数&#20540;就是lParam的高16位的&#20540;，大家看是不是这样的？</p>
<p>如此一来，我们就将原来lParam = 1110000101010111&nbsp;&nbsp; 0001010101110001</p>
<p>经过语句后最终变成了我们想要得到的效果：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</p>
<p>&nbsp;hitPoint.x = 0001010101110001</p>
<p>&nbsp;hitPoint.y = 1110000101010111</p>
<p>&nbsp;</p>
<p>&nbsp;好了，我的疑惑现在终于解开了，两个变量终于得到了鼠标x,y轴的坐标了</p>
<p>&nbsp;</p>
<p>&nbsp;^_^</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2012/01/01/windows-SDK模拟游戏钢琴的实现-一/" itemprop="url">
                windows SDK模拟游戏钢琴的实现(一)
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-01-01T23:02:00+08:00" content="2012-01-01">
            2012-01-01
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>&nbsp; 最近想做一个模拟钢琴的小软件，想做个既有键盘接口又有鼠标接口的小软件。所涉及到的知识点如下：</p>
<p>&nbsp; 1.有关键盘的知识</p>
<p>&nbsp; 2.有关鼠标的知识</p>
<p>&nbsp; 3.GDI的知识</p>
<p>&nbsp; 4.媒体播放函数的有关知识</p>
<p>&nbsp; 因为这几天也正好在看这些内容，所以理论结合实际是最好的学习方式</p>
<p>&nbsp; </p>
<p>首先要找钢琴音阶，但是上网找了一圈也没有发现，最后在4399里面找到一个差不多类型的模拟钢琴游戏，而且音色不错，索性用Adobe Audition的录音功能将每个音阶都录下来做一些编辑，自己制作了20来个音阶，用mp3&#26684;式保存。</p>
<p>然后用的是mcisendstring函数实现mp3&#26684;式音乐的播放。</p>
<p>第一步首先做键盘接口，其实这一步还是比较简单的，在窗口过程里面处理对应的虚拟键码的消息就行了，这里遇到了一个小问题，找不到 &lt;,&nbsp; 和&nbsp; &gt;.&nbsp; 这两个按键对应的虚拟键码了，找了一下虚拟键码表上面好像也没有写啊？先暂时搁下</p>
<p>成果做出来以后，发现一个比较严重的问题，就是使用mcisendstring这个宏的时候，不能同时打开某个音乐文件，这样比如我的la这个音阶有2秒的话，必须要等到2秒结束以后才能再次播放，这样显然影响了连续的效果，目前也没有什么好的解决方案。</p>
<p>第二步就要涉及到GDI和鼠标接口了，这一部分正在看，等到成品做出来以后在附上源码吧。</p>
<p>昨天晚上做梦的时候突然想到怎么实现可以几乎同时按一个键发出声音了，话说梦真是个神奇的东西啊。</p>
<p>既然不能同时打开同一个音乐文件，那么我在每次打开前关闭这个音乐文件不就实现这个效果了吗？想到了确实觉得挺简单的，但是昨天怎么就没想到呢？呵呵，下面先附上我键盘接口的代码：</p>
<p></p><p></p>
<p>/*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</p>
<p>   a piano program</p>
<p>  &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;*/</p>
<h1 id="include">include <windows.h></windows.h></h1><h1 id="include-1">include <mmsystem.h></mmsystem.h></h1><h1 id="pragma_comment(lib,_&#8220;WINMM-LIB&#8221;)">pragma comment(lib, &#8220;WINMM.LIB&#8221;)</h1><p>LRESULT CALLBACK WndProc (HWND, UINT, WPARAM, LPARAM) ;</p>
<p>int WINAPI WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance,</p>
<pre><code>PSTR szCmdLine, <span class="keyword">int</span> iCmdShow)
</code></pre><p>{</p>
<pre><code>static TCHAR szAppName[] = TEXT (&amp;quot<span class="comment">;HelloWin&amp;quot;) ;</span>

HWND         hwnd <span class="comment">;</span>

MSG          msg <span class="comment">;</span>

WNDCLASS     wndclass <span class="comment">;</span>

wndclass.style         = CS_HREDRAW | CS_VREDRAW <span class="comment">;</span>

wndclass.lpfnWndProc   = WndProc <span class="comment">;</span>

wndclass.cbClsExtra    = 0 <span class="comment">;</span>

wndclass.cbWndExtra    = 0 <span class="comment">;</span>

wndclass.hInstance     = hInstance <span class="comment">;</span>

wndclass.hIcon         = LoadIcon (NULL, IDI_APPLICATION) <span class="comment">;</span>

wndclass.hCursor       = LoadCursor (NULL, IDC_ARROW) <span class="comment">;</span>

wndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH) <span class="comment">;</span>

wndclass.lpszMenuName  = NULL <span class="comment">;</span>

wndclass.lpszClassName = szAppName <span class="comment">;</span>

if (!RegisterClass (&amp;amp<span class="comment">;wndclass))</span>

{

     MessageBox (NULL, TEXT (&amp;quot<span class="comment">;This program requires Windows NT!&amp;quot;),</span>

                 szAppName, MB_ICONERROR) <span class="comment">;</span>

     return 0 <span class="comment">;</span>

}

hwnd = CreateWindow (szAppName,                  // window class name

                     TEXT (&amp;quot<span class="comment">;The Hello Program&amp;quot;), // window caption</span>

                     WS_OVERLAPPEDWINDOW,        // window style

                     CW_USEDEFAULT,              // initial x position

                     CW_USEDEFAULT,              // initial y position

                     CW_USEDEFAULT,              // initial x size

                     CW_USEDEFAULT,              // initial y size

                     NULL,                       // parent window handle

                     NULL,                       // window menu handle

                     hInstance,                  // program instance handle

                     NULL) <span class="comment">;                     // creation parameters</span>

ShowWindow (hwnd, iCmdShow) <span class="comment">;</span>

UpdateWindow (hwnd) <span class="comment">;</span>

while (GetMessage (&amp;amp<span class="comment">;msg, NULL, 0, 0))</span>

{

     TranslateMessage (&amp;amp<span class="comment">;msg) ;</span>

     DispatchMessage (&amp;amp<span class="comment">;msg) ;</span>

}

return msg.wParam <span class="comment">;</span>
</code></pre><p>}</p>
<p>LRESULT CALLBACK WndProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</p>
<p>{</p>
<pre><code>HDC         hdc;

PAINTSTRUCT ps ;

RECT        rect;

<span class="keyword">switch</span> (message)

{

<span class="keyword">case</span> <span class="string">WM_CREATE:</span>

     <span class="keyword">return</span> <span class="number">0</span> ;

<span class="keyword">case</span> <span class="string">WM_PAINT:</span>

     hdc = BeginPaint (hwnd, &amp;amp;ps);

     GetClientRect (hwnd, &amp;amp;rect);

     DrawText (hdc, TEXT (&amp;quot;an intersting piano game^_^  just use keyboard&amp;quot; ), -<span class="number">1</span>, &amp;amp;rect,

               DT_SINGLELINE | DT_CENTER | DT_VCENTER);

     EndPaint (hwnd, &amp;amp;ps) ;

     <span class="keyword">return</span> <span class="number">0</span> ;

<span class="keyword">case</span> <span class="string">WM_KEYDOWN:</span>

    <span class="keyword">switch</span>(wParam)

    {

    <span class="keyword">case</span> <span class="number">0</span>&amp;#<span class="number">215</span>;<span class="number">31</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//1.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//1.mp3&amp;quot;), NULL, 0, NULL);       //0-9键盘接口</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">0</span>&amp;#<span class="number">215</span>;<span class="number">32</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//2.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//2.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">0</span>&amp;#<span class="number">215</span>;<span class="number">33</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//3.mp3&amp;quot;), NULL, 0, NULL);</span>

       mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//3.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">0</span>&amp;#<span class="number">215</span>;<span class="number">34</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//4.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//4.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">0</span>&amp;#<span class="number">215</span>;<span class="number">35</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//5.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//5.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">0</span>&amp;#<span class="number">215</span>;<span class="number">36</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//6.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//6.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">0</span>&amp;#<span class="number">215</span>;<span class="number">37</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//7.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//7.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">0</span>&amp;#<span class="number">215</span>;<span class="number">38</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//8.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//8.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">0</span>&amp;#<span class="number">215</span>;<span class="number">39</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//9.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//9.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">0</span>&amp;#<span class="number">215</span>;<span class="number">30</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//10.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//10.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">65</span>:                                                                                                <span class="comment">//字母键盘接口</span>

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//1.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//1.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">90</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//2.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//2.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">83</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//3.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//3.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">88</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//4.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//4.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">68</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//5.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//5.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">67</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//6.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//6.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">70</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//7.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//7.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">86</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//8.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//8.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">71</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//9.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//9.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">66</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//10.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//10.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">72</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//11.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//11.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">78</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//12.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//12.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">74</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//13.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//13.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">77</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//14.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//14.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">75</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//15.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//15.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="string">VK_OEM_8:</span>

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//16.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//16.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="number">76</span>:

        mciSendString(TEXT(&amp;quot;close <span class="string">c:</span><span class="comment">//17.mp3&amp;quot;), NULL, 0, NULL);</span>

        mciSendString(TEXT(&amp;quot;play <span class="string">c:</span><span class="comment">//17.mp3&amp;quot;), NULL, 0, NULL);</span>

        <span class="keyword">break</span>;

    }

    <span class="keyword">return</span> <span class="number">0</span>;

<span class="keyword">case</span> <span class="string">WM_DESTROY:</span>

     PostQuitMessage (<span class="number">0</span>) ;

     <span class="keyword">return</span> <span class="number">0</span> ;

}

<span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam) ;
</code></pre><p>}</p>
<p>[/c]</p>
<p>中间有很多东西都是重复的，只是简单地完成了一个音乐播放的功能，而且也没有加上资源，加上GDI等东西。</p>
<p>这几天偶尔在书上看到了类&#20284;的一个程序，集合了菜单，资源等很多功能，是用MIDI来控制音乐播放的，所以有很多选项可以选择，下面附上代码：</p>
<p></p><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">   KBMIDI.C -- Keyboard MIDI Player&#10;               (c) Charles Petzold, 1998&#10;  ---------------------------------------*/&#10;&#10;#include &#38;lt;windows.h&#38;gt;&#10;&#10;// Defines for Menu IDs&#10;// --------------------&#10;&#10;#define IDM_OPEN    0x100&#10;#define IDM_CLOSE   0x101&#10;#define IDM_DEVICE  0x200&#10;#define IDM_CHANNEL 0x300&#10;#define IDM_VOICE   0x400&#10;&#10;LRESULT CALLBACK WndProc (HWND, UINT, WPARAM, LPARAM);&#10;&#10;TCHAR    szAppName [] = TEXT (&#38;amp;quot;KBMidi&#38;amp;quot;) ;&#10;HMIDIOUT hMidiOut ;&#10;int      iDevice = MIDIMAPPER, iChannel = 0, iVoice = 0, iVelocity = 64 ;&#10;int      cxCaps, cyChar, xOffset, yOffset ;&#10;&#10;     // Structures and data for showing families and instruments on menu&#10;     // ----------------------------------------------------------------&#10;&#10;typedef struct&#10;&#123;&#10;     TCHAR * szInst ;&#10;     int    iVoice ;&#10;&#125;&#10;INSTRUMENT ;&#10;&#10;typedef struct&#10;&#123;&#10;     TCHAR      * szFam ;&#10;     INSTRUMENT   inst [8] ;&#10;&#125;&#10;FAMILY ;&#10;&#10;FAMILY fam [16] = &#123;&#10;&#10;     TEXT (&#38;amp;quot;Piano&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;Acoustic Grand Piano&#38;amp;quot;),        0,&#10;          TEXT (&#38;amp;quot;Bright Acoustic Piano&#38;amp;quot;),       1,&#10;          TEXT (&#38;amp;quot;Electric Grand Piano&#38;amp;quot;),        2,&#10;          TEXT (&#38;amp;quot;Honky-tonk Piano&#38;amp;quot;),            3,&#10;          TEXT (&#38;amp;quot;Rhodes Piano&#38;amp;quot;),                4,&#10;          TEXT (&#38;amp;quot;Chorused Piano&#38;amp;quot;),              5,&#10;          TEXT (&#38;amp;quot;Harpsichord&#38;amp;quot;),                 6,&#10;          TEXT (&#38;amp;quot;Clavinet&#38;amp;quot;),                    7,&#10;&#10;     TEXT (&#38;amp;quot;Chromatic Percussion&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;Celesta&#38;amp;quot;),                     8,&#10;          TEXT (&#38;amp;quot;Glockenspiel&#38;amp;quot;),                9,&#10;          TEXT (&#38;amp;quot;Music Box&#38;amp;quot;),                   10,&#10;          TEXT (&#38;amp;quot;Vibraphone&#38;amp;quot;),                  11,&#10;          TEXT (&#38;amp;quot;Marimba&#38;amp;quot;),                     12,&#10;          TEXT (&#38;amp;quot;Xylophone&#38;amp;quot;),                   13,&#10;          TEXT (&#38;amp;quot;Tubular Bells&#38;amp;quot;),               14,&#10;          TEXT (&#38;amp;quot;Dulcimer&#38;amp;quot;),                    15,&#10;&#10;     TEXT (&#38;amp;quot;Organ&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;Hammond Organ&#38;amp;quot;),               16,&#10;          TEXT (&#38;amp;quot;Percussive Organ&#38;amp;quot;),            17,&#10;          TEXT (&#38;amp;quot;Rock Organ&#38;amp;quot;),                  18,&#10;          TEXT (&#38;amp;quot;Church Organ&#38;amp;quot;),                19,&#10;          TEXT (&#38;amp;quot;Reed Organ&#38;amp;quot;),                  20,&#10;          TEXT (&#38;amp;quot;Accordian&#38;amp;quot;),                   21,&#10;          TEXT (&#38;amp;quot;Harmonica&#38;amp;quot;),                   22,&#10;          TEXT (&#38;amp;quot;Tango Accordian&#38;amp;quot;),             23,&#10;&#10;     TEXT (&#38;amp;quot;Guitar&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;Acoustic Guitar (nylon)&#38;amp;quot;),     24,&#10;          TEXT (&#38;amp;quot;Acoustic Guitar (steel)&#38;amp;quot;),     25,&#10;          TEXT (&#38;amp;quot;Electric Guitar (jazz)&#38;amp;quot;),      26,&#10;          TEXT (&#38;amp;quot;Electric Guitar (clean)&#38;amp;quot;),     27,&#10;          TEXT (&#38;amp;quot;Electric Guitar (muted)&#38;amp;quot;),     28,&#10;          TEXT (&#38;amp;quot;Overdriven Guitar&#38;amp;quot;),           29,&#10;          TEXT (&#38;amp;quot;Distortion Guitar&#38;amp;quot;),           30,&#10;          TEXT (&#38;amp;quot;Guitar Harmonics&#38;amp;quot;),            31,&#10;&#10;     TEXT (&#38;amp;quot;Bass&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;Acoustic Bass&#38;amp;quot;),               32,&#10;          TEXT (&#38;amp;quot;Electric Bass (finger)&#38;amp;quot;),      33,&#10;          TEXT (&#38;amp;quot;Electric Bass (pick)&#38;amp;quot;),        34,&#10;          TEXT (&#38;amp;quot;Fretless Bass&#38;amp;quot;),               35,&#10;          TEXT (&#38;amp;quot;Slap Bass 1&#38;amp;quot;),                 36,&#10;          TEXT (&#38;amp;quot;Slap Bass 2&#38;amp;quot;),                 37,&#10;          TEXT (&#38;amp;quot;Synth Bass 1&#38;amp;quot;),                38,&#10;          TEXT (&#38;amp;quot;Synth Bass 2&#38;amp;quot;),                39,&#10;&#10;     TEXT (&#38;amp;quot;Strings&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;Violin&#38;amp;quot;),                      40,&#10;          TEXT (&#38;amp;quot;Viola&#38;amp;quot;),                       41,&#10;          TEXT (&#38;amp;quot;Cello&#38;amp;quot;),                       42,&#10;          TEXT (&#38;amp;quot;Contrabass&#38;amp;quot;),                  43,&#10;          TEXT (&#38;amp;quot;Tremolo Strings&#38;amp;quot;),             44,&#10;          TEXT (&#38;amp;quot;Pizzicato Strings&#38;amp;quot;),           45,&#10;          TEXT (&#38;amp;quot;Orchestral Harp&#38;amp;quot;),             46,&#10;          TEXT (&#38;amp;quot;Timpani&#38;amp;quot;),                     47,&#10;&#10;     TEXT (&#38;amp;quot;Ensemble&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;String Ensemble 1&#38;amp;quot;),           48,&#10;          TEXT (&#38;amp;quot;String Ensemble 2&#38;amp;quot;),           49,&#10;          TEXT (&#38;amp;quot;Synth Strings 1&#38;amp;quot;),             50,&#10;          TEXT (&#38;amp;quot;Synth Strings 2&#38;amp;quot;),             51,&#10;          TEXT (&#38;amp;quot;Choir Aahs&#38;amp;quot;),                  52,&#10;          TEXT (&#38;amp;quot;Voice Oohs&#38;amp;quot;),                  53,&#10;          TEXT (&#38;amp;quot;Synth Voice&#38;amp;quot;),                 54,&#10;          TEXT (&#38;amp;quot;Orchestra Hit&#38;amp;quot;),               55,&#10;&#10;     TEXT (&#38;amp;quot;Brass&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;Trumpet&#38;amp;quot;),                     56,&#10;          TEXT (&#38;amp;quot;Trombone&#38;amp;quot;),                    57,&#10;          TEXT (&#38;amp;quot;Tuba&#38;amp;quot;),                        58,&#10;          TEXT (&#38;amp;quot;Muted Trumpet&#38;amp;quot;),               59,&#10;          TEXT (&#38;amp;quot;French Horn&#38;amp;quot;),                 60,&#10;          TEXT (&#38;amp;quot;Brass Section&#38;amp;quot;),               61,&#10;          TEXT (&#38;amp;quot;Synth Brass 1&#38;amp;quot;),               62,&#10;          TEXT (&#38;amp;quot;Synth Brass 2&#38;amp;quot;),               63,&#10;&#10;     TEXT (&#38;amp;quot;Reed&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;Soprano Sax&#38;amp;quot;),                 64,&#10;          TEXT (&#38;amp;quot;Alto Sax&#38;amp;quot;),                    65,&#10;          TEXT (&#38;amp;quot;Tenor Sax&#38;amp;quot;),                   66,&#10;          TEXT (&#38;amp;quot;Baritone Sax&#38;amp;quot;),                67,&#10;          TEXT (&#38;amp;quot;Oboe&#38;amp;quot;),                        68,&#10;          TEXT (&#38;amp;quot;English Horn&#38;amp;quot;),                69,&#10;          TEXT (&#38;amp;quot;Bassoon&#38;amp;quot;),                     70,&#10;          TEXT (&#38;amp;quot;Clarinet&#38;amp;quot;),                    71,&#10;&#10;     TEXT (&#38;amp;quot;Pipe&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;Piccolo&#38;amp;quot;),                     72,&#10;          TEXT (&#38;amp;quot;Flute&#38;amp;quot;),                       73,&#10;          TEXT (&#38;amp;quot;Recorder&#38;amp;quot;),                    74,&#10;          TEXT (&#38;amp;quot;Pan Flute&#38;amp;quot;),                   75,&#10;          TEXT (&#38;amp;quot;Bottle Blow&#38;amp;quot;),                 76,&#10;          TEXT (&#38;amp;quot;Shakuhachi&#38;amp;quot;),                  77,&#10;          TEXT (&#38;amp;quot;Whistle&#38;amp;quot;),                     78,&#10;          TEXT (&#38;amp;quot;Ocarina&#38;amp;quot;),                     79,&#10;&#10;     TEXT (&#38;amp;quot;Synth Lead&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;Lead 1 (square)&#38;amp;quot;),             80,&#10;          TEXT (&#38;amp;quot;Lead 2 (sawtooth)&#38;amp;quot;),           81,&#10;          TEXT (&#38;amp;quot;Lead 3 (caliope lead)&#38;amp;quot;),       82,&#10;          TEXT (&#38;amp;quot;Lead 4 (chiff lead)&#38;amp;quot;),         83,&#10;          TEXT (&#38;amp;quot;Lead 5 (charang)&#38;amp;quot;),            84,&#10;          TEXT (&#38;amp;quot;Lead 6 (voice)&#38;amp;quot;),              85,&#10;          TEXT (&#38;amp;quot;Lead 7 (fifths)&#38;amp;quot;),             86,&#10;          TEXT (&#38;amp;quot;Lead 8 (brass + lead)&#38;amp;quot;),       87,&#10;&#10;     TEXT (&#38;amp;quot;Synth Pad&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;Pad 1 (new age)&#38;amp;quot;),             88,&#10;          TEXT (&#38;amp;quot;Pad 2 (warm)&#38;amp;quot;),                89,&#10;          TEXT (&#38;amp;quot;Pad 3 (polysynth)&#38;amp;quot;),           90,&#10;          TEXT (&#38;amp;quot;Pad 4 (choir)&#38;amp;quot;),               91,&#10;          TEXT (&#38;amp;quot;Pad 5 (bowed)&#38;amp;quot;),               92,&#10;          TEXT (&#38;amp;quot;Pad 6 (metallic)&#38;amp;quot;),            93,&#10;          TEXT (&#38;amp;quot;Pad 7 (halo)&#38;amp;quot;),                94,&#10;          TEXT (&#38;amp;quot;Pad 8 (sweep)&#38;amp;quot;),               95,&#10;&#10;     TEXT (&#38;amp;quot;Synth Effects&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;FX 1 (rain)&#38;amp;quot;),                 96,&#10;          TEXT (&#38;amp;quot;FX 2 (soundtrack)&#38;amp;quot;),           97,&#10;          TEXT (&#38;amp;quot;FX 3 (crystal)&#38;amp;quot;),              98,&#10;          TEXT (&#38;amp;quot;FX 4 (atmosphere)&#38;amp;quot;),           99,&#10;          TEXT (&#38;amp;quot;FX 5 (brightness)&#38;amp;quot;),           100,&#10;          TEXT (&#38;amp;quot;FX 6 (goblins)&#38;amp;quot;),              101,&#10;          TEXT (&#38;amp;quot;FX 7 (echoes)&#38;amp;quot;),               102,&#10;          TEXT (&#38;amp;quot;FX 8 (sci-fi)&#38;amp;quot;),               103,&#10;&#10;     TEXT (&#38;amp;quot;Ethnic&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;Sitar&#38;amp;quot;),                       104,&#10;          TEXT (&#38;amp;quot;Banjo&#38;amp;quot;),                       105,&#10;          TEXT (&#38;amp;quot;Shamisen&#38;amp;quot;),                    106,&#10;          TEXT (&#38;amp;quot;Koto&#38;amp;quot;),                        107,&#10;          TEXT (&#38;amp;quot;Kalimba&#38;amp;quot;),                     108,&#10;          TEXT (&#38;amp;quot;Bagpipe&#38;amp;quot;),                     109,&#10;          TEXT (&#38;amp;quot;Fiddle&#38;amp;quot;),                      110,&#10;          TEXT (&#38;amp;quot;Shanai&#38;amp;quot;),                      111,&#10;&#10;     TEXT (&#38;amp;quot;Percussive&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;Tinkle Bell&#38;amp;quot;),                 112,&#10;          TEXT (&#38;amp;quot;Agogo&#38;amp;quot;),                       113,&#10;          TEXT (&#38;amp;quot;Steel Drums&#38;amp;quot;),                 114,&#10;          TEXT (&#38;amp;quot;Woodblock&#38;amp;quot;),                   115,&#10;          TEXT (&#38;amp;quot;Taiko Drum&#38;amp;quot;),                  116,&#10;          TEXT (&#38;amp;quot;Melodic Tom&#38;amp;quot;),                 117,&#10;          TEXT (&#38;amp;quot;Synth Drum&#38;amp;quot;),                  118,&#10;          TEXT (&#38;amp;quot;Reverse Cymbal&#38;amp;quot;),              119,&#10;&#10;     TEXT (&#38;amp;quot;Sound Effects&#38;amp;quot;),&#10;&#10;          TEXT (&#38;amp;quot;Guitar Fret Noise&#38;amp;quot;),           120,&#10;          TEXT (&#38;amp;quot;Breath Noise&#38;amp;quot;),                121,&#10;          TEXT (&#38;amp;quot;Seashore&#38;amp;quot;),                    122,&#10;          TEXT (&#38;amp;quot;Bird Tweet&#38;amp;quot;),                  123,&#10;          TEXT (&#38;amp;quot;Telephone Ring&#38;amp;quot;),              124,&#10;          TEXT (&#38;amp;quot;Helicopter&#38;amp;quot;),                  125,&#10;          TEXT (&#38;amp;quot;Applause&#38;amp;quot;),                    126,&#10;          TEXT (&#38;amp;quot;Gunshot&#38;amp;quot;),                     127 &#125; ;&#10;&#10;     // Data for translating scan codes to octaves and notes&#10;     // ----------------------------------------------------&#10;&#10;#define NUMSCANS    (sizeof key / sizeof key[0])&#10;&#10;struct&#10;&#123;&#10;     int     iOctave ;&#10;     int     iNote ;&#10;     int     yPos ;&#10;     int     xPos ;&#10;     TCHAR * szKey ;&#10;&#125;&#10;key [] =&#10;&#123;&#10;                                         // Scan  Char  Oct  Note&#10;                                         // ----  ----  ---  ----&#10;         -1, -1, -1, -1, NULL,           //   0   None&#10;         -1, -1, -1, -1, NULL,           //   1   Esc&#10;         -1, -1,  0,  0, TEXT (&#38;amp;quot;&#38;amp;quot;),      //   2     1&#10;          5,  1,  0,  2, TEXT (&#38;amp;quot;C#&#38;amp;quot;),    //   3     2    5    C#&#10;          5,  3,  0,  4, TEXT (&#38;amp;quot;D#&#38;amp;quot;),    //   4     3    5    D#&#10;         -1, -1,  0,  6, TEXT (&#38;amp;quot;&#38;amp;quot;),      //   5     4&#10;          5,  6,  0,  8, TEXT (&#38;amp;quot;F#&#38;amp;quot;),    //   6     5    5    F#&#10;          5,  8,  0, 10, TEXT (&#38;amp;quot;G#&#38;amp;quot;),    //   7     6    5    G#&#10;          5, 10,  0, 12, TEXT (&#38;amp;quot;A#&#38;amp;quot;),    //   8     7    5    A#&#10;         -1, -1,  0, 14, TEXT (&#38;amp;quot;&#38;amp;quot;),      //   9     8&#10;          6,  1,  0, 16, TEXT (&#38;amp;quot;C#&#38;amp;quot;),    //  10     9    6    C#&#10;          6,  3,  0, 18, TEXT (&#38;amp;quot;D#&#38;amp;quot;),    //  11     0    6    D#&#10;         -1, -1,  0, 20, TEXT (&#38;amp;quot;&#38;amp;quot;),      //  12     -&#10;          6,  6,  0, 22, TEXT (&#38;amp;quot;F#&#38;amp;quot;),    //  13     =    6    F#&#10;         -1, -1, -1, -1, NULL,           //  14    Back&#10;&#10;         -1, -1, -1, -1, NULL,           //  15    Tab&#10;          5,  0,  1,  1, TEXT (&#38;amp;quot;C&#38;amp;quot;),     //  16     q    5    C&#10;          5,  2,  1,  3, TEXT (&#38;amp;quot;D&#38;amp;quot;),     //  17     w    5    D&#10;          5,  4,  1,  5, TEXT (&#38;amp;quot;E&#38;amp;quot;),     //  18     e    5    E&#10;          5,  5,  1,  7, TEXT (&#38;amp;quot;F&#38;amp;quot;),     //  19     r    5    F&#10;          5,  7,  1,  9, TEXT (&#38;amp;quot;G&#38;amp;quot;),     //  20     t    5    G&#10;          5,  9,  1, 11, TEXT (&#38;amp;quot;A&#38;amp;quot;),     //  21     y    5    A&#10;          5, 11,  1, 13, TEXT (&#38;amp;quot;B&#38;amp;quot;),     //  22     u    5    B&#10;          6,  0,  1, 15, TEXT (&#38;amp;quot;C&#38;amp;quot;),     //  23     i    6    C&#10;          6,  2,  1, 17, TEXT (&#38;amp;quot;D&#38;amp;quot;),     //  24     o    6    D&#10;          6,  4,  1, 19, TEXT (&#38;amp;quot;E&#38;amp;quot;),     //  25     p    6    E&#10;          6,  5,  1, 21, TEXT (&#38;amp;quot;F&#38;amp;quot;),     //  26     [    6    F&#10;          6,  7,  1, 23, TEXT (&#38;amp;quot;G&#38;amp;quot;),     //  27     ]    6    G&#10;         -1, -1, -1, -1, NULL,           //  28    Ent&#10;&#10;         -1, -1, -1, -1, NULL,           //  29    Ctrl&#10;          3,  8,  2,  2, TEXT (&#38;amp;quot;G#&#38;amp;quot;),    //  30     a    3    G#&#10;          3, 10,  2,  4, TEXT (&#38;amp;quot;A#&#38;amp;quot;),    //  31     s    3    A#&#10;         -1, -1,  2,  6, TEXT (&#38;amp;quot;&#38;amp;quot;),      //  32     d&#10;          4,  1,  2,  8, TEXT (&#38;amp;quot;C#&#38;amp;quot;),    //  33     f    4    C#&#10;          4,  3,  2, 10, TEXT (&#38;amp;quot;D#&#38;amp;quot;),    //  34     g    4    D#&#10;         -1, -1,  2, 12, TEXT (&#38;amp;quot;&#38;amp;quot;),      //  35     h&#10;          4,  6,  2, 14, TEXT (&#38;amp;quot;F#&#38;amp;quot;),    //  36     j    4    F#&#10;          4,  8,  2, 16, TEXT (&#38;amp;quot;G#&#38;amp;quot;),    //  37     k    4    G#&#10;          4, 10,  2, 18, TEXT (&#38;amp;quot;A#&#38;amp;quot;),    //  38     l    4    A#&#10;         -1, -1,  2, 20, TEXT (&#38;amp;quot;&#38;amp;quot;),      //  39     ;&#10;          5,  1,  2, 22, TEXT (&#38;amp;quot;C#&#38;amp;quot;),    //  40     &#38;#039;    5    C#&#10;         -1, -1, -1, -1, NULL,           //  41     `&#10;&#10;         -1, -1, -1, -1, NULL,           //  42    Shift&#10;         -1, -1, -1, -1, NULL,           //  43       (not line continuation)&#10;          3,  9,  3,  3, TEXT (&#38;amp;quot;A&#38;amp;quot;),     //  44     z    3    A&#10;          3, 11,  3,  5, TEXT (&#38;amp;quot;B&#38;amp;quot;),     //  45     x    3    B&#10;          4,  0,  3,  7, TEXT (&#38;amp;quot;C&#38;amp;quot;),     //  46     c    4    C&#10;          4,  2,  3,  9, TEXT (&#38;amp;quot;D&#38;amp;quot;),     //  47     v    4    D&#10;          4,  4,  3, 11, TEXT (&#38;amp;quot;E&#38;amp;quot;),     //  48     b    4    E&#10;          4,  5,  3, 13, TEXT (&#38;amp;quot;F&#38;amp;quot;),     //  49     n    4    F&#10;          4,  7,  3, 15, TEXT (&#38;amp;quot;G&#38;amp;quot;),     //  50     m    4    G&#10;          4,  9,  3, 17, TEXT (&#38;amp;quot;A&#38;amp;quot;),     //  51     ,    4    A&#10;          4, 11,  3, 19, TEXT (&#38;amp;quot;B&#38;amp;quot;),     //  52     .    4    B&#10;          5,  0,  3, 21, TEXT (&#38;amp;quot;C&#38;amp;quot;)      //  53     /    5    C&#10;&#125; ;&#10;&#10;int WINAPI WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance,&#10;                    PSTR szCmdLine, int iCmdShow)&#10;&#123;&#10;     MSG      msg;&#10;     HWND     hwnd ;&#10;     WNDCLASS wndclass ;&#10;&#10;     wndclass.style         = CS_HREDRAW | CS_VREDRAW ;&#10;     wndclass.lpfnWndProc   = WndProc ;&#10;     wndclass.cbClsExtra    = 0 ;&#10;     wndclass.cbWndExtra    = 0 ;&#10;     wndclass.hInstance     = hInstance ;&#10;     wndclass.hIcon         = LoadIcon (NULL, IDI_APPLICATION) ;&#10;     wndclass.hCursor       = LoadCursor (NULL, IDC_ARROW) ;&#10;     wndclass.hbrBackground = GetStockObject (WHITE_BRUSH) ;&#10;     wndclass.lpszMenuName  = NULL ;&#10;     wndclass.lpszClassName = szAppName ;&#10;&#10;     if (!RegisterClass (&#38;amp;amp;wndclass))&#10;     &#123;&#10;          MessageBox (NULL, TEXT (&#38;amp;quot;This program requires Windows NT!&#38;amp;quot;),&#10;                      szAppName, MB_ICONERROR) ;&#10;          return 0 ;&#10;     &#125;&#10;&#10;     hwnd = CreateWindow (szAppName, TEXT (&#38;amp;quot;Keyboard MIDI Player&#38;amp;quot;),&#10;                          WS_OVERLAPPEDWINDOW | WS_HSCROLL | WS_VSCROLL,&#10;                          CW_USEDEFAULT, CW_USEDEFAULT,&#10;                          CW_USEDEFAULT, CW_USEDEFAULT,&#10;                          NULL, NULL, hInstance, NULL) ;&#10;&#10;     if (!hwnd)&#10;          return 0 ;&#10;&#10;     ShowWindow (hwnd, iCmdShow) ;&#10;     UpdateWindow (hwnd);&#10;&#10;     while (GetMessage (&#38;amp;amp;msg, NULL, 0, 0))&#10;     &#123;&#10;          TranslateMessage (&#38;amp;amp;msg) ;&#10;          DispatchMessage (&#38;amp;amp;msg) ;&#10;     &#125;&#10;     return msg.wParam ;&#10;&#125;&#10;&#10;// Create the program&#38;#039;s menu (called from WndProc, WM_CREATE)&#10;// ----------------------------------------------------------&#10;&#10;HMENU CreateTheMenu (int iNumDevs)&#10;&#123;&#10;     TCHAR       szBuffer [32] ;&#10;     HMENU       hMenu, hMenuPopup, hMenuSubPopup ;&#10;     int         i, iFam, iIns ;&#10;     MIDIOUTCAPS moc ;&#10;&#10;     hMenu = CreateMenu () ;&#10;&#10;          // Create &#38;amp;quot;On/Off&#38;amp;quot; popup menu&#10;&#10;     hMenuPopup = CreateMenu () ;&#10;&#10;     AppendMenu (hMenuPopup, MF_STRING, IDM_OPEN, TEXT (&#38;amp;quot;&#38;amp;amp;Open&#38;amp;quot;)) ;&#10;     AppendMenu (hMenuPopup, MF_STRING | MF_CHECKED, IDM_CLOSE,&#10;                             TEXT (&#38;amp;quot;&#38;amp;amp;Closed&#38;amp;quot;)) ;&#10;&#10;     AppendMenu (hMenu, MF_STRING | MF_POPUP, (UINT) hMenuPopup,&#10;                        TEXT (&#38;amp;quot;&#38;amp;amp;Status&#38;amp;quot;)) ;&#10;&#10;          // Create &#38;amp;quot;Device&#38;amp;quot; popup menu&#10;&#10;     hMenuPopup = CreateMenu () ;&#10;&#10;          // Put MIDI Mapper on menu if it&#38;#039;s installed&#10;&#10;     if (!midiOutGetDevCaps (MIDIMAPPER, &#38;amp;amp;moc, sizeof (moc)))&#10;          AppendMenu (hMenuPopup, MF_STRING, IDM_DEVICE + (int) MIDIMAPPER,&#10;                         moc.szPname) ;&#10;     else&#10;          iDevice = 0 ;&#10;&#10;          // Add the rest of the MIDI devices&#10;&#10;     for (i = 0 ; i &#38;amp;lt; iNumDevs ; i++)&#10;     &#123;&#10;          midiOutGetDevCaps (i, &#38;amp;amp;moc, sizeof (moc)) ;&#10;          AppendMenu (hMenuPopup, MF_STRING, IDM_DEVICE + i, moc.szPname) ;&#10;     &#125;&#10;&#10;     CheckMenuItem (hMenuPopup, 0, MF_BYPOSITION | MF_CHECKED) ;&#10;     AppendMenu (hMenu, MF_STRING | MF_POPUP, (UINT) hMenuPopup,&#10;                        TEXT (&#38;amp;quot;&#38;amp;amp;Device&#38;amp;quot;)) ;&#10;&#10;          // Create &#38;amp;quot;Channel&#38;amp;quot; popup menu&#10;&#10;     hMenuPopup = CreateMenu () ;&#10;&#10;     for (i = 0 ; i &#38;amp;lt; 16 ; i++)&#10;     &#123;&#10;          wsprintf (szBuffer, TEXT (&#38;amp;quot;%d&#38;amp;quot;), i + 1) ;&#10;          AppendMenu (hMenuPopup, MF_STRING | (i ? MF_UNCHECKED : MF_CHECKED),&#10;                                  IDM_CHANNEL + i, szBuffer) ;&#10;     &#125;&#10;&#10;     AppendMenu (hMenu, MF_STRING | MF_POPUP, (UINT) hMenuPopup,&#10;                        TEXT (&#38;amp;quot;&#38;amp;amp;Channel&#38;amp;quot;)) ;&#10;&#10;          // Create &#38;amp;quot;Voice&#38;amp;quot; popup menu&#10;&#10;     hMenuPopup = CreateMenu () ;&#10;&#10;     for (iFam = 0 ; iFam &#38;amp;lt; 16 ; iFam++)&#10;     &#123;&#10;          hMenuSubPopup = CreateMenu () ;&#10;&#10;          for (iIns = 0 ; iIns &#38;amp;lt; 8 ; iIns++)&#10;          &#123;&#10;               wsprintf (szBuffer, TEXT (&#38;amp;quot;&#38;amp;amp;%d.t%s&#38;amp;quot;), iIns + 1,&#10;                                   fam[iFam].inst[iIns].szInst) ;&#10;               AppendMenu (hMenuSubPopup,&#10;                           MF_STRING | (fam[iFam].inst[iIns].iVoice ?&#10;                                             MF_UNCHECKED : MF_CHECKED),&#10;                           fam[iFam].inst[iIns].iVoice + IDM_VOICE,&#10;                           szBuffer) ;&#10;          &#125;&#10;&#10;          wsprintf (szBuffer, TEXT (&#38;amp;quot;&#38;amp;amp;%c.t%s&#38;amp;quot;), &#38;#039;A&#38;#039; + iFam,&#10;                              fam[iFam].szFam) ;&#10;          AppendMenu (hMenuPopup, MF_STRING | MF_POPUP, (UINT) hMenuSubPopup,&#10;                                  szBuffer) ;&#10;     &#125;&#10;     AppendMenu (hMenu, MF_STRING | MF_POPUP, (UINT) hMenuPopup,&#10;                        TEXT (&#38;amp;quot;&#38;amp;amp;Voice&#38;amp;quot;)) ;&#10;     return hMenu ;&#10;&#125;&#10;&#10;// Routines for simplifying MIDI output&#10;// ------------------------------------&#10;&#10;DWORD MidiOutMessage (HMIDIOUT hMidi, int iStatus, int iChannel,&#10;                      int iData1,  int iData2)&#10;&#123;&#10;     DWORD dwMessage ;&#10;&#10;     dwMessage = iStatus | iChannel | (iData1 &#38;amp;lt;&#38;amp;lt; 8) | (iData2 &#38;amp;lt;&#38;amp;lt; 16) ;&#10;&#10;     return midiOutShortMsg (hMidi, dwMessage) ;&#10;&#125;&#10;&#10;DWORD MidiNoteOff (HMIDIOUT hMidi, int iChannel, int iOct, int iNote, int iVel)&#10;&#123;&#10;     return MidiOutMessage (hMidi, 0x080, iChannel, 12 * iOct + iNote, iVel) ;&#10;&#125;&#10;&#10;DWORD MidiNoteOn (HMIDIOUT hMidi, int iChannel, int iOct, int iNote, int iVel)&#10;&#123;&#10;     return MidiOutMessage (hMidi, 0x090, iChannel, 12 * iOct + iNote, iVel) ;&#10;&#125;&#10;&#10;DWORD MidiSetPatch (HMIDIOUT hMidi, int iChannel, int iVoice)&#10;&#123;&#10;     return MidiOutMessage (hMidi, 0x0C0, iChannel, iVoice, 0) ;&#10;&#125;&#10;&#10;DWORD MidiPitchBend (HMIDIOUT hMidi, int iChannel, int iBend)&#10;&#123;&#10;     return MidiOutMessage (hMidi, 0x0E0, iChannel, iBend &#38;amp;amp; 0x7F, iBend &#38;amp;gt;&#38;amp;gt; 7) ;&#10;&#125;&#10;&#10;// Draw a single key on window&#10;// ---------------------------&#10;&#10;VOID DrawKey (HDC hdc, int iScanCode, BOOL fInvert)&#10;&#123;&#10;     RECT rc ;&#10;&#10;     rc.left   = 3 * cxCaps * key[iScanCode].xPos / 2 + xOffset ;&#10;     rc.top    = 3 * cyChar * key[iScanCode].yPos / 2 + yOffset ;&#10;     rc.right  = rc.left + 3 * cxCaps ;&#10;     rc.bottom = rc.top  + 3 * cyChar / 2 ;&#10;&#10;     SetTextColor (hdc, fInvert ? 0x00FFFFFFul : 0x00000000ul) ;&#10;     SetBkColor   (hdc, fInvert ? 0x00000000ul : 0x00FFFFFFul) ;&#10;&#10;     FillRect (hdc, &#38;amp;amp;rc, GetStockObject (fInvert ? BLACK_BRUSH : WHITE_BRUSH)) ;&#10;&#10;     DrawText (hdc, key[iScanCode].szKey, -1, &#38;amp;amp;rc,&#10;                    DT_SINGLELINE | DT_CENTER | DT_VCENTER) ;&#10;&#10;     FrameRect (hdc, &#38;amp;amp;rc, GetStockObject (BLACK_BRUSH)) ;&#10;&#125;&#10;&#10;// Process a Key Up or Key Down message&#10;// ------------------------------------&#10;&#10;VOID ProcessKey (HDC hdc, UINT message, LPARAM lParam)&#10;&#123;&#10;     int iScanCode, iOctave, iNote ;&#10;&#10;     iScanCode = 0x0FF &#38;amp;amp; HIWORD (lParam) ;&#10;&#10;     if (iScanCode &#38;amp;gt;= NUMSCANS)                       // No scan codes over 53&#10;          return ;&#10;&#10;     if ((iOctave = key[iScanCode].iOctave) == -1)    // Non-music key&#10;          return ;&#10;&#10;     if (GetKeyState (VK_SHIFT) &#38;amp;lt; 0)&#10;          iOctave += 0x20000000 &#38;amp;amp; lParam ? 2 : 1 ;&#10;&#10;     if (GetKeyState (VK_CONTROL) &#38;amp;lt; 0)&#10;          iOctave -= 0x20000000 &#38;amp;amp; lParam ? 2 : 1 ;&#10;&#10;     iNote = key[iScanCode].iNote ;&#10;&#10;     if (message == WM_KEYUP)                           // For key up&#10;     &#123;&#10;          MidiNoteOff (hMidiOut, iChannel, iOctave, iNote, 0) ;   // Note off&#10;          DrawKey (hdc, iScanCode, FALSE) ;&#10;          return ;&#10;     &#125;&#10;&#10;     if (0x40000000 &#38;amp;amp; lParam)                          // ignore typematics&#10;          return ;&#10;&#10;     MidiNoteOn (hMidiOut, iChannel, iOctave, iNote, iVelocity) ; // Note on&#10;     DrawKey (hdc, iScanCode, TRUE) ;                 // Draw the inverted key&#10;&#125;&#10;&#10;// Window Procedure&#10;// ----------------&#10;&#10;LRESULT CALLBACK WndProc (HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)&#10;&#123;&#10;     static BOOL bOpened = FALSE ;&#10;     HDC         hdc ;&#10;     HMENU       hMenu ;&#10;     int         i, iNumDevs, iPitchBend, cxClient, cyClient ;&#10;     MIDIOUTCAPS moc ;&#10;     PAINTSTRUCT ps ;&#10;     SIZE        size ;&#10;     TCHAR       szBuffer [16] ;&#10;&#10;     switch (message)&#10;     &#123;&#10;     case WM_CREATE:&#10;               // Get size of capital letters in system font&#10;&#10;          hdc = GetDC (hwnd) ;&#10;&#10;          GetTextExtentPoint (hdc, TEXT (&#38;amp;quot;M&#38;amp;quot;), 1, &#38;amp;amp;size) ;&#10;          cxCaps = size.cx ;&#10;          cyChar = size.cy ;&#10;&#10;          ReleaseDC (hwnd, hdc) ;&#10;&#10;               // Initialize &#38;amp;quot;Volume&#38;amp;quot; scroll bar&#10;&#10;          SetScrollRange (hwnd, SB_HORZ, 1, 127, FALSE) ;&#10;          SetScrollPos   (hwnd, SB_HORZ, iVelocity, TRUE) ;&#10;&#10;               // Initialize &#38;amp;quot;Pitch Bend&#38;amp;quot; scroll bar&#10;&#10;          SetScrollRange (hwnd, SB_VERT, 0, 16383, FALSE) ;&#10;          SetScrollPos   (hwnd, SB_VERT, 8192, TRUE) ;&#10;&#10;               // Get number of MIDI output devices and set up menu&#10;&#10;          if (0 == (iNumDevs = midiOutGetNumDevs ()))&#10;          &#123;&#10;               MessageBeep (MB_ICONSTOP) ;&#10;               MessageBox (hwnd, TEXT (&#38;amp;quot;No MIDI output devices!&#38;amp;quot;),&#10;                                 szAppName, MB_OK | MB_ICONSTOP) ;&#10;               return -1 ;&#10;          &#125;&#10;          SetMenu (hwnd, CreateTheMenu (iNumDevs)) ;&#10;          return 0 ;&#10;&#10;     case WM_SIZE:&#10;          cxClient = LOWORD (lParam) ;&#10;          cyClient = HIWORD (lParam) ;&#10;&#10;          xOffset = (cxClient - 25 * 3 * cxCaps / 2) / 2 ;&#10;          yOffset = (cyClient - 11 * cyChar) / 2 + 5 * cyChar ;&#10;          return 0 ;&#10;&#10;     case WM_COMMAND:&#10;          hMenu = GetMenu (hwnd) ;&#10;&#10;              // &#38;amp;quot;Open&#38;amp;quot; menu command&#10;&#10;          if (LOWORD (wParam) == IDM_OPEN &#38;amp;amp;&#38;amp;amp; !bOpened)&#10;          &#123;&#10;               if (midiOutOpen (&#38;amp;amp;hMidiOut, iDevice, 0, 0, 0))&#10;               &#123;&#10;                    MessageBeep (MB_ICONEXCLAMATION) ;&#10;                    MessageBox (hwnd, TEXT (&#38;amp;quot;Cannot open MIDI device&#38;amp;quot;),&#10;                                szAppName, MB_OK | MB_ICONEXCLAMATION) ;&#10;               &#125;&#10;               else&#10;               &#123;&#10;                    CheckMenuItem (hMenu, IDM_OPEN,  MF_CHECKED) ;&#10;                    CheckMenuItem (hMenu, IDM_CLOSE, MF_UNCHECKED) ;&#10;&#10;                    MidiSetPatch (hMidiOut, iChannel, iVoice) ;&#10;                    bOpened = TRUE ;&#10;               &#125;&#10;          &#125;&#10;&#10;               // &#38;amp;quot;Close&#38;amp;quot; menu command&#10;&#10;          else if (LOWORD (wParam) == IDM_CLOSE &#38;amp;amp;&#38;amp;amp; bOpened)&#10;          &#123;&#10;               CheckMenuItem (hMenu, IDM_OPEN,  MF_UNCHECKED) ;&#10;               CheckMenuItem (hMenu, IDM_CLOSE, MF_CHECKED) ;&#10;&#10;                    // Turn all keys off and close device&#10;&#10;               for (i = 0 ; i &#38;amp;lt; 16 ; i++)&#10;                    MidiOutMessage (hMidiOut, 0xB0, i, 123, 0) ;&#10;&#10;               midiOutClose (hMidiOut) ;&#10;               bOpened = FALSE ;&#10;          &#125;&#10;&#10;               // Change MIDI &#38;amp;quot;Device&#38;amp;quot; menu command&#10;&#10;          else if (LOWORD (wParam) &#38;amp;gt;= IDM_DEVICE - 1 &#38;amp;amp;&#38;amp;amp;&#10;                   LOWORD (wParam) &#38;amp;lt;  IDM_CHANNEL)&#10;          &#123;&#10;               CheckMenuItem (hMenu, IDM_DEVICE + iDevice, MF_UNCHECKED) ;&#10;               iDevice = LOWORD (wParam) - IDM_DEVICE ;&#10;               CheckMenuItem (hMenu, IDM_DEVICE + iDevice, MF_CHECKED) ;&#10;&#10;                    // Close and reopen MIDI device&#10;&#10;               if (bOpened)&#10;               &#123;&#10;                    SendMessage (hwnd, WM_COMMAND, IDM_CLOSE, 0L) ;&#10;                    SendMessage (hwnd, WM_COMMAND, IDM_OPEN,  0L) ;&#10;               &#125;&#10;          &#125;&#10;&#10;               // Change MIDI &#38;amp;quot;Channel&#38;amp;quot; menu command&#10;&#10;          else if (LOWORD (wParam) &#38;amp;gt;= IDM_CHANNEL &#38;amp;amp;&#38;amp;amp;&#10;                   LOWORD (wParam) &#38;amp;lt;  IDM_VOICE)&#10;          &#123;&#10;               CheckMenuItem (hMenu, IDM_CHANNEL + iChannel, MF_UNCHECKED);&#10;               iChannel = LOWORD (wParam) - IDM_CHANNEL ;&#10;               CheckMenuItem (hMenu, IDM_CHANNEL + iChannel, MF_CHECKED) ;&#10;&#10;               if (bOpened)&#10;                    MidiSetPatch (hMidiOut, iChannel, iVoice) ;&#10;          &#125;&#10;&#10;               // Change MIDI &#38;amp;quot;Voice&#38;amp;quot; menu command&#10;&#10;          else if (LOWORD (wParam) &#38;amp;gt;= IDM_VOICE)&#10;          &#123;&#10;               CheckMenuItem (hMenu, IDM_VOICE + iVoice, MF_UNCHECKED) ;&#10;               iVoice = LOWORD (wParam) - IDM_VOICE ;&#10;               CheckMenuItem (hMenu, IDM_VOICE + iVoice, MF_CHECKED) ;&#10;&#10;               if (bOpened)&#10;                    MidiSetPatch (hMidiOut, iChannel, iVoice) ;&#10;          &#125;&#10;&#10;          InvalidateRect (hwnd, NULL, TRUE) ;&#10;          return 0 ;&#10;&#10;          // Process a Key Up or Key Down message&#10;&#10;     case WM_KEYUP:&#10;     case WM_KEYDOWN:&#10;          hdc = GetDC (hwnd) ;&#10;&#10;          if (bOpened)&#10;               ProcessKey (hdc, message, lParam) ;&#10;&#10;          ReleaseDC (hwnd, hdc) ;&#10;          return 0 ;&#10;&#10;          // For Escape, turn off all notes and repaint&#10;&#10;     case WM_CHAR:&#10;          if (bOpened &#38;amp;amp;&#38;amp;amp; wParam == 27)&#10;          &#123;&#10;               for (i = 0 ; i &#38;amp;lt; 16 ; i++)&#10;                    MidiOutMessage (hMidiOut, 0xB0, i, 123, 0) ;&#10;&#10;               InvalidateRect (hwnd, NULL, TRUE) ;&#10;          &#125;&#10;          return 0 ;&#10;&#10;          // Horizontal scroll: Velocity&#10;&#10;     case WM_HSCROLL:&#10;          switch (LOWORD (wParam))&#10;          &#123;&#10;          case SB_LINEUP:         iVelocity -= 1 ;  break ;&#10;          case SB_LINEDOWN:       iVelocity += 1 ;  break ;&#10;          case SB_PAGEUP:         iVelocity -= 8 ;  break ;&#10;          case SB_PAGEDOWN:       iVelocity += 8 ;  break ;&#10;          case SB_THUMBPOSITION:  iVelocity = HIWORD (wParam) ;  break ;&#10;          default:                return 0 ;&#10;          &#125;&#10;          iVelocity = max (1, min (iVelocity, 127)) ;&#10;          SetScrollPos (hwnd, SB_HORZ, iVelocity, TRUE) ;&#10;          return 0 ;&#10;&#10;          // Vertical scroll:  Pitch Bend&#10;&#10;     case WM_VSCROLL:&#10;          switch (LOWORD (wParam))&#10;          &#123;&#10;          case SB_THUMBTRACK:    iPitchBend = 16383 - HIWORD (wParam) ;  break ;&#10;          case SB_THUMBPOSITION: iPitchBend = 8191 ;                     break ;&#10;          default:               return 0 ;&#10;          &#125;&#10;          iPitchBend = max (0, min (iPitchBend, 16383)) ;&#10;          SetScrollPos (hwnd, SB_VERT, 16383 - iPitchBend, TRUE) ;&#10;&#10;          if (bOpened)&#10;               MidiPitchBend (hMidiOut, iChannel, iPitchBend) ;&#10;          return 0 ;&#10;&#10;     case WM_PAINT:&#10;          hdc = BeginPaint (hwnd, &#38;amp;amp;ps) ;&#10;&#10;          for (i = 0 ; i &#38;amp;lt; NUMSCANS ; i++)&#10;               if (key[i].xPos != -1)&#10;                    DrawKey (hdc, i, FALSE) ;&#10;&#10;          midiOutGetDevCaps (iDevice, &#38;amp;amp;moc, sizeof (MIDIOUTCAPS)) ;&#10;          wsprintf (szBuffer, TEXT (&#38;amp;quot;Channel %i&#38;amp;quot;), iChannel + 1) ;&#10;&#10;          TextOut (hdc, cxCaps, 1 * cyChar,&#10;                        bOpened ? TEXT (&#38;amp;quot;Open&#38;amp;quot;) : TEXT (&#38;amp;quot;Closed&#38;amp;quot;),&#10;                        bOpened ? 4 : 6) ;&#10;          TextOut (hdc, cxCaps, 2 * cyChar, moc.szPname,&#10;                        lstrlen (moc.szPname)) ;&#10;          TextOut (hdc, cxCaps, 3 * cyChar, szBuffer, lstrlen (szBuffer)) ;&#10;          TextOut (hdc, cxCaps, 4 * cyChar,&#10;                        fam[iVoice / 8].inst[iVoice % 8].szInst,&#10;               lstrlen (fam[iVoice / 8].inst[iVoice % 8].szInst)) ;&#10;&#10;          EndPaint (hwnd, &#38;amp;amp;ps) ;&#10;          return 0 ;&#10;&#10;     case WM_DESTROY :&#10;          SendMessage (hwnd, WM_COMMAND, IDM_CLOSE, 0L) ;&#10;          PostQuitMessage (0) ;&#10;          return 0 ;&#10;     &#125;&#10;     return DefWindowProc (hwnd, message, wParam, lParam) ;&#10;&#125;</span><br></pre></td></tr></table></figure><p></p>
<p>程序虽然有点长，自己现在也没有学得很好，所以还不能完全看懂。希望以后能写一下关于这个程序的解释。</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/19/">&laquo;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/21/">&raquo;</a>
  </nav>


            </div>

            

            
        </div>

        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/about me.JPG" alt="Miibotree" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Miibotree</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">211</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">1</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">111</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
        <div class="footer-inner">
            <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Miibotree</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



        </div>
    </footer>

    <div class="back-to-top"></div>
</div>

<script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
  
  

  



  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.4"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.4"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.4" id="motion.global"></script>



  <script type="text/javascript" src="/js/search-toggle.js"></script>



<script type="text/javascript">
    $(document).ready(function () {
        if (CONFIG.sidebar === 'always') {
            displaySidebar();
        }
    });
</script>


<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



  
  

  







<!-- lazyload -->
<script type="text/javascript" src="/js/lazyload.js"></script>
<script type="text/javascript">
    jQuery(function () {
        jQuery("#posts img").lazyload({
            placeholder: "/images/loading.gif",
            effect: "fadeIn"
        });
    });
</script>
</body>
</html>
